<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2025-04-08" />

<title>Capture melt</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Capture melt</h1>
<h4 class="date">2025-04-08</h4>



<p>This vignette explains how to use functions for “melting” wide data
tables, i.e. converting to tall/long data tables. To clarify the
discussion we introduce the following three terms:</p>
<ul>
<li>Reshape columns contain the data which are present in equal amounts
in the input and output, but in fewer columns in the output. These are
<code>measure.vars</code> in reshape2/data.table.</li>
<li>Copy columns contain data which are copied from a single row of the
input into several rows of the output. These are <code>id.vars</code> in
reshape2/data.table.</li>
<li>Capture columns are only present in the output, and contain data
extracted from the names of the input reshape columns, using a capturing
regular expression.</li>
</ul>
<p>The <code>nc</code> functions use <code>data.table::melt</code>
internally:</p>
<ul>
<li><code>nc::capture_melt_single</code> is useful when you have a wide
data table with lots of columns, all of the same type, that you would
like to melt/reshape into a single result/output column. This uses
<code>melt</code> with a character vector for
<code>measure.vars</code>.</li>
<li><code>nc::capture_melt_multiple</code> is useful when you have a
wide data table with columns of possibly different types that you would
like to melt/reshape into multiple result/output columns. This uses
<code>melt</code> with a list for <code>measure.vars</code>.</li>
</ul>
<p>Both are useful when you want to use a regular expression to specify
both (1) the set of input columns to reshape and (2) some information to
extract from those column names.</p>
<div id="reshaping-several-input-columns-into-a-single-output-column" class="section level2">
<h2>Reshaping several input columns into a single output column</h2>
<p>Sometimes you want to melt a “wide” data table which has several
distinct pieces of information encoded in each column name. One example
is the familiar iris data, which have flower part and measurement
dimension encoded in each of four column names:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">head</span>(iris)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#&gt; 4          4.6         3.1          1.5         0.2  setosa</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#&gt; 6          5.4         3.9          1.7         0.4  setosa</span></span></code></pre></div>
<p>Those four reshape column names can be specified via a regex in
<code>nc::capture_melt_single</code>. The first argument is the input
data table to reshape, and the subsequent arguments are interpreted as a
pattern which is passed to <code>nc::capture_first_vec</code>. Any input
column names which match the specified regex will be passed as
<code>measure.vars</code> to <code>melt</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>(iris.tall <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  iris,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">part=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="at">dim=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="at">value.name=</span><span class="st">&quot;cm&quot;</span>))</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;        Species   part    dim    cm</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt;         &lt;fctr&gt; &lt;char&gt; &lt;char&gt; &lt;num&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt;   1:    setosa  Sepal Length   5.1</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt;   2:    setosa  Sepal Length   4.9</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt;   3:    setosa  Sepal Length   4.7</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt;   4:    setosa  Sepal Length   4.6</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt;   5:    setosa  Sepal Length   5.0</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt;  ---                              </span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; 596: virginica  Petal  Width   2.3</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt; 597: virginica  Petal  Width   1.9</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt; 598: virginica  Petal  Width   2.0</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt; 599: virginica  Petal  Width   2.3</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt; 600: virginica  Petal  Width   1.8</span></span></code></pre></div>
<p>Note the output above has one copy column (Species), two capture
columns (part, dim), and one reshape column (cm). Internally the
function joins the result of <code>nc::capture_first_vec</code> (on
column names) to the result of <code>melt</code> (on the data).</p>
<p>The reshaped data can be plotted with different parts on rows and
different dimensions on columns:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">require</span>(ggplot2)){</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.spacing=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))<span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="fu">facet_grid</span>(part <span class="sc">~</span> dim)<span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(cm, <span class="at">fill=</span>Species), <span class="at">data=</span>iris.tall)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>}</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; Le chargement a nécessité le package : ggplot2</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="reshaping-several-input-columns-into-multiple-output-columns" class="section level2">
<h2>Reshaping several input columns into multiple output columns</h2>
<p>We could instead use <code>capture_melt_multiple</code> to get
multiple output columns. Like <code>capture_melt_single</code>, the
first argument of <code>capture_melt_multiple</code> is the subject data
table and the following arguments form a pattern which is matched to the
input data column names. However the pattern must have at least two
groups:</p>
<ul>
<li>One group must be named <code>column</code>. This group is used to
capture the part of the input column names which will be used for the
output column names. The output will contain one column for each unique
value captured in this group.</li>
<li>One or more other groups (with any names) specify an identifier for
each observation.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>(iris.part.cols <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  iris,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="at">dim=</span><span class="st">&quot;.*&quot;</span>))</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt;        Species    dim Petal Sepal</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt;         &lt;fctr&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt;   1:    setosa Length   1.4   5.1</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt;   2:    setosa Length   1.4   4.9</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt;   3:    setosa Length   1.3   4.7</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt;   4:    setosa Length   1.5   4.6</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt;   5:    setosa Length   1.4   5.0</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt;  ---                             </span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; 296: virginica  Width   2.3   3.0</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; 297: virginica  Width   1.9   2.5</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; 298: virginica  Width   2.0   3.0</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; 299: virginica  Width   2.3   3.4</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt; 300: virginica  Width   1.8   3.0</span></span></code></pre></div>
<p>Note that the reshaped table above contains one copy column
(Species), one capture column (dim), and two reshape columns (Petal,
Sepal). We can plot these data to see whether or not sepals are bigger
than petals:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">require</span>(ggplot2)){</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.spacing=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))<span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    <span class="fu">facet_grid</span>(dim <span class="sc">~</span> Species)<span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>      Petal, Sepal),</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>      <span class="at">data=</span>iris.part.cols)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>It is clear from the plot above that sepals are indeed both longer
and wider than petals, on each measured plant.</p>
</div>
<div id="melting-who-data-with-a-more-complex-pattern" class="section level2">
<h2>Melting WHO data with a more complex pattern</h2>
<p>Another data set where it is useful to do column name pattern
matching followed by melting is the World Health Organization data:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>)){</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">data</span>(who, <span class="at">package=</span><span class="st">&quot;tidyr&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  who <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id=</span><span class="dv">1</span>, <span class="at">new_sp_m5564=</span><span class="dv">2</span>, <span class="at">newrel_f65=</span><span class="dv">3</span>)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>}</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; Le chargement a nécessité le package : tidyr</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="fu">names</span>(who)</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;country&quot;      &quot;iso2&quot;         &quot;iso3&quot;         &quot;year&quot;         &quot;new_sp_m014&quot; </span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;new_sp_m1524&quot; &quot;new_sp_m2534&quot; &quot;new_sp_m3544&quot; &quot;new_sp_m4554&quot; &quot;new_sp_m5564&quot;</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; [11] &quot;new_sp_m65&quot;   &quot;new_sp_f014&quot;  &quot;new_sp_f1524&quot; &quot;new_sp_f2534&quot; &quot;new_sp_f3544&quot;</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; [16] &quot;new_sp_f4554&quot; &quot;new_sp_f5564&quot; &quot;new_sp_f65&quot;   &quot;new_sn_m014&quot;  &quot;new_sn_m1524&quot;</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; [21] &quot;new_sn_m2534&quot; &quot;new_sn_m3544&quot; &quot;new_sn_m4554&quot; &quot;new_sn_m5564&quot; &quot;new_sn_m65&quot;  </span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; [26] &quot;new_sn_f014&quot;  &quot;new_sn_f1524&quot; &quot;new_sn_f2534&quot; &quot;new_sn_f3544&quot; &quot;new_sn_f4554&quot;</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; [31] &quot;new_sn_f5564&quot; &quot;new_sn_f65&quot;   &quot;new_ep_m014&quot;  &quot;new_ep_m1524&quot; &quot;new_ep_m2534&quot;</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; [36] &quot;new_ep_m3544&quot; &quot;new_ep_m4554&quot; &quot;new_ep_m5564&quot; &quot;new_ep_m65&quot;   &quot;new_ep_f014&quot; </span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; [41] &quot;new_ep_f1524&quot; &quot;new_ep_f2534&quot; &quot;new_ep_f3544&quot; &quot;new_ep_f4554&quot; &quot;new_ep_f5564&quot;</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; [46] &quot;new_ep_f65&quot;   &quot;newrel_m014&quot;  &quot;newrel_m1524&quot; &quot;newrel_m2534&quot; &quot;newrel_m3544&quot;</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; [51] &quot;newrel_m4554&quot; &quot;newrel_m5564&quot; &quot;newrel_m65&quot;   &quot;newrel_f014&quot;  &quot;newrel_f1524&quot;</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; [56] &quot;newrel_f2534&quot; &quot;newrel_f3544&quot; &quot;newrel_f4554&quot; &quot;newrel_f5564&quot; &quot;newrel_f65&quot;</span></span></code></pre></div>
<p>Each column which starts with <code>new</code> has three distinct
pieces of information encoded in its name: diagnosis type (e.g. sp or
rel), gender (m or f), and age range (e.g. 5564 or 1524). We would like
to use a regex to match these column names, then using the matching
columns as measure.vars in a melt, then join the two results.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>new.diag.gender <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="st">&quot;new_?&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="at">diagnosis=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="st">&quot;_&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="at">gender=</span><span class="st">&quot;.&quot;</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(who, new.diag.gender, <span class="at">ages=</span><span class="st">&quot;.*&quot;</span>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt;                          country   iso2   iso3  year diagnosis gender   ages</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt;                           &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;num&gt;    &lt;char&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt;     1:               Afghanistan     AF    AFG  1997        sp      m    014</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt;     2:               Afghanistan     AF    AFG  1998        sp      m    014</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt;     3:               Afghanistan     AF    AFG  1999        sp      m    014</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt;     4:               Afghanistan     AF    AFG  2000        sp      m    014</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt;     5:               Afghanistan     AF    AFG  2001        sp      m    014</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt;    ---                                                                      </span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; 76042:                  Viet Nam     VN    VNM  2013       rel      f     65</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; 76043: Wallis and Futuna Islands     WF    WLF  2013       rel      f     65</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt; 76044:                     Yemen     YE    YEM  2013       rel      f     65</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt; 76045:                    Zambia     ZM    ZMB  2013       rel      f     65</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt; 76046:                  Zimbabwe     ZW    ZWE  2013       rel      f     65</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt;        value</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt;        &lt;num&gt;</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt;     1:     0</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt;     2:    30</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co">#&gt;     3:     8</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co">#&gt;     4:    52</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="co">#&gt;     5:   129</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="co">#&gt;    ---      </span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a><span class="co">#&gt; 76042:  3110</span></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a><span class="co">#&gt; 76043:     2</span></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a><span class="co">#&gt; 76044:   360</span></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="co">#&gt; 76045:   669</span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a><span class="co">#&gt; 76046:   725</span></span></code></pre></div>
<p>Note the output includes the new reshape column called
<code>value</code> by default, as in <code>melt</code>. The input
reshape column names which matched the specified pattern, and there is a
new column for each group in that pattern. The following example shows
how to rename the <code>value</code> column and use numeric type
conversion functions:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>years.pattern <span class="ot">&lt;-</span> <span class="fu">list</span>(new.diag.gender, <span class="at">ages=</span><span class="fu">list</span>(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="at">min.years=</span><span class="st">&quot;0|[0-9]{2}&quot;</span>, as.numeric,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="at">max.years=</span><span class="st">&quot;[0-9]{0,2}&quot;</span>, <span class="cf">function</span>(x)<span class="fu">ifelse</span>(x<span class="sc">==</span><span class="st">&quot;&quot;</span>, <span class="cn">Inf</span>, <span class="fu">as.numeric</span>(x))))</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>(who.typed <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  who, years.pattern,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="at">value.name=</span><span class="st">&quot;count&quot;</span>))</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt;                          country   iso2   iso3  year diagnosis gender   ages</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt;                           &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;num&gt;    &lt;char&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt;     1:               Afghanistan     AF    AFG  1997        sp      m    014</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt;     2:               Afghanistan     AF    AFG  1998        sp      m    014</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt;     3:               Afghanistan     AF    AFG  1999        sp      m    014</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt;     4:               Afghanistan     AF    AFG  2000        sp      m    014</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt;     5:               Afghanistan     AF    AFG  2001        sp      m    014</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt;    ---                                                                      </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; 76042:                  Viet Nam     VN    VNM  2013       rel      f     65</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt; 76043: Wallis and Futuna Islands     WF    WLF  2013       rel      f     65</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; 76044:                     Yemen     YE    YEM  2013       rel      f     65</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; 76045:                    Zambia     ZM    ZMB  2013       rel      f     65</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt; 76046:                  Zimbabwe     ZW    ZWE  2013       rel      f     65</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co">#&gt;        min.years max.years count</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co">#&gt;            &lt;num&gt;     &lt;num&gt; &lt;num&gt;</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="co">#&gt;     1:         0        14     0</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="co">#&gt;     2:         0        14    30</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="co">#&gt;     3:         0        14     8</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="co">#&gt;     4:         0        14    52</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="co">#&gt;     5:         0        14   129</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co">#&gt;    ---                          </span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="co">#&gt; 76042:        65       Inf  3110</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a><span class="co">#&gt; 76043:        65       Inf     2</span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="co">#&gt; 76044:        65       Inf   360</span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a><span class="co">#&gt; 76045:        65       Inf   669</span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="co">#&gt; 76046:        65       Inf   725</span></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a><span class="fu">str</span>(who.typed)</span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   76046 obs. of  10 variables:</span></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a><span class="co">#&gt;  $ country  : chr  &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; ...</span></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a><span class="co">#&gt;  $ iso2     : chr  &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; ...</span></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a><span class="co">#&gt;  $ iso3     : chr  &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; ...</span></span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a><span class="co">#&gt;  $ year     : num  1997 1998 1999 2000 2001 ...</span></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a><span class="co">#&gt;  $ diagnosis: chr  &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; ...</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a><span class="co">#&gt;  $ gender   : chr  &quot;m&quot; &quot;m&quot; &quot;m&quot; &quot;m&quot; ...</span></span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a><span class="co">#&gt;  $ ages     : chr  &quot;014&quot; &quot;014&quot; &quot;014&quot; &quot;014&quot; ...</span></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a><span class="co">#&gt;  $ min.years: num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a><span class="co">#&gt;  $ max.years: num  14 14 14 14 14 14 14 14 14 14 ...</span></span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a><span class="co">#&gt;  $ count    : num  0 30 8 52 129 90 127 139 151 193 ...</span></span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</span></span></code></pre></div>
<p>Note in the code/result above that non-character captured output
columns can be obtained by specifying type conversion functions in the
pattern.</p>
</div>
<div id="melting-monthly-eurostat-data" class="section level2">
<h2>Melting monthly Eurostat data</h2>
<p>Another example is <a href="https://ec.europa.eu/eurostat">exchange
rate data from Eurostat</a>. We first use read the entire data set into
R:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>ert.gz <span class="ot">&lt;-</span> <span class="fu">system.file</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;ert_eff_ic_m.tsv.gz&quot;</span>, <span class="at">package=</span><span class="st">&quot;nc&quot;</span>, <span class="at">mustWork=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>ert.all <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(ert.gz, <span class="at">na.strings=</span><span class="st">&quot;:&quot;</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>ert.all[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt;    exch_rt,unit,geo\\time 2020M07 2020M06 2020M05 2020M04</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt;                    &lt;char&gt;   &lt;num&gt;   &lt;num&gt;   &lt;num&gt;   &lt;num&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; 1:       NEER_EA19,I10,AT  100.00  100.00   100.0  100.00</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; 2:       NEER_EA19,I10,AU   88.50   88.39    86.3   83.46</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; 3:       NEER_EA19,I10,BE  100.00  100.00   100.0  100.00</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; 4:       NEER_EA19,I10,BG  100.00  100.00   100.0  100.00</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; 5:       NEER_EA19,I10,BR   38.49   39.94    38.0   40.45</span></span></code></pre></div>
<p>We see that the first column has some CSV data which we can parse
via:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>ert.first <span class="ot">&lt;-</span> ert.all[, <span class="dv">1</span>]</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>csv.lines <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\\\</span><span class="st">.*&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="fu">names</span>(ert.first)), ert.first[[<span class="dv">1</span>]])</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>ert.first.dt <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="at">text=</span><span class="fu">paste</span>(csv.lines, <span class="at">collapse=</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>ert.wide <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(ert.first.dt, ert.all[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>ert.wide[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt;      exch_rt   unit    geo 2020M07 2020M06</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt;       &lt;char&gt; &lt;char&gt; &lt;char&gt;   &lt;num&gt;   &lt;num&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; 1: NEER_EA19    I10     AT  100.00  100.00</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; 2: NEER_EA19    I10     AU   88.50   88.39</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; 3: NEER_EA19    I10     BE  100.00  100.00</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; 4: NEER_EA19    I10     BG  100.00  100.00</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; 5: NEER_EA19    I10     BR   38.49   39.94</span></span></code></pre></div>
<p>The wide data table can then be melted:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>(ert.tall <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  ert.wide,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="at">year=</span><span class="st">&quot;[0-9]{4}&quot;</span>, as.integer,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="at">month=</span><span class="st">&quot;[0-9]{2}&quot;</span>, as.integer))</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt;         exch_rt   unit    geo  year month   value</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt;          &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;int&gt; &lt;int&gt;   &lt;num&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt;    1: NEER_EA19    I10     AT  2020     7  100.00</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt;    2: NEER_EA19    I10     AU  2020     7   88.50</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt;    3: NEER_EA19    I10     BE  2020     7  100.00</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt;    4: NEER_EA19    I10     BG  2020     7  100.00</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt;    5: NEER_EA19    I10     BR  2020     7   38.49</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt;   ---                                            </span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt; 2229: NEER_EA19    I10     BE  1994     1   99.07</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt; 2230: NEER_EA19    I10     BG  1994     1 4808.49</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; 2231: NEER_EA19    I10     BR  1994     1 1225.11</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; 2232: NEER_EA19    I10     CA  1994     1   92.19</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; 2233: NEER_EA19    I10     CH  1994     1   83.43</span></span></code></pre></div>
<p>After that we can create a time variable and plot via</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>ert.tall[, month.IDate <span class="sc">:=</span> data.table<span class="sc">::</span><span class="fu">as.IDate</span>(</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="fu">sprintf</span>(<span class="st">&quot;%d-%d-15&quot;</span>, year, month))]</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">require</span>(<span class="st">&quot;ggplot2&quot;</span>)){</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>      <span class="at">yintercept=</span>value),</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>      <span class="at">color=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>      <span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">value=</span><span class="dv">100</span>))<span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>      month.IDate, value, <span class="at">color=</span>geo),</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>      <span class="at">data=</span>ert.tall[geo <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;CA&quot;</span>, <span class="st">&quot;US&quot;</span>, <span class="st">&quot;JP&quot;</span>, <span class="st">&quot;FR&quot;</span>)])<span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>    <span class="fu">facet_grid</span>(exch_rt <span class="sc">~</span> .)<span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.spacing=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Another way to do it would be via</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(ert.wide, <span class="at">month.POSIXct=</span><span class="st">&quot;[0-9].*&quot;</span>, <span class="cf">function</span>(x){</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">as.POSIXct</span>(<span class="fu">strptime</span>(<span class="fu">paste0</span>(x,<span class="st">&quot;15&quot;</span>), <span class="st">&quot;%YM%m%d&quot;</span>))</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>})</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt;         exch_rt   unit    geo month.POSIXct   value</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt;          &lt;char&gt; &lt;char&gt; &lt;char&gt;         &lt;num&gt;   &lt;num&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt;    1: NEER_EA19    I10     AT    1594764000  100.00</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt;    2: NEER_EA19    I10     AU    1594764000   88.50</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt;    3: NEER_EA19    I10     BE    1594764000  100.00</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt;    4: NEER_EA19    I10     BG    1594764000  100.00</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt;    5: NEER_EA19    I10     BR    1594764000   38.49</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt;   ---                                              </span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt; 2229: NEER_EA19    I10     BE     758588400   99.07</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt; 2230: NEER_EA19    I10     BG     758588400 4808.49</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt; 2231: NEER_EA19    I10     BR     758588400 1225.11</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt; 2232: NEER_EA19    I10     CA     758588400   92.19</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#&gt; 2233: NEER_EA19    I10     CH     758588400   83.43</span></span></code></pre></div>
</div>
<div id="melting-into-multiple-output-columns-with-missing-input-columns" class="section level2">
<h2>Melting into multiple output columns with missing input columns</h2>
<p>What if the input data set has “missing” input columns?</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>iris.missing <span class="ot">&lt;-</span> iris[, <span class="fu">names</span>(iris) <span class="sc">!=</span> <span class="st">&quot;Sepal.Length&quot;</span>]</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">head</span>(iris.missing)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt;   Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt; 1         3.5          1.4         0.2  setosa</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt; 2         3.0          1.4         0.2  setosa</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; 3         3.2          1.3         0.2  setosa</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; 4         3.1          1.5         0.2  setosa</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; 5         3.6          1.4         0.2  setosa</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; 6         3.9          1.7         0.4  setosa</span></span></code></pre></div>
<p>In that case melting into multiple columns is an error by
default:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>iris.pattern <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">column=</span><span class="st">&quot;.*&quot;</span>, <span class="st">&quot;[.]&quot;</span>, <span class="at">dim=</span><span class="st">&quot;.*&quot;</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(iris.missing, iris.pattern)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt; Error in (function (subject.names, match.dt, no.match, fill = TRUE) : need dim=same count for each value, but have: Length=1 Width=2; please change pattern, edit input column names, or use fill=TRUE to output missing values</span></span></code></pre></div>
<p>The error message explains that the number of input columns for each
value of <code>dim</code> must be the same, but there is one for
<code>Length</code> and two for <code>Width</code>. To ignore the error
and fill the output with missing values,</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(iris.missing, iris.pattern, <span class="at">fill=</span><span class="cn">TRUE</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt;        Species    dim Petal Sepal</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt;         &lt;fctr&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt;   1:    setosa Length   1.4    NA</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt;   2:    setosa Length   1.4    NA</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt;   3:    setosa Length   1.3    NA</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt;   4:    setosa Length   1.5    NA</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt;   5:    setosa Length   1.4    NA</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt;  ---                             </span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; 296: virginica  Width   2.3   3.0</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt; 297: virginica  Width   1.9   2.5</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt; 298: virginica  Width   2.0   3.0</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#&gt; 299: virginica  Width   2.3   3.4</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#&gt; 300: virginica  Width   1.8   3.0</span></span></code></pre></div>
<p>Note the missing values in the table above, which correspond to the
missing input column in the original/wide data set.</p>
</div>
<div id="multiple-output-columns-of-different-types" class="section level2">
<h2>Multiple output columns of different types</h2>
<p>Some real-world data sets can be reshaped into output columns with
different types. An example data set from the <a href="https://lftdi.camden.rutgers.edu/repository/PROVEDIt_1-5-Person%20CSVs%20Filtered.zip">PROVEDIt</a>
benchmark in criminology:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>peaks.csv <span class="ot">&lt;-</span> <span class="fu">system.file</span>(</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;RD12-0002_PP16HS_5sec_GM_F_1P.csv&quot;</span>,</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="at">package=</span><span class="st">&quot;nc&quot;</span>, <span class="at">mustWork=</span><span class="cn">TRUE</span>)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>peaks.wide <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(peaks.csv)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="fu">print</span>(data.table<span class="sc">::</span><span class="fu">data.table</span>(</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="at">names=</span><span class="fu">names</span>(peaks.wide),</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>  <span class="at">class=</span><span class="fu">sapply</span>(peaks.wide, class)),</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  <span class="at">topn=</span><span class="dv">10</span>)</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#&gt;            names     class</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt;           &lt;char&gt;    &lt;char&gt;</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt;   1: Sample File character</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#&gt;   2:      Marker character</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt;   3:         Dye character</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="co">#&gt;   4:    Allele 1 character</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co">#&gt;   5:      Size 1   numeric</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co">#&gt;   6:    Height 1   integer</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="co">#&gt;   7:    Allele 2 character</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="co">#&gt;   8:      Size 2   numeric</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="co">#&gt;   9:    Height 2   integer</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="co">#&gt;  10:    Allele 3 character</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="co">#&gt;  ---                      </span></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="co">#&gt; 294:   Height 97   logical</span></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a><span class="co">#&gt; 295:   Allele 98   logical</span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a><span class="co">#&gt; 296:     Size 98   logical</span></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a><span class="co">#&gt; 297:   Height 98   logical</span></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="co">#&gt; 298:   Allele 99   logical</span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a><span class="co">#&gt; 299:     Size 99   logical</span></span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="co">#&gt; 300:   Height 99   logical</span></span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a><span class="co">#&gt; 301:  Allele 100   logical</span></span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a><span class="co">#&gt; 302:    Size 100   logical</span></span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a><span class="co">#&gt; 303:  Height 100   logical</span></span></code></pre></div>
<p>There are 303 columns, with info for 100 peaks. Each peak has three
features: Allele=character, Size=numeric, and Height=integer. The ending
peaks are class logical because they are all missing. These data can be
reshaped via</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>peaks.tall <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  peaks.wide,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="st">&quot; &quot;</span>,</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="at">peak=</span><span class="st">&quot;[0-9]+&quot;</span>, as.integer,</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(L[[&quot;data&quot;]], measure.vars = L[[&quot;measure.vars&quot;]], :</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co">#&gt; les colonnes &#39;measure.vars&#39; [Allele 1, Allele 2, Allele 3, Allele 4, ...] ne</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co">#&gt; sont pas toutes du même type. Par ordre hiérarchique, la colonne de valeurs des</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co">#&gt; données transformée sera de type &#39;character&#39;. Toutes les variables de mesure</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="co">#&gt; qui ne sont pas de type &#39;character&#39; seront également converties</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a><span class="co">#&gt; automatiquement. Consultez DETAILS dans ?melt.data.table pour en savoir plus</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="co">#&gt; sur la conversion automatique.</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(L[[&quot;data&quot;]], measure.vars = L[[&quot;measure.vars&quot;]], :</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="co">#&gt; les colonnes &#39;measure.vars&#39; [Height 1, Height 2, Height 3, Height 4, ...] ne</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="co">#&gt; sont pas toutes du même type. Par ordre hiérarchique, la colonne de valeurs des</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="co">#&gt; données transformée sera de type &#39;integer&#39;. Toutes les variables de mesure qui</span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a><span class="co">#&gt; ne sont pas de type &#39;integer&#39; seront également converties automatiquement.</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="co">#&gt; Consultez DETAILS dans ?melt.data.table pour en savoir plus sur la conversion</span></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="co">#&gt; automatique.</span></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(L[[&quot;data&quot;]], measure.vars = L[[&quot;measure.vars&quot;]], :</span></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a><span class="co">#&gt; les colonnes &#39;measure.vars&#39; [Size 1, Size 2, Size 3, Size 4, ...] ne sont pas</span></span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a><span class="co">#&gt; toutes du même type. Par ordre hiérarchique, la colonne de valeurs des données</span></span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a><span class="co">#&gt; transformée sera de type &#39;double&#39;. Toutes les variables de mesure qui ne sont</span></span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a><span class="co">#&gt; pas de type &#39;double&#39; seront également converties automatiquement. Consultez</span></span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a><span class="co">#&gt; DETAILS dans ?melt.data.table pour en savoir plus sur la conversion</span></span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a><span class="co">#&gt; automatique.</span></span>
<span id="cb18-28"><a href="#cb18-28" tabindex="-1"></a>old.opt <span class="ot">&lt;-</span> <span class="fu">options</span>(<span class="at">width=</span><span class="dv">90</span>)</span>
<span id="cb18-29"><a href="#cb18-29" tabindex="-1"></a><span class="fu">print</span>(peaks.tall)</span>
<span id="cb18-30"><a href="#cb18-30" tabindex="-1"></a><span class="co">#&gt;                                Sample File  Marker    Dye  peak Allele Height   Size</span></span>
<span id="cb18-31"><a href="#cb18-31" tabindex="-1"></a><span class="co">#&gt;                                     &lt;char&gt;  &lt;char&gt; &lt;char&gt; &lt;int&gt; &lt;char&gt;  &lt;int&gt;  &lt;num&gt;</span></span>
<span id="cb18-32"><a href="#cb18-32" tabindex="-1"></a><span class="co">#&gt;   1: A02-RD12-0002-35-0.5PP16-001.5sec.fsa D3S1358      B     1     OL      5  94.68</span></span>
<span id="cb18-33"><a href="#cb18-33" tabindex="-1"></a><span class="co">#&gt;   2: A02-RD12-0002-35-0.5PP16-001.5sec.fsa    TH01      B     1     OL      3 148.69</span></span>
<span id="cb18-34"><a href="#cb18-34" tabindex="-1"></a><span class="co">#&gt;   3: A02-RD12-0002-35-0.5PP16-001.5sec.fsa  D21S11      B     1     OL      7 195.84</span></span>
<span id="cb18-35"><a href="#cb18-35" tabindex="-1"></a><span class="co">#&gt;   4: A02-RD12-0002-35-0.5PP16-001.5sec.fsa  D18S51      B     1     OL      4 285.51</span></span>
<span id="cb18-36"><a href="#cb18-36" tabindex="-1"></a><span class="co">#&gt;   5: A02-RD12-0002-35-0.5PP16-001.5sec.fsa Penta E      B     1     OL      3 369.36</span></span>
<span id="cb18-37"><a href="#cb18-37" tabindex="-1"></a><span class="co">#&gt;  ---                                                                                </span></span>
<span id="cb18-38"><a href="#cb18-38" tabindex="-1"></a><span class="co">#&gt; 438: A02-RD12-0002-35-0.5PP16-001.5sec.fsa     FGA      Y    25     OL      5 413.28</span></span>
<span id="cb18-39"><a href="#cb18-39" tabindex="-1"></a><span class="co">#&gt; 439: A02-RD12-0002-35-0.5PP16-001.5sec.fsa Penta E      B    26     OL      3 479.21</span></span>
<span id="cb18-40"><a href="#cb18-40" tabindex="-1"></a><span class="co">#&gt; 440: A02-RD12-0002-35-0.5PP16-001.5sec.fsa     FGA      Y    26     OL      4 415.55</span></span>
<span id="cb18-41"><a href="#cb18-41" tabindex="-1"></a><span class="co">#&gt; 441: A02-RD12-0002-35-0.5PP16-001.5sec.fsa     FGA      Y    27     OL      4 428.06</span></span>
<span id="cb18-42"><a href="#cb18-42" tabindex="-1"></a><span class="co">#&gt; 442: A02-RD12-0002-35-0.5PP16-001.5sec.fsa     FGA      Y    28     OL      4 445.08</span></span>
<span id="cb18-43"><a href="#cb18-43" tabindex="-1"></a><span class="fu">str</span>(peaks.tall)</span>
<span id="cb18-44"><a href="#cb18-44" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   442 obs. of  7 variables:</span></span>
<span id="cb18-45"><a href="#cb18-45" tabindex="-1"></a><span class="co">#&gt;  $ Sample File: chr  &quot;A02-RD12-0002-35-0.5PP16-001.5sec.fsa&quot; &quot;A02-RD12-0002-35-0.5PP16-001.5sec.fsa&quot; &quot;A02-RD12-0002-35-0.5PP16-001.5sec.fsa&quot; &quot;A02-RD12-0002-35-0.5PP16-001.5sec.fsa&quot; ...</span></span>
<span id="cb18-46"><a href="#cb18-46" tabindex="-1"></a><span class="co">#&gt;  $ Marker     : chr  &quot;D3S1358&quot; &quot;TH01&quot; &quot;D21S11&quot; &quot;D18S51&quot; ...</span></span>
<span id="cb18-47"><a href="#cb18-47" tabindex="-1"></a><span class="co">#&gt;  $ Dye        : chr  &quot;B&quot; &quot;B&quot; &quot;B&quot; &quot;B&quot; ...</span></span>
<span id="cb18-48"><a href="#cb18-48" tabindex="-1"></a><span class="co">#&gt;  $ peak       : int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb18-49"><a href="#cb18-49" tabindex="-1"></a><span class="co">#&gt;  $ Allele     : chr  &quot;OL&quot; &quot;OL&quot; &quot;OL&quot; &quot;OL&quot; ...</span></span>
<span id="cb18-50"><a href="#cb18-50" tabindex="-1"></a><span class="co">#&gt;  $ Height     : int  5 3 7 4 3 4 3 197 45 4 ...</span></span>
<span id="cb18-51"><a href="#cb18-51" tabindex="-1"></a><span class="co">#&gt;  $ Size       : num  94.7 148.7 195.8 285.5 369.4 ...</span></span>
<span id="cb18-52"><a href="#cb18-52" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</span></span>
<span id="cb18-53"><a href="#cb18-53" tabindex="-1"></a><span class="fu">options</span>(old.opt)</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
