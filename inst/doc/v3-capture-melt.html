<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2023-08-31" />

<title>Capture melt</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Capture melt</h1>
<h4 class="date">2023-08-31</h4>



<div id="capture-melt" class="section level1">
<h1>Capture melt</h1>
<p>This vignette explains how to use functions for “melting” wide data tables, i.e. converting to tall/long data tables. To clarify the discussion we introduce the following three terms:</p>
<ul>
<li>Reshape columns contain the data which are present in equal amounts in the input and output, but in fewer columns in the output. These are <code>measure.vars</code> in reshape2/data.table.</li>
<li>Copy columns contain data which are copied from a single row of the input into several rows of the output. These are <code>id.vars</code> in reshape2/data.table.</li>
<li>Capture columns are only present in the output, and contain data extracted from the names of the input reshape columns, using a capturing regular expression.</li>
</ul>
<p>The <code>nc</code> functions use <code>data.table::melt</code> internally:</p>
<ul>
<li><code>nc::capture_melt_single</code> is useful when you have a wide data table with lots of columns, all of the same type, that you would like to melt/reshape into a single result/output column. This uses <code>melt</code> with a character vector for <code>measure.vars</code>.</li>
<li><code>nc::capture_melt_multiple</code> is useful when you have a wide data table with columns of possibly different types that you would like to melt/reshape into multiple result/output columns. This uses <code>melt</code> with a list for <code>measure.vars</code>.</li>
</ul>
<p>Both are useful when you want to use a regular expression to specify both (1) the set of input columns to reshape and (2) some information to extract from those column names.</p>
<div id="reshaping-several-input-columns-into-a-single-output-column" class="section level2">
<h2>Reshaping several input columns into a single output column</h2>
<p>Sometimes you want to melt a “wide” data table which has several distinct pieces of information encoded in each column name. One example is the familiar iris data, which have flower part and measurement dimension encoded in each of four column names:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4          4.6         3.1          1.5         0.2  setosa</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6          5.4         3.9          1.7         0.4  setosa</span></span></code></pre></div>
<p>Those four reshape column names can be specified via a regex in <code>nc::capture_melt_single</code>. The first argument is the input data table to reshape, and the subsequent arguments are interpreted as a pattern which is passed to <code>nc::capture_first_vec</code>. Any input column names which match the specified regex will be passed as <code>measure.vars</code> to <code>melt</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>(iris.tall <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  iris,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">part=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dim=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.name=</span><span class="st">&quot;cm&quot;</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Species  part    dim  cm</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1:    setosa Sepal Length 5.1</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2:    setosa Sepal Length 4.9</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3:    setosa Sepal Length 4.7</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4:    setosa Sepal Length 4.6</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5:    setosa Sepal Length 5.0</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                           </span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 596: virginica Petal  Width 2.3</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 597: virginica Petal  Width 1.9</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 598: virginica Petal  Width 2.0</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 599: virginica Petal  Width 2.3</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 600: virginica Petal  Width 1.8</span></span></code></pre></div>
<p>Note the output above has one copy column (Species), two capture columns (part, dim), and one reshape column (cm). Internally the function joins the result of <code>nc::capture_first_vec</code> (on column names) to the result of <code>melt</code> (on the data).</p>
<p>The reshaped data can be plotted with different parts on rows and different dimensions on columns:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">require</span>(ggplot2)){</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.spacing=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))<span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(part <span class="sc">~</span> dim)<span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(cm, <span class="at">fill=</span>Species), <span class="at">data=</span>iris.tall)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: ggplot2</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="reshaping-several-input-columns-into-multiple-output-columns" class="section level2">
<h2>Reshaping several input columns into multiple output columns</h2>
<p>We could instead use <code>capture_melt_multiple</code> to get multiple output columns. Like <code>capture_melt_single</code>, the first argument of <code>capture_melt_multiple</code> is the subject data table and the following arguments form a pattern which is matched to the input data column names. However the pattern must have at least two groups:</p>
<ul>
<li>One group must be named <code>column</code>. This group is used to capture the part of the input column names which will be used for the output column names. The output will contain one column for each unique value captured in this group.</li>
<li>One or more other groups (with any names) specify an identifier for each observation.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(iris.part.cols <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  iris,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dim=</span><span class="st">&quot;.*&quot;</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Species    dim Petal Sepal</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1:    setosa Length   1.4   5.1</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2:    setosa Length   1.4   4.9</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3:    setosa Length   1.3   4.7</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4:    setosa Length   1.5   4.6</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5:    setosa Length   1.4   5.0</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                             </span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 296: virginica  Width   2.3   3.0</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 297: virginica  Width   1.9   2.5</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 298: virginica  Width   2.0   3.0</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 299: virginica  Width   2.3   3.4</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 300: virginica  Width   1.8   3.0</span></span></code></pre></div>
<p>Note that the reshaped table above contains one copy column (Species), one capture column (dim), and two reshape columns (Petal, Sepal). We can plot these data to see whether or not sepals are bigger than petals:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">require</span>(ggplot2)){</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.spacing=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))<span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(dim <span class="sc">~</span> Species)<span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      Petal, Sepal),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>iris.part.cols)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>It is clear from the plot above that sepals are indeed both longer and wider than petals, on each measured plant.</p>
</div>
<div id="melting-who-data-with-a-more-complex-pattern" class="section level2">
<h2>Melting WHO data with a more complex pattern</h2>
<p>Another data set where it is useful to do column name pattern matching followed by melting is the World Health Organization data:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>)){</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data</span>(who, <span class="at">package=</span><span class="st">&quot;tidyr&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  who <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id=</span><span class="dv">1</span>, <span class="at">new_sp_m5564=</span><span class="dv">2</span>, <span class="at">newrel_f65=</span><span class="dv">3</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required namespace: tidyr</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(who)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;country&quot;      &quot;iso2&quot;         &quot;iso3&quot;         &quot;year&quot;         &quot;new_sp_m014&quot; </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;new_sp_m1524&quot; &quot;new_sp_m2534&quot; &quot;new_sp_m3544&quot; &quot;new_sp_m4554&quot; &quot;new_sp_m5564&quot;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11] &quot;new_sp_m65&quot;   &quot;new_sp_f014&quot;  &quot;new_sp_f1524&quot; &quot;new_sp_f2534&quot; &quot;new_sp_f3544&quot;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [16] &quot;new_sp_f4554&quot; &quot;new_sp_f5564&quot; &quot;new_sp_f65&quot;   &quot;new_sn_m014&quot;  &quot;new_sn_m1524&quot;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21] &quot;new_sn_m2534&quot; &quot;new_sn_m3544&quot; &quot;new_sn_m4554&quot; &quot;new_sn_m5564&quot; &quot;new_sn_m65&quot;  </span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [26] &quot;new_sn_f014&quot;  &quot;new_sn_f1524&quot; &quot;new_sn_f2534&quot; &quot;new_sn_f3544&quot; &quot;new_sn_f4554&quot;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [31] &quot;new_sn_f5564&quot; &quot;new_sn_f65&quot;   &quot;new_ep_m014&quot;  &quot;new_ep_m1524&quot; &quot;new_ep_m2534&quot;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [36] &quot;new_ep_m3544&quot; &quot;new_ep_m4554&quot; &quot;new_ep_m5564&quot; &quot;new_ep_m65&quot;   &quot;new_ep_f014&quot; </span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [41] &quot;new_ep_f1524&quot; &quot;new_ep_f2534&quot; &quot;new_ep_f3544&quot; &quot;new_ep_f4554&quot; &quot;new_ep_f5564&quot;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [46] &quot;new_ep_f65&quot;   &quot;newrel_m014&quot;  &quot;newrel_m1524&quot; &quot;newrel_m2534&quot; &quot;newrel_m3544&quot;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [51] &quot;newrel_m4554&quot; &quot;newrel_m5564&quot; &quot;newrel_m65&quot;   &quot;newrel_f014&quot;  &quot;newrel_f1524&quot;</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [56] &quot;newrel_f2534&quot; &quot;newrel_f3544&quot; &quot;newrel_f4554&quot; &quot;newrel_f5564&quot; &quot;newrel_f65&quot;</span></span></code></pre></div>
<p>Each column which starts with <code>new</code> has three distinct pieces of information encoded in its name: diagnosis type (e.g. sp or rel), gender (m or f), and age range (e.g. 5564 or 1524). We would like to use a regex to match these column names, then using the matching columns as measure.vars in a melt, then join the two results.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>new.diag.gender <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;new_?&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">diagnosis=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;_&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender=</span><span class="st">&quot;.&quot;</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(who, new.diag.gender, <span class="at">ages=</span><span class="st">&quot;.*&quot;</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          country iso2 iso3 year diagnosis gender ages value</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     1:               Afghanistan   AF  AFG 1997        sp      m  014     0</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     2:               Afghanistan   AF  AFG 1998        sp      m  014    30</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     3:               Afghanistan   AF  AFG 1999        sp      m  014     8</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     4:               Afghanistan   AF  AFG 2000        sp      m  014    52</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     5:               Afghanistan   AF  AFG 2001        sp      m  014   129</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    ---                                                                     </span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76042:                  Viet Nam   VN  VNM 2013       rel      f   65  3110</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76043: Wallis and Futuna Islands   WF  WLF 2013       rel      f   65     2</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76044:                     Yemen   YE  YEM 2013       rel      f   65   360</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76045:                    Zambia   ZM  ZMB 2013       rel      f   65   669</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76046:                  Zimbabwe   ZW  ZWE 2013       rel      f   65   725</span></span></code></pre></div>
<p>Note the output includes the new reshape column called <code>value</code> by default, as in <code>melt</code>. The input reshape column names which matched the specified pattern, and there is a new column for each group in that pattern. The following example shows how to rename the <code>value</code> column and use numeric type conversion functions:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>years.pattern <span class="ot">&lt;-</span> <span class="fu">list</span>(new.diag.gender, <span class="at">ages=</span><span class="fu">list</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.years=</span><span class="st">&quot;0|[0-9]{2}&quot;</span>, as.numeric,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.years=</span><span class="st">&quot;[0-9]{0,2}&quot;</span>, <span class="cf">function</span>(x)<span class="fu">ifelse</span>(x<span class="sc">==</span><span class="st">&quot;&quot;</span>, <span class="cn">Inf</span>, <span class="fu">as.numeric</span>(x))))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>(who.typed <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  who, years.pattern,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.name=</span><span class="st">&quot;count&quot;</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          country iso2 iso3 year diagnosis gender ages min.years</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     1:               Afghanistan   AF  AFG 1997        sp      m  014         0</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     2:               Afghanistan   AF  AFG 1998        sp      m  014         0</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     3:               Afghanistan   AF  AFG 1999        sp      m  014         0</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     4:               Afghanistan   AF  AFG 2000        sp      m  014         0</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     5:               Afghanistan   AF  AFG 2001        sp      m  014         0</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    ---                                                                         </span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76042:                  Viet Nam   VN  VNM 2013       rel      f   65        65</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76043: Wallis and Futuna Islands   WF  WLF 2013       rel      f   65        65</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76044:                     Yemen   YE  YEM 2013       rel      f   65        65</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76045:                    Zambia   ZM  ZMB 2013       rel      f   65        65</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76046:                  Zimbabwe   ZW  ZWE 2013       rel      f   65        65</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        max.years count</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     1:        14     0</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     2:        14    30</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     3:        14     8</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     4:        14    52</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     5:        14   129</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    ---                </span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76042:       Inf  3110</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76043:       Inf     2</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76044:       Inf   360</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76045:       Inf   669</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 76046:       Inf   725</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(who.typed)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   76046 obs. of  10 variables:</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ country  : chr  &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; ...</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ iso2     : chr  &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; ...</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ iso3     : chr  &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; ...</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ year     : num  1997 1998 1999 2000 2001 ...</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ diagnosis: chr  &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; ...</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ gender   : chr  &quot;m&quot; &quot;m&quot; &quot;m&quot; &quot;m&quot; ...</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ ages     : chr  &quot;014&quot; &quot;014&quot; &quot;014&quot; &quot;014&quot; ...</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ min.years: num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ max.years: num  14 14 14 14 14 14 14 14 14 14 ...</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ count    : num  0 30 8 52 129 90 127 139 151 193 ...</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</span></span></code></pre></div>
<p>Note in the code/result above that non-character captured output columns can be obtained by specifying type conversion functions in the pattern.</p>
</div>
<div id="melting-monthly-eurostat-data" class="section level2">
<h2>Melting monthly Eurostat data</h2>
<p>Another example is <a href="https://ec.europa.eu/eurostat/estat-navtree-portlet-prod/BulkDownloadListing?file=data/ert_eff_ic_m.tsv.gz">exchange rate data from Eurostat</a>. We first use read the entire data set into R:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ert.gz <span class="ot">&lt;-</span> <span class="fu">system.file</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;ert_eff_ic_m.tsv.gz&quot;</span>, <span class="at">package=</span><span class="st">&quot;nc&quot;</span>, <span class="at">mustWork=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ert.all <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(ert.gz, <span class="at">na.strings=</span><span class="st">&quot;:&quot;</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>ert.all[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    exch_rt,unit,geo\\time 2020M07 2020M06 2020M05 2020M04</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:       NEER_EA19,I10,AT  100.00  100.00   100.0  100.00</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2:       NEER_EA19,I10,AU   88.50   88.39    86.3   83.46</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:       NEER_EA19,I10,BE  100.00  100.00   100.0  100.00</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:       NEER_EA19,I10,BG  100.00  100.00   100.0  100.00</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5:       NEER_EA19,I10,BR   38.49   39.94    38.0   40.45</span></span></code></pre></div>
<p>We see that the first column has some CSV data which we can parse via:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ert.first <span class="ot">&lt;-</span> ert.all[, <span class="dv">1</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>csv.lines <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\\\</span><span class="st">.*&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="fu">names</span>(ert.first)), ert.first[[<span class="dv">1</span>]])</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>ert.first.dt <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="at">text=</span><span class="fu">paste</span>(csv.lines, <span class="at">collapse=</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>ert.wide <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(ert.first.dt, ert.all[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>ert.wide[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      exch_rt unit geo 2020M07 2020M06</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1: NEER_EA19  I10  AT  100.00  100.00</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: NEER_EA19  I10  AU   88.50   88.39</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3: NEER_EA19  I10  BE  100.00  100.00</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4: NEER_EA19  I10  BG  100.00  100.00</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5: NEER_EA19  I10  BR   38.49   39.94</span></span></code></pre></div>
<p>The wide data table can then be melted:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(ert.tall <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  ert.wide,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">year=</span><span class="st">&quot;[0-9]{4}&quot;</span>, as.integer,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">month=</span><span class="st">&quot;[0-9]{2}&quot;</span>, as.integer))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         exch_rt unit geo year month   value</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    1: NEER_EA19  I10  AT 2020     7  100.00</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    2: NEER_EA19  I10  AU 2020     7   88.50</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    3: NEER_EA19  I10  BE 2020     7  100.00</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    4: NEER_EA19  I10  BG 2020     7  100.00</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    5: NEER_EA19  I10  BR 2020     7   38.49</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ---                                      </span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2229: NEER_EA19  I10  BE 1994     1   99.07</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2230: NEER_EA19  I10  BG 1994     1 4808.49</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2231: NEER_EA19  I10  BR 1994     1 1225.11</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2232: NEER_EA19  I10  CA 1994     1   92.19</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2233: NEER_EA19  I10  CH 1994     1   83.43</span></span></code></pre></div>
<p>After that we can create a time variable and plot via</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>ert.tall[, month.IDate <span class="sc">:</span><span class="er">=</span> data.table<span class="sc">::</span><span class="fu">as.IDate</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sprintf</span>(<span class="st">&quot;%d-%d-15&quot;</span>, year, month))]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">require</span>(<span class="st">&quot;ggplot2&quot;</span>)){</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">yintercept=</span>value),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">color=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">value=</span><span class="dv">100</span>))<span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>      month.IDate, value, <span class="at">color=</span>geo),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>ert.tall[geo <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;CA&quot;</span>, <span class="st">&quot;US&quot;</span>, <span class="st">&quot;JP&quot;</span>, <span class="st">&quot;FR&quot;</span>)])<span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(exch_rt <span class="sc">~</span> .)<span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.spacing=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Another way to do it would be via</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(ert.wide, <span class="at">month.POSIXct=</span><span class="st">&quot;[0-9].*&quot;</span>, <span class="cf">function</span>(x){</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.POSIXct</span>(<span class="fu">strptime</span>(<span class="fu">paste0</span>(x,<span class="st">&quot;15&quot;</span>), <span class="st">&quot;%YM%m%d&quot;</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         exch_rt unit geo month.POSIXct   value</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    1: NEER_EA19  I10  AT    2020-07-15  100.00</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    2: NEER_EA19  I10  AU    2020-07-15   88.50</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    3: NEER_EA19  I10  BE    2020-07-15  100.00</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    4: NEER_EA19  I10  BG    2020-07-15  100.00</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    5: NEER_EA19  I10  BR    2020-07-15   38.49</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ---                                         </span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2229: NEER_EA19  I10  BE    1994-01-15   99.07</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2230: NEER_EA19  I10  BG    1994-01-15 4808.49</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2231: NEER_EA19  I10  BR    1994-01-15 1225.11</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2232: NEER_EA19  I10  CA    1994-01-15   92.19</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2233: NEER_EA19  I10  CH    1994-01-15   83.43</span></span></code></pre></div>
</div>
<div id="melting-into-multiple-output-columns-with-missing-input-columns" class="section level2">
<h2>Melting into multiple output columns with missing input columns</h2>
<p>What if the input data set has “missing” input columns?</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>iris.missing <span class="ot">&lt;-</span> iris[, <span class="fu">names</span>(iris) <span class="sc">!=</span> <span class="st">&quot;Sepal.Length&quot;</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris.missing)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1         3.5          1.4         0.2  setosa</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2         3.0          1.4         0.2  setosa</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3         3.2          1.3         0.2  setosa</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4         3.1          1.5         0.2  setosa</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5         3.6          1.4         0.2  setosa</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6         3.9          1.7         0.4  setosa</span></span></code></pre></div>
<p>In that case melting into multiple columns is an error by default:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>iris.pattern <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">column=</span><span class="st">&quot;.*&quot;</span>, <span class="st">&quot;[.]&quot;</span>, <span class="at">dim=</span><span class="st">&quot;.*&quot;</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(iris.missing, iris.pattern)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in (function (subject.names, match.dt, no.match, fill = TRUE) : need dim=same count for each value, but have: Length=1 Width=2; please change pattern, edit input column names, or use fill=TRUE to output missing values</span></span></code></pre></div>
<p>The error message explains that the number of input columns for each value of <code>dim</code> must be the same, but there is one for <code>Length</code> and two for <code>Width</code>. To ignore the error and fill the output with missing values,</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(iris.missing, iris.pattern, <span class="at">fill=</span><span class="cn">TRUE</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Species    dim Petal Sepal</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1:    setosa Length   1.4    NA</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2:    setosa Length   1.4    NA</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3:    setosa Length   1.3    NA</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4:    setosa Length   1.5    NA</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5:    setosa Length   1.4    NA</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                             </span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 296: virginica  Width   2.3   3.0</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 297: virginica  Width   1.9   2.5</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 298: virginica  Width   2.0   3.0</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 299: virginica  Width   2.3   3.4</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 300: virginica  Width   1.8   3.0</span></span></code></pre></div>
<p>Note the missing values in the table above, which correspond to the missing input column in the original/wide data set.</p>
</div>
<div id="multiple-output-columns-of-different-types" class="section level2">
<h2>Multiple output columns of different types</h2>
<p>Some real-world data sets can be reshaped into output columns with different types. An example data set from the <a href="https://lftdi.camden.rutgers.edu/repository/PROVEDIt_1-5-Person%20CSVs%20Filtered.zip">PROVEDIt</a> benchmark in criminology:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>peaks.csv <span class="ot">&lt;-</span> <span class="fu">system.file</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;RD12-0002_PP16HS_5sec_GM_F_1P.csv&quot;</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">package=</span><span class="st">&quot;nc&quot;</span>, <span class="at">mustWork=</span><span class="cn">TRUE</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>peaks.wide <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(peaks.csv)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data.table<span class="sc">::</span><span class="fu">data.table</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">names=</span><span class="fu">names</span>(peaks.wide),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">class=</span><span class="fu">sapply</span>(peaks.wide, class)),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">topn=</span><span class="dv">10</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            names     class</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1: Sample File character</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2:      Marker character</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3:         Dye character</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4:    Allele 1 character</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5:      Size 1   numeric</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   6:    Height 1   integer</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   7:    Allele 2 character</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   8:      Size 2   numeric</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   9:    Height 2   integer</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  10:    Allele 3 character</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                      </span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 294:   Height 97   logical</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 295:   Allele 98   logical</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 296:     Size 98   logical</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 297:   Height 98   logical</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 298:   Allele 99   logical</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 299:     Size 99   logical</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 300:   Height 99   logical</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 301:  Allele 100   logical</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 302:    Size 100   logical</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 303:  Height 100   logical</span></span></code></pre></div>
<p>There are 303 columns, with info for 100 peaks. Each peak has three features: Allele=character, Size=numeric, and Height=integer. The ending peaks are class logical because they are all missing. These data can be reshaped via</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>peaks.tall <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  peaks.wide,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot; &quot;</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">peak=</span><span class="st">&quot;[0-9]+&quot;</span>, as.integer,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(data.table(L[[&quot;data&quot;]]), measure.vars = measure.vars, :</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &#39;measure.vars&#39; [Allele 1, Allele 2, Allele 3, Allele 4, ...] are not all of the same</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; type. By order of hierarchy, the molten data value column will be of type &#39;character&#39;.</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; All measure variables not of type &#39;character&#39; will be coerced too. Check DETAILS in</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ?melt.data.table for more on coercion.</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(data.table(L[[&quot;data&quot;]]), measure.vars = measure.vars, :</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &#39;measure.vars&#39; [Height 1, Height 2, Height 3, Height 4, ...] are not all of the same</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; type. By order of hierarchy, the molten data value column will be of type &#39;integer&#39;. All</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; measure variables not of type &#39;integer&#39; will be coerced too. Check DETAILS in</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ?melt.data.table for more on coercion.</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(data.table(L[[&quot;data&quot;]]), measure.vars = measure.vars, :</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &#39;measure.vars&#39; [Size 1, Size 2, Size 3, Size 4, ...] are not all of the same type. By</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; order of hierarchy, the molten data value column will be of type &#39;double&#39;. All measure</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; variables not of type &#39;double&#39; will be coerced too. Check DETAILS in ?melt.data.table for</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; more on coercion.</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">width=</span><span class="dv">90</span>)</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(peaks.tall)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                Sample File  Marker Dye peak Allele Height   Size</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1: A02-RD12-0002-35-0.5PP16-001.5sec.fsa D3S1358   B    1     OL      5  94.68</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2: A02-RD12-0002-35-0.5PP16-001.5sec.fsa    TH01   B    1     OL      3 148.69</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3: A02-RD12-0002-35-0.5PP16-001.5sec.fsa  D21S11   B    1     OL      7 195.84</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4: A02-RD12-0002-35-0.5PP16-001.5sec.fsa  D18S51   B    1     OL      4 285.51</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5: A02-RD12-0002-35-0.5PP16-001.5sec.fsa Penta E   B    1     OL      3 369.36</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                                                                            </span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 438: A02-RD12-0002-35-0.5PP16-001.5sec.fsa     FGA   Y   25     OL      5 413.28</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 439: A02-RD12-0002-35-0.5PP16-001.5sec.fsa Penta E   B   26     OL      3 479.21</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 440: A02-RD12-0002-35-0.5PP16-001.5sec.fsa     FGA   Y   26     OL      4 415.55</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 441: A02-RD12-0002-35-0.5PP16-001.5sec.fsa     FGA   Y   27     OL      4 428.06</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 442: A02-RD12-0002-35-0.5PP16-001.5sec.fsa     FGA   Y   28     OL      4 445.08</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(peaks.tall)</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   442 obs. of  7 variables:</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ Sample File: chr  &quot;A02-RD12-0002-35-0.5PP16-001.5sec.fsa&quot; &quot;A02-RD12-0002-35-0.5PP16-001.5sec.fsa&quot; &quot;A02-RD12-0002-35-0.5PP16-001.5sec.fsa&quot; &quot;A02-RD12-0002-35-0.5PP16-001.5sec.fsa&quot; ...</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ Marker     : chr  &quot;D3S1358&quot; &quot;TH01&quot; &quot;D21S11&quot; &quot;D18S51&quot; ...</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ Dye        : chr  &quot;B&quot; &quot;B&quot; &quot;B&quot; &quot;B&quot; ...</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ peak       : int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ Allele     : chr  &quot;OL&quot; &quot;OL&quot; &quot;OL&quot; &quot;OL&quot; ...</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ Height     : int  5 3 7 4 3 4 3 197 45 4 ...</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ Size       : num  94.7 148.7 195.8 285.5 369.4 ...</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;sorted&quot;)= chr &quot;peak&quot;</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</span></span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
