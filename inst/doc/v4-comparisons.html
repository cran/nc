<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2023-05-01" />

<title>Comparisons with other packages</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Comparisons with other packages</h1>
<h4 class="date">2023-05-01</h4>



<div id="comparisons-with-other-packages" class="section level1">
<h1>Comparisons with other packages</h1>
<p>This vignette provides comparisons with other packages that provide similar functionality. This is a work in progress – for a more detailed / complete / coherent comparison with other packages which provide wide-to-tall data reshaping, see <a href="https://github.com/tdhock/nc-article#paper">my paper</a>.</p>
<div id="are-sepals-larger-or-smaller-than-petals-in-the-iris-data" class="section level2">
<h2>Are sepals larger or smaller than petals in the iris data?</h2>
<p>Sometimes you want to melt a “wide” data table which has several distinct pieces of information encoded in each column name. One example is the familiar iris data, which have flower part and measurement dimension encoded in each of four column names:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data.table</span>(iris)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             &lt;num&gt;       &lt;num&gt;        &lt;num&gt;       &lt;num&gt;    &lt;fctr&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1:          5.1         3.5          1.4         0.2    setosa</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2:          4.9         3.0          1.4         0.2    setosa</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3:          4.7         3.2          1.3         0.2    setosa</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4:          4.6         3.1          1.5         0.2    setosa</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5:          5.0         3.6          1.4         0.2    setosa</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                                                            </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 146:          6.7         3.0          5.2         2.3 virginica</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 147:          6.3         2.5          5.0         1.9 virginica</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 148:          6.5         3.0          5.2         2.0 virginica</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 149:          6.2         3.4          5.4         2.3 virginica</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 150:          5.9         3.0          5.1         1.8 virginica</span></span></code></pre></div>
<p>The goal in this section will be to convert these data into a format with a column for each flower part (<code>Sepal</code> and <code>Petal</code>) so we can easily make a facetted scatterplot to visually examine whether or not sepals or larger than petals. The easiest way to perform this conversion is with packages which provide a function for melting into multiple output columns:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>iris.parts <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nc=</span>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    iris,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">column=</span><span class="st">&quot;.*?&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">dim=</span><span class="st">&quot;.*&quot;</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">tidyr=</span><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>))tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    iris, </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;dim&quot;</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep=</span><span class="st">&quot;[.]&quot;</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">stats=</span>stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    iris,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">timevar=</span><span class="st">&quot;dim&quot;</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">varying=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep=</span><span class="st">&quot;.&quot;</span>),</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;data.table::melt&quot;</span><span class="ot">=</span><span class="fu">melt</span>(</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(iris),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">measure.vars=</span><span class="fu">patterns</span>(</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">Sepal=</span><span class="st">&quot;^Sepal&quot;</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">Petal=</span><span class="st">&quot;^Petal&quot;</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  )[<span class="fu">data.table</span>(</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable=</span><span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">dim=</span><span class="fu">c</span>(<span class="st">&quot;Length&quot;</span>, <span class="st">&quot;Width&quot;</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">on=</span>.(variable)],</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;cdata&quot;</span>))cdata<span class="sc">::</span><span class="fu">rowrecs_to_blocks</span>(</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    iris,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">controlTable=</span><span class="fu">data.frame</span>(</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">dim=</span><span class="fu">c</span>(<span class="st">&quot;Length&quot;</span>, <span class="st">&quot;Width&quot;</span>),</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">Petal=</span><span class="fu">c</span>(<span class="st">&quot;Petal.Length&quot;</span>, <span class="st">&quot;Petal.Width&quot;</span>),</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">Sepal=</span><span class="fu">c</span>(<span class="st">&quot;Sepal.Length&quot;</span>, <span class="st">&quot;Sepal.Width&quot;</span>),</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors=</span><span class="cn">FALSE</span>),</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnsToCopy=</span><span class="st">&quot;Species&quot;</span>))</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required namespace: cdata</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>iris.parts<span class="sc">$</span>nc</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Species    dim Petal Sepal</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         &lt;fctr&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1:    setosa Length   1.4   5.1</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2:    setosa Length   1.4   4.9</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3:    setosa Length   1.3   4.7</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4:    setosa Length   1.5   4.6</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5:    setosa Length   1.4   5.0</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                             </span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 296: virginica  Width   2.3   3.0</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 297: virginica  Width   1.9   2.5</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 298: virginica  Width   2.0   3.0</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 299: virginica  Width   2.3   3.4</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 300: virginica  Width   1.8   3.0</span></span></code></pre></div>
<p>It is clear from the code above that each package is capable of the conversions. However the syntax and level of explicitness varies:</p>
<ul>
<li><code>nc::capture_melt_multiple</code> requires a regular expression: (most implicit, least repetition)
<ul>
<li>any input column names that match the regex are melted.</li>
<li>values matched in the <code>column</code> group are used for the output column names.</li>
</ul></li>
<li><code>tidyr::pivot_longer</code> and <code>stats::reshape</code> require specification of the input columns to melt along with a separator.
<ul>
<li><code>stats::reshape</code> assumes the output columns names occur in the part of the input column name before the separator.</li>
<li><code>tidyr::pivot_longer</code> assumes the output columns occur in the part which corresponds to the <code>.value</code> element of the <code>names_to</code> argument.</li>
</ul></li>
<li><code>data.table::melt</code> requires a join to recover the <code>dim</code> output column.</li>
<li><code>cdata::rowrecs_to_blocks</code> requires explicit specification of a control table. (most explicit, most repetition)</li>
</ul>
<p>Any of the results can be visualized via:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">require</span>(ggplot2)){</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.spacing=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))<span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(dim <span class="sc">~</span> Species)<span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      Petal, Sepal),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>iris.parts<span class="sc">$</span>nc)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>It is clear from the plot above that sepals are larger than petals, for every measured flower.</p>
</div>
<div id="comparing-dimensions-in-iris-data" class="section level2">
<h2>Comparing dimensions in iris data</h2>
<p>What if we wanted to compare dimensions rather than parts?</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>iris.dims <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nc=</span>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    iris,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">part=</span><span class="st">&quot;.*?&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">column=</span><span class="st">&quot;.*&quot;</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">stats=</span>stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">structure</span>(iris, <span class="at">names=</span><span class="fu">sub</span>(<span class="st">&quot;(.*?)[.](.*)&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">2.</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">names</span>(iris))),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">timevar=</span><span class="st">&quot;part&quot;</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">varying=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep=</span><span class="st">&quot;.&quot;</span>))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>iris.dims<span class="sc">$</span>nc</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Species   part Length Width</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         &lt;fctr&gt; &lt;char&gt;  &lt;num&gt; &lt;num&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1:    setosa  Petal    1.4   0.2</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2:    setosa  Petal    1.4   0.2</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3:    setosa  Petal    1.3   0.2</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4:    setosa  Petal    1.5   0.2</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5:    setosa  Petal    1.4   0.2</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                              </span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 296: virginica  Sepal    6.7   3.0</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 297: virginica  Sepal    6.3   2.5</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 298: virginica  Sepal    6.5   3.0</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 299: virginica  Sepal    6.2   3.4</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 300: virginica  Sepal    5.9   3.0</span></span></code></pre></div>
<p>The code above shows that the syntax is mostly the same for this example. The biggest difference is for <code>stats::reshape</code> which assumes that each input column name is composed of (1) the output column name, (2) a delimiter, and (3) some additional information to be stored in the output column given by <code>timevar</code>. Therefore we need to pre-process column names using <code>sub</code> for it to work.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">require</span>(ggplot2)){</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.spacing=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))<span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(part <span class="sc">~</span> Species)<span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      Length, Width),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>iris.dims<span class="sc">$</span>nc)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>It is clear from the plot above that <code>Length</code> is larger than <code>Width</code> for every measured flower part.</p>
</div>
<div id="do-columns-need-to-be-sorted" class="section level2">
<h2>Do columns need to be sorted?</h2>
<p>Consider the following wide data set:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>TC <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">age.treatment=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex.control=</span><span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex.treatment=</span><span class="fu">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">age.control=</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">50</span>))</span></code></pre></div>
<p>It is clear from the column names how the data should be grouped when they are converted to tall format. However the columns do not appear in regular order (age is before sex for treatment, but age is after sex for control), which causes a problem for stats and data.table:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>input.list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;nc&quot;</span><span class="ot">=</span>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    TC,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">column=</span><span class="st">&quot;.*?&quot;</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">group=</span><span class="st">&quot;.*&quot;</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;cdata&quot;</span><span class="ot">=</span><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;cdata&quot;</span>))cdata<span class="sc">::</span><span class="fu">rowrecs_to_blocks</span>(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    TC,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">controlTable=</span><span class="fu">data.frame</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">group=</span><span class="fu">c</span>(<span class="st">&quot;treatment&quot;</span>, <span class="st">&quot;control&quot;</span>),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">age=</span><span class="fu">c</span>(<span class="st">&quot;age.treatment&quot;</span>, <span class="st">&quot;age.control&quot;</span>),</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">sex=</span><span class="fu">c</span>(<span class="st">&quot;sex.treatment&quot;</span>, <span class="st">&quot;sex.control&quot;</span>),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors=</span><span class="cn">FALSE</span>)),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;data.table&quot;</span><span class="ot">=</span>data.table<span class="sc">::</span><span class="fu">melt</span>(TC, <span class="at">measure.vars=</span><span class="fu">patterns</span>(</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">age=</span><span class="st">&quot;age&quot;</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex=</span><span class="st">&quot;sex&quot;</span>)),</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;stats&quot;</span><span class="ot">=</span>stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    TC,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">varying=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction=</span><span class="st">&quot;long&quot;</span>),</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tidyr&quot;</span><span class="ot">=</span><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>))tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    TC, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;group&quot;</span>),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep=</span><span class="st">&quot;[.]&quot;</span>))</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>output.list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(pkg <span class="cf">in</span> <span class="fu">names</span>(input.list)){</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  df.or.null <span class="ot">&lt;-</span> input.list[[pkg]]</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.data.frame</span>(df.or.null)){</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    output.list[[pkg]] <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(df.or.null)[<span class="fu">order</span>(age)]</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>output.list</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $nc</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        group   age    sex</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       &lt;char&gt; &lt;num&gt; &lt;char&gt;</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1: treatment     1      F</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: treatment     5      F</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:   control    10      M</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:   control    50      M</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $cdata</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        group   age    sex</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       &lt;char&gt; &lt;num&gt; &lt;char&gt;</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1: treatment     1      F</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: treatment     5      F</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:   control    10      M</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:   control    50      M</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $data.table</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    variable   age    sex</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;fctr&gt; &lt;num&gt; &lt;char&gt;</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:        1     1      M</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2:        1     5      M</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:        2    10      F</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:        2    50      F</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $stats</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         time   age    sex    id</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       &lt;char&gt; &lt;num&gt; &lt;char&gt; &lt;int&gt;</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1: treatment     1      M     1</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: treatment     5      M     2</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:   control    10      F     1</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:   control    50      F     2</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $tidyr</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        group   age    sex</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       &lt;char&gt; &lt;num&gt; &lt;char&gt;</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1: treatment     1      F</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: treatment     5      F</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:   control    10      M</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:   control    50      M</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(output.list, <span class="cf">function</span>(DT)<span class="fu">identical</span>(DT<span class="sc">$</span>sex, <span class="fu">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>)))</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         nc      cdata data.table      stats      tidyr </span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       TRUE       TRUE      FALSE      FALSE       TRUE</span></span></code></pre></div>
<p>In conclusion, when the input column names to melt do not appear in the same order across groups or output columns, then the correct tall data can be computed using one of <code>nc::capture_melt_multiple</code>, <code>tidyr::pivot_longer</code>, <code>cdata::rowrecs_to_blocks</code>.</p>
</div>
<div id="melting-into-a-single-output-column-who-data" class="section level2">
<h2>Melting into a single output column, who data</h2>
<p>Another data set where it is useful to do column name pattern matching followed by melting is the World Health Organization data:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>)){</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data</span>(who, <span class="at">package=</span><span class="st">&quot;tidyr&quot;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  who <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id=</span><span class="dv">1</span>, <span class="at">new_sp_m5564=</span><span class="dv">2</span>, <span class="at">newrel_f65=</span><span class="dv">3</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(who)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;country&quot;      &quot;iso2&quot;         &quot;iso3&quot;         &quot;year&quot;         &quot;new_sp_m014&quot; </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;new_sp_m1524&quot; &quot;new_sp_m2534&quot; &quot;new_sp_m3544&quot; &quot;new_sp_m4554&quot; &quot;new_sp_m5564&quot;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11] &quot;new_sp_m65&quot;   &quot;new_sp_f014&quot;  &quot;new_sp_f1524&quot; &quot;new_sp_f2534&quot; &quot;new_sp_f3544&quot;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [16] &quot;new_sp_f4554&quot; &quot;new_sp_f5564&quot; &quot;new_sp_f65&quot;   &quot;new_sn_m014&quot;  &quot;new_sn_m1524&quot;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21] &quot;new_sn_m2534&quot; &quot;new_sn_m3544&quot; &quot;new_sn_m4554&quot; &quot;new_sn_m5564&quot; &quot;new_sn_m65&quot;  </span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [26] &quot;new_sn_f014&quot;  &quot;new_sn_f1524&quot; &quot;new_sn_f2534&quot; &quot;new_sn_f3544&quot; &quot;new_sn_f4554&quot;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [31] &quot;new_sn_f5564&quot; &quot;new_sn_f65&quot;   &quot;new_ep_m014&quot;  &quot;new_ep_m1524&quot; &quot;new_ep_m2534&quot;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [36] &quot;new_ep_m3544&quot; &quot;new_ep_m4554&quot; &quot;new_ep_m5564&quot; &quot;new_ep_m65&quot;   &quot;new_ep_f014&quot; </span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [41] &quot;new_ep_f1524&quot; &quot;new_ep_f2534&quot; &quot;new_ep_f3544&quot; &quot;new_ep_f4554&quot; &quot;new_ep_f5564&quot;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [46] &quot;new_ep_f65&quot;   &quot;newrel_m014&quot;  &quot;newrel_m1524&quot; &quot;newrel_m2534&quot; &quot;newrel_m3544&quot;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [51] &quot;newrel_m4554&quot; &quot;newrel_m5564&quot; &quot;newrel_m65&quot;   &quot;newrel_f014&quot;  &quot;newrel_f1524&quot;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [56] &quot;newrel_f2534&quot; &quot;newrel_f3544&quot; &quot;newrel_f4554&quot; &quot;newrel_f5564&quot; &quot;newrel_f65&quot;</span></span></code></pre></div>
<p>Each column which starts with <code>new</code> has three distinct pieces of information encoded in its name: diagnosis type (e.g. sp or rel), gender (m or f), and age range (e.g. 5564 or 1524). We would like to use a regex to match these column names, then using the matching columns as measure.vars in a melt, then join the two results. The most convenient way to do that is via:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>who.chr.list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nc=</span>nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    who,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;new_?&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">diagnosis=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;_&quot;</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender=</span><span class="st">&quot;.&quot;</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ages=</span><span class="st">&quot;.*&quot;</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tidyr=</span><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>))tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    who,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    new_sp_m014<span class="sc">:</span>newrel_f65,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&quot;diagnosis&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;ages&quot;</span>),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern=</span><span class="st">&quot;new_?(.*)_(.)(.*)&quot;</span>))</span></code></pre></div>
<p>Note the result includes additional column <code>value</code> which contains the melted data. There is also a column for each capture group in the specified pattern. The following example shows how to rename the <code>value</code> column, remove missing values, and use numeric type conversion functions:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>who.pattern <span class="ot">&lt;-</span> <span class="st">&quot;new_?(.*)_(.)((0|[0-9]{2})([0-9]{0,2}))&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>as.numeric.Inf <span class="ot">&lt;-</span> <span class="cf">function</span>(y)<span class="fu">ifelse</span>(y<span class="sc">==</span><span class="st">&quot;&quot;</span>, <span class="cn">Inf</span>, <span class="fu">as.numeric</span>(y))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>who.typed.list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nc=</span>nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    who,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;new_?&quot;</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">diagnosis=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;_&quot;</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender=</span><span class="st">&quot;.&quot;</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ages=</span><span class="fu">list</span>(</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin.num=</span><span class="st">&quot;0|[0-9]{2}&quot;</span>, as.numeric,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax.num=</span><span class="st">&quot;[0-9]{0,2}&quot;</span>, as.numeric.Inf),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">value.name=</span><span class="st">&quot;count&quot;</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">tidyr=</span><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>))<span class="fu">try</span>(tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    who,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols=</span><span class="fu">grep</span>(who.pattern, <span class="fu">names</span>(who)),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_transform=</span><span class="fu">list</span>(</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin.num=</span>as.numeric,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax.num=</span>as.numeric.Inf),</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&quot;diagnosis&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;ages&quot;</span>, <span class="st">&quot;ymin.num&quot;</span>, <span class="st">&quot;ymax.num&quot;</span>),</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern=</span>who.pattern,</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_drop_na=</span><span class="cn">TRUE</span>,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to=</span><span class="st">&quot;count&quot;</span>)))</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(who.typed.list)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 2</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ nc   :Classes &#39;data.table&#39; and &#39;data.frame&#39;:  76046 obs. of  10 variables:</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ country  : chr [1:76046] &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; ...</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ iso2     : chr [1:76046] &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; ...</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ iso3     : chr [1:76046] &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; ...</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ year     : num [1:76046] 1997 1998 1999 2000 2001 ...</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ diagnosis: chr [1:76046] &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; ...</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ gender   : chr [1:76046] &quot;m&quot; &quot;m&quot; &quot;m&quot; &quot;m&quot; ...</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ ages     : chr [1:76046] &quot;014&quot; &quot;014&quot; &quot;014&quot; &quot;014&quot; ...</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ ymin.num : num [1:76046] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ ymax.num : num [1:76046] 14 14 14 14 14 14 14 14 14 14 ...</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ count    : num [1:76046] 0 30 8 52 129 90 127 139 151 193 ...</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt; </span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ tidyr: tibble [76,046 × 10] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ country  : chr [1:76046] &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; ...</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ iso2     : chr [1:76046] &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; ...</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ iso3     : chr [1:76046] &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; ...</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ year     : num [1:76046] 1997 1997 1997 1997 1997 ...</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ diagnosis: chr [1:76046] &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; ...</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ gender   : chr [1:76046] &quot;m&quot; &quot;m&quot; &quot;m&quot; &quot;m&quot; ...</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ ages     : chr [1:76046] &quot;014&quot; &quot;1524&quot; &quot;2534&quot; &quot;3544&quot; ...</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ ymin.num : num [1:76046] 0 15 25 35 45 55 65 0 15 25 ...</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ ymax.num : num [1:76046] 14 24 34 44 54 ...</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ count    : num [1:76046] 0 10 6 3 5 2 0 5 38 36 ...</span></span></code></pre></div>
<p>The result above shows that <code>nc::capture_melt_single</code> (1) makes it easier to define complex patterns (2) supports type conversion without a post-processing step, and (3) reduces repetition in user code. There are several sources of repetition in <code>tidyr</code> code:</p>
<ul>
<li>Syntax of type conversion:
<ul>
<li>capture group name <code>ymin.num</code> appears only once for <code>nc</code> but twice for <code>tidyr</code>.</li>
<li>capture group name <code>ymax.chr</code> appears only once for <code>nc</code> but three times for <code>tidyr</code>.</li>
</ul></li>
<li>Specification of input data and columns to melt:
<ul>
<li>input data table <code>who</code> appears only once for <code>nc</code> but twice for <code>tidyr</code>.</li>
<li>pattern for input columns to melt appears only once for <code>nc</code> but twice for <code>tidyr</code>.</li>
</ul></li>
</ul>
<p>Other packages for doing this include:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>)){</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  gather.result <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">gather</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    who,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;count&quot;</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grep</span>(who.pattern, <span class="fu">names</span>(who)),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  extract.result <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">extract</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    gather.result,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;diagnosis&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;ages&quot;</span>, <span class="st">&quot;ymin.int&quot;</span>, <span class="st">&quot;ymax.int&quot;</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    who.pattern,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">convert=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  transform.result <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">transform</span>(</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    extract.result,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin.num=</span><span class="fu">as.numeric</span>(ymin.int),</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax.num=</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(ymax.int), <span class="cn">Inf</span>, <span class="fu">as.numeric</span>(ymax.int)))</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>(transform.result)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    76046 obs. of  12 variables:</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ country  : chr  &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; ...</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ iso2     : chr  &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; ...</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ iso3     : chr  &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; ...</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ year     : num  1997 1998 1999 2000 2001 ...</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ diagnosis: chr  &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; ...</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ gender   : chr  &quot;m&quot; &quot;m&quot; &quot;m&quot; &quot;m&quot; ...</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ ages     : int  14 14 14 14 14 14 14 14 14 14 ...</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ ymin.int : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ ymax.int : int  14 14 14 14 14 14 14 14 14 14 ...</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ count    : num  0 30 8 52 129 90 127 139 151 193 ...</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ ymin.num : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ ymax.num : num  14 14 14 14 14 14 14 14 14 14 ...</span></span></code></pre></div>
<p>Note that <code>tidyr::gather</code> requires two post-processing steps, which cause the same two types of repetition as <code>tidyr::pivot_longer</code>:</p>
<ul>
<li>Syntax of type conversion: <code>base::transform</code> is used for converting age range variables to numeric, since default types are int with <code>convert=TRUE</code>.</li>
<li>Specification of input data and columns to melt: <code>tidyr::extract</code> is used to convert the melted column into several output columns; this results in repetition in the code because the regex is also used to define the columns to melt/gather.</li>
</ul>
<p>The <code>reshape2</code> package suffers from the same two issues:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>reshape2.result <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;reshape2&quot;</span>)){</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  reshape2<span class="sc">:::</span><span class="fu">melt.data.frame</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    who,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">measure.vars=</span><span class="fu">grep</span>(who.pattern, <span class="fu">names</span>(who)),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm=</span><span class="cn">TRUE</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">value.name=</span><span class="st">&quot;count&quot;</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required namespace: reshape2</span></span></code></pre></div>
<p>Interestingly, <code>data.table::patterns</code> can be used to avoid repeating the data set name, <code>who</code>. However it supports neither type conversion nor regex capture groups.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dt.result <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">melt.data.table</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>(who),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">measure.vars=</span><span class="fu">patterns</span>(who.pattern),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm=</span><span class="cn">TRUE</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.name=</span><span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<p>Neither cdata nor stats provide an na.rm option:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>who.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(who)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>is.varying <span class="ot">&lt;-</span> <span class="fu">grepl</span>(who.pattern, <span class="fu">names</span>(who))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(who.df)[is.varying] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;count.&quot;</span>, <span class="fu">names</span>(who)[is.varying])</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>stats.result <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  who.df,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar=</span><span class="st">&quot;variable&quot;</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying=</span>is.varying)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;cdata&quot;</span>)){</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  cdata.result <span class="ot">&lt;-</span> cdata<span class="sc">::</span><span class="fu">rowrecs_to_blocks</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    who, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    cdata<span class="sc">::</span><span class="fu">build_unpivot_control</span>(</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;count&quot;</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grep</span>(who.pattern, <span class="fu">names</span>(who), <span class="at">value=</span><span class="cn">TRUE</span>)),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnsToCopy=</span><span class="fu">grep</span>(who.pattern, <span class="fu">names</span>(who), <span class="at">value=</span><span class="cn">TRUE</span>, <span class="at">invert=</span><span class="cn">TRUE</span>))</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="melting-a-wider-iris-back-to-original" class="section level2">
<h2>Melting a wider iris back to original</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Example 1: melting a wider iris data back to original.</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>iris.dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(iris),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  iris[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Species=</span><span class="fu">paste</span>(iris<span class="sc">$</span>Species))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(iris.dt)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          i Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt;        &lt;num&gt;       &lt;num&gt;        &lt;num&gt;       &lt;num&gt;    &lt;char&gt;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1:     1          5.1         3.5          1.4         0.2    setosa</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2:     2          4.9         3.0          1.4         0.2    setosa</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3:     3          4.7         3.2          1.3         0.2    setosa</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4:     4          4.6         3.1          1.5         0.2    setosa</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5:     5          5.0         3.6          1.4         0.2    setosa</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                                                                  </span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 146:   146          6.7         3.0          5.2         2.3 virginica</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 147:   147          6.3         2.5          5.0         1.9 virginica</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 148:   148          6.5         3.0          5.2         2.0 virginica</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 149:   149          6.2         3.4          5.4         2.3 virginica</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 150:   150          5.9         3.0          5.1         1.8 virginica</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="do">## what if we had two observations on each row?</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>iris.rand <span class="ot">&lt;-</span> iris.dt[<span class="fu">sample</span>(.N)]</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>iris.wide <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">treatment=</span>iris.rand[<span class="dv">1</span><span class="sc">:</span><span class="dv">75</span>], <span class="at">control=</span>iris.rand[<span class="dv">76</span><span class="sc">:</span><span class="dv">150</span>])</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(iris.wide, <span class="at">topn=</span><span class="dv">2</span>, <span class="at">nrows=</span><span class="dv">10</span>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     treatment.i treatment.Sepal.Length treatment.Sepal.Width treatment.Petal.Length</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           &lt;int&gt;                  &lt;num&gt;                 &lt;num&gt;                  &lt;num&gt;</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:          68                    5.8                   2.7                    4.1</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2:         129                    6.4                   2.8                    5.6</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ---                                                                                </span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 74:          91                    5.5                   2.6                    4.4</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 75:          64                    6.1                   2.9                    4.7</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     treatment.Petal.Width treatment.Species control.i control.Sepal.Length</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                     &lt;num&gt;            &lt;char&gt;     &lt;int&gt;                &lt;num&gt;</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:                   1.0        versicolor        60                  5.2</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2:                   2.1         virginica       113                  6.8</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ---                                                                       </span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 74:                   1.2        versicolor        57                  6.3</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 75:                   1.4        versicolor        72                  6.1</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     control.Sepal.Width control.Petal.Length control.Petal.Width control.Species</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   &lt;num&gt;                &lt;num&gt;               &lt;num&gt;          &lt;char&gt;</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:                 2.7                  3.9                 1.4      versicolor</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2:                 3.0                  5.5                 2.1       virginica</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ---                                                                             </span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 74:                 3.3                  4.7                 1.6      versicolor</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 75:                 2.8                  4.0                 1.3      versicolor</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a><span class="do">## This is the usual data.table syntax for getting the original iris back.</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>iris.melted <span class="ot">&lt;-</span> <span class="fu">melt</span>(iris.wide, <span class="at">value.factor=</span><span class="cn">TRUE</span>, <span class="at">measure.vars =</span> <span class="fu">patterns</span>(</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">i=</span><span class="st">&quot;i$&quot;</span>,</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sepal.Length=</span><span class="st">&quot;Sepal.Length$&quot;</span>,</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sepal.Width=</span><span class="st">&quot;Sepal.Width$&quot;</span>,</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">Petal.Length=</span><span class="st">&quot;Petal.Length$&quot;</span>,</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">Petal.Width=</span><span class="st">&quot;Petal.Width$&quot;</span>,</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">Species=</span><span class="st">&quot;Species$&quot;</span>))</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(iris.melted[<span class="fu">order</span>(i), <span class="fu">names</span>(iris.dt), <span class="at">with=</span><span class="cn">FALSE</span>], iris.dt)</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a><span class="do">## nc can do the same thing -- you must define an R argument named</span></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a><span class="do">## column, and another named argument which identifies each group.</span></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>(nc.melted <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>  iris.wide,</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">group=</span><span class="st">&quot;[^.]+&quot;</span>,</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;.*&quot;</span>))</span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          group Petal.Length Petal.Width Sepal.Length Sepal.Width    Species     i</span></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         &lt;char&gt;        &lt;num&gt;       &lt;num&gt;        &lt;num&gt;       &lt;num&gt;     &lt;char&gt; &lt;int&gt;</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1:   control          3.9         1.4          5.2         2.7 versicolor    60</span></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2:   control          5.5         2.1          6.8         3.0  virginica   113</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3:   control          5.6         1.4          6.1         2.6  virginica   135</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   4:   control          1.5         0.1          4.9         3.1     setosa    10</span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   5:   control          1.4         0.2          5.1         3.5     setosa     1</span></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ---                                                                             </span></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 146: treatment          1.6         0.2          4.8         3.1     setosa    31</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 147: treatment          1.3         0.4          5.4         3.9     setosa    17</span></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 148: treatment          5.4         2.1          6.9         3.1  virginica   140</span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 149: treatment          4.4         1.2          5.5         2.6 versicolor    91</span></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 150: treatment          4.7         1.4          6.1         2.9 versicolor    64</span></span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(nc.melted[<span class="fu">order</span>(i), <span class="fu">names</span>(iris.dt), <span class="at">with=</span><span class="cn">FALSE</span>], iris.dt)</span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a><span class="do">## This is how we do it using stats::reshape.</span></span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>iris.wide.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(iris.wide)</span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(iris.wide.df) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">&quot;(.*?)[.](.*)&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">2_</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">names</span>(iris.wide))</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>iris.reshaped <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>  iris.wide.df,</span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar=</span><span class="st">&quot;group&quot;</span>,</span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying=</span><span class="fu">names</span>(iris.wide.df),</span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">data.table</span>(iris.reshaped[, <span class="fu">names</span>(iris.dt)])[<span class="fu">order</span>(i)], iris.dt)</span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a><span class="do">## get the parts columns and groups -- is there any difference</span></span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a><span class="do">## between groups? of course not!</span></span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>parts.wide <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>  iris.wide,</span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">group=</span><span class="st">&quot;.*?&quot;</span>,</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;.*?&quot;</span>,</span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">dim=</span><span class="st">&quot;.*&quot;</span>)</span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">require</span>(<span class="st">&quot;ggplot2&quot;</span>)){</span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.spacing=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))<span class="sc">+</span></span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(dim <span class="sc">~</span> group)<span class="sc">+</span></span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>      Petal, Sepal),</span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>parts.wide)</span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="lots-of-column-types" class="section level2">
<h2>Lots of column types</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Example 2. Lots of column types, from example(melt.data.table).</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>DT <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">i_1 =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="cn">NA</span>),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">i_2 =</span> <span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">f_1 =</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="cn">NA</span>), <span class="dv">6</span>, <span class="cn">TRUE</span>)),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">f_2 =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;z&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;x&quot;</span>), <span class="at">ordered=</span><span class="cn">TRUE</span>),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">c_1 =</span> <span class="fu">sample</span>(<span class="fu">c</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="cn">NA</span>), <span class="dv">6</span>, <span class="cn">TRUE</span>),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_1 =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="cn">NA</span>,<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">origin=</span><span class="st">&quot;2013-09-01&quot;</span>),</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_2 =</span> <span class="fu">as.Date</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">origin=</span><span class="st">&quot;2012-01-01&quot;</span>))</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="do">## add a couple of list cols</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>DT[, l_1 <span class="sc">:</span><span class="er">=</span> DT[, <span class="fu">list</span>(<span class="at">c=</span><span class="fu">list</span>(<span class="fu">rep</span>(i_1, <span class="fu">sample</span>(<span class="dv">5</span>,<span class="dv">1</span>)))), by <span class="ot">=</span> i_1]<span class="sc">$</span>c]</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>DT[, l_2 <span class="sc">:</span><span class="er">=</span> DT[, <span class="fu">list</span>(<span class="at">c=</span><span class="fu">list</span>(<span class="fu">rep</span>(c_1, <span class="fu">sample</span>(<span class="dv">5</span>,<span class="dv">1</span>)))), by <span class="ot">=</span> i_1]<span class="sc">$</span>c]</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="do">## original DT syntax is quite repetitive.</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">melt</span>(DT, <span class="at">measure=</span><span class="fu">patterns</span>(</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">i=</span><span class="st">&quot;^i&quot;</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">f=</span><span class="st">&quot;^f&quot;</span>,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">d=</span><span class="st">&quot;^d&quot;</span>,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">l=</span><span class="st">&quot;^l&quot;</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        c_1 variable     i      f          d              l</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt;   &lt;fctr&gt; &lt;int&gt; &lt;char&gt;     &lt;Date&gt;         &lt;list&gt;</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:      a        1     1      a 2013-09-02        1,1,1,1</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2:      a        1     2      a 2013-09-03            2,2</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3:   &lt;NA&gt;        1     3   &lt;NA&gt; 2013-09-04              3</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4:      b        1     4      a       &lt;NA&gt;          4,4,4</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5:      b        1     5      c 2013-09-05              5</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6:   &lt;NA&gt;        1    NA      c 2013-09-06             NA</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7:      a        2    NA      z 2012-01-07        a,a,a,a</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8:      a        2     6      a 2012-01-06      a,a,a,a,a</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9:   &lt;NA&gt;        2     7      x 2012-01-05             NA</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10:      b        2     8      c 2012-01-04          b,b,b</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11:      b        2     9      x 2012-01-03        b,b,b,b</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12:   &lt;NA&gt;        2    10      x 2012-01-02 NA,NA,NA,NA,NA</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="do">## nc syntax uses a single regex rather than four.</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>  DT,</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;^[^c]&quot;</span>,</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;_&quot;</span>,</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">number=</span><span class="st">&quot;[12]&quot;</span>)</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        c_1 number          d      f     i              l</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt; &lt;char&gt;     &lt;Date&gt; &lt;char&gt; &lt;int&gt;         &lt;list&gt;</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:      a      1 2013-09-02      a     1        1,1,1,1</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2:      a      1 2013-09-03      a     2            2,2</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3:   &lt;NA&gt;      1 2013-09-04   &lt;NA&gt;     3              3</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4:      b      1       &lt;NA&gt;      a     4          4,4,4</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5:      b      1 2013-09-05      c     5              5</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6:   &lt;NA&gt;      1 2013-09-06      c    NA             NA</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7:      a      2 2012-01-07      z    NA        a,a,a,a</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8:      a      2 2012-01-06      a     6      a,a,a,a,a</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9:   &lt;NA&gt;      2 2012-01-05      x     7             NA</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10:      b      2 2012-01-04      c     8          b,b,b</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11:      b      2 2012-01-03      x     9        b,b,b,b</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12:   &lt;NA&gt;      2 2012-01-02      x    10 NA,NA,NA,NA,NA</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a><span class="do">## id.vars can be specified using original DT syntax.</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="fu">melt</span>(DT, <span class="at">id=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">measure=</span><span class="fu">patterns</span>(</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">f=</span><span class="st">&quot;^f&quot;</span>,</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">l=</span><span class="st">&quot;^l&quot;</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       i_1   i_2 variable      f              l</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;int&gt; &lt;int&gt;   &lt;fctr&gt; &lt;char&gt;         &lt;list&gt;</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:     1    NA        1      a        1,1,1,1</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2:     2     6        1      a            2,2</span></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3:     3     7        1   &lt;NA&gt;              3</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4:     4     8        1      a          4,4,4</span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5:     5     9        1      c              5</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6:    NA    10        1      c             NA</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7:     1    NA        2      z        a,a,a,a</span></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8:     2     6        2      a      a,a,a,a,a</span></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9:     3     7        2      x             NA</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10:     4     8        2      c          b,b,b</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11:     5     9        2      x        b,b,b,b</span></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12:    NA    10        2      x NA,NA,NA,NA,NA</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>  DT,</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;^[fl]&quot;</span>,</span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;_&quot;</span>,</span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">number=</span><span class="st">&quot;[12]&quot;</span>)</span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       i_1   i_2    c_1        d_1        d_2 number      f              l</span></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;int&gt; &lt;int&gt; &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;char&gt; &lt;char&gt;         &lt;list&gt;</span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:     1    NA      a 2013-09-02 2012-01-07      1      a        1,1,1,1</span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2:     2     6      a 2013-09-03 2012-01-06      1      a            2,2</span></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3:     3     7   &lt;NA&gt; 2013-09-04 2012-01-05      1   &lt;NA&gt;              3</span></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4:     4     8      b       &lt;NA&gt; 2012-01-04      1      a          4,4,4</span></span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5:     5     9      b 2013-09-05 2012-01-03      1      c              5</span></span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6:    NA    10   &lt;NA&gt; 2013-09-06 2012-01-02      1      c             NA</span></span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7:     1    NA      a 2013-09-02 2012-01-07      2      z        a,a,a,a</span></span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8:     2     6      a 2013-09-03 2012-01-06      2      a      a,a,a,a,a</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9:     3     7   &lt;NA&gt; 2013-09-04 2012-01-05      2      x             NA</span></span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10:     4     8      b       &lt;NA&gt; 2012-01-04      2      c          b,b,b</span></span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11:     5     9      b 2013-09-05 2012-01-03      2      x        b,b,b,b</span></span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12:    NA    10   &lt;NA&gt; 2013-09-06 2012-01-02      2      x NA,NA,NA,NA,NA</span></span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a><span class="do">## reshape does not support list columns.</span></span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a><span class="fu">reshape</span>(</span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a>  DT,</span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying=</span><span class="fu">grep</span>(<span class="st">&quot;^[fid]&quot;</span>, <span class="fu">names</span>(DT)),</span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">&quot;_&quot;</span>,</span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar=</span><span class="st">&quot;number&quot;</span>)</span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        c_1     l_1            l_2 number     i     f          d    id</span></span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt;  &lt;list&gt;         &lt;list&gt;  &lt;num&gt; &lt;int&gt; &lt;ord&gt;     &lt;Date&gt; &lt;int&gt;</span></span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:      a 1,1,1,1        a,a,a,a      1     1     a 2013-09-02     1</span></span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2:      a     2,2      a,a,a,a,a      1     2     a 2013-09-03     2</span></span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3:   &lt;NA&gt;       3             NA      1     3  &lt;NA&gt; 2013-09-04     3</span></span>
<span id="cb17-110"><a href="#cb17-110" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4:      b   4,4,4          b,b,b      1     4     a       &lt;NA&gt;     4</span></span>
<span id="cb17-111"><a href="#cb17-111" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5:      b       5        b,b,b,b      1     5     c 2013-09-05     5</span></span>
<span id="cb17-112"><a href="#cb17-112" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6:   &lt;NA&gt;      NA NA,NA,NA,NA,NA      1    NA     c 2013-09-06     6</span></span>
<span id="cb17-113"><a href="#cb17-113" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7:      a 1,1,1,1        a,a,a,a      2    NA     z 2012-01-07     1</span></span>
<span id="cb17-114"><a href="#cb17-114" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8:      a     2,2      a,a,a,a,a      2     6     a 2012-01-06     2</span></span>
<span id="cb17-115"><a href="#cb17-115" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9:   &lt;NA&gt;       3             NA      2     7     x 2012-01-05     3</span></span>
<span id="cb17-116"><a href="#cb17-116" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10:      b   4,4,4          b,b,b      2     8     c 2012-01-04     4</span></span>
<span id="cb17-117"><a href="#cb17-117" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11:      b       5        b,b,b,b      2     9     x 2012-01-03     5</span></span>
<span id="cb17-118"><a href="#cb17-118" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12:   &lt;NA&gt;      NA NA,NA,NA,NA,NA      2    10     x 2012-01-02     6</span></span>
<span id="cb17-119"><a href="#cb17-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-120"><a href="#cb17-120" aria-hidden="true" tabindex="-1"></a><span class="do">## tidyr does, but errors for combining ordered and un-ordered factors.</span></span>
<span id="cb17-121"><a href="#cb17-121" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>)){</span>
<span id="cb17-122"><a href="#cb17-122" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb17-123"><a href="#cb17-123" aria-hidden="true" tabindex="-1"></a>    DT, <span class="fu">grep</span>(<span class="st">&quot;[cf]&quot;</span>, <span class="fu">names</span>(DT), <span class="at">invert=</span><span class="cn">TRUE</span>),</span>
<span id="cb17-124"><a href="#cb17-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern=</span><span class="st">&quot;(.)_(.)&quot;</span>,</span>
<span id="cb17-125"><a href="#cb17-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;number&quot;</span>))</span>
<span id="cb17-126"><a href="#cb17-126" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-127"><a href="#cb17-127" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 7</span></span>
<span id="cb17-128"><a href="#cb17-128" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    f_1   f_2   c_1   number     i d          l        </span></span>
<span id="cb17-129"><a href="#cb17-129" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;fct&gt; &lt;ord&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;date&gt;     &lt;list&gt;   </span></span>
<span id="cb17-130"><a href="#cb17-130" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 a     z     a     1          1 2013-09-02 &lt;int [4]&gt;</span></span>
<span id="cb17-131"><a href="#cb17-131" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 a     z     a     2         NA 2012-01-07 &lt;chr [4]&gt;</span></span>
<span id="cb17-132"><a href="#cb17-132" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 a     a     a     1          2 2013-09-03 &lt;int [2]&gt;</span></span>
<span id="cb17-133"><a href="#cb17-133" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 a     a     a     2          6 2012-01-06 &lt;chr [5]&gt;</span></span>
<span id="cb17-134"><a href="#cb17-134" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 &lt;NA&gt;  x     &lt;NA&gt;  1          3 2013-09-04 &lt;int [1]&gt;</span></span>
<span id="cb17-135"><a href="#cb17-135" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 &lt;NA&gt;  x     &lt;NA&gt;  2          7 2012-01-05 &lt;chr [1]&gt;</span></span>
<span id="cb17-136"><a href="#cb17-136" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 a     c     b     1          4 NA         &lt;int [3]&gt;</span></span>
<span id="cb17-137"><a href="#cb17-137" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 a     c     b     2          8 2012-01-04 &lt;chr [3]&gt;</span></span>
<span id="cb17-138"><a href="#cb17-138" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 c     x     b     1          5 2013-09-05 &lt;int [1]&gt;</span></span>
<span id="cb17-139"><a href="#cb17-139" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 c     x     b     2          9 2012-01-03 &lt;chr [4]&gt;</span></span>
<span id="cb17-140"><a href="#cb17-140" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 c     x     &lt;NA&gt;  1         NA 2013-09-06 &lt;int [1]&gt;</span></span>
<span id="cb17-141"><a href="#cb17-141" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12 c     x     &lt;NA&gt;  2         10 2012-01-02 &lt;chr [5]&gt;</span></span></code></pre></div>
</div>
<div id="family-data" class="section level2">
<h2>family data</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Example 3, three children, one family per row, from data.table</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="do">## vignette.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>family.dt <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="at">text=</span><span class="st">&quot;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="st">family_id age_mother dob_child1 dob_child2 dob_child3 gender_child1 gender_child2 gender_child3</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="st">1         30 1998-11-26 2000-01-29         NA             1             2            NA</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="st">2         27 1996-06-22         NA         NA             2            NA            NA</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="st">3         26 2002-07-11 2004-04-05 2007-09-02             2             2             1</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="st">4         32 2004-10-10 2009-08-27 2012-07-21             1             1             1</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="st">5         29 2000-12-05 2005-02-28         NA             2             1            NA&quot;</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>(children.melt <span class="ot">&lt;-</span> <span class="fu">melt</span>(family.dt, <span class="at">measure =</span> <span class="fu">patterns</span>(</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">dob=</span><span class="st">&quot;^dob&quot;</span>, <span class="at">gender=</span><span class="st">&quot;^gender&quot;</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>), <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">variable.factor=</span><span class="cn">FALSE</span>))</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     family_id age_mother variable        dob gender</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         &lt;int&gt;      &lt;int&gt;   &lt;char&gt;     &lt;IDat&gt;  &lt;int&gt;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:         1         30        1 1998-11-26      1</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2:         2         27        1 1996-06-22      2</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3:         3         26        1 2002-07-11      2</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4:         4         32        1 2004-10-10      1</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5:         5         29        1 2000-12-05      2</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6:         1         30        2 2000-01-29      2</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7:         3         26        2 2004-04-05      2</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8:         4         32        2 2009-08-27      1</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9:         5         29        2 2005-02-28      1</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10:         3         26        3 2007-09-02      1</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11:         4         32        3 2012-07-21      1</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="do">## nc::field can be used to define group name and pattern at the</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="do">## same time, to avoid repetitive code.</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>(children.nc <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  family.dt,</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;[^_]+&quot;</span>,</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;_&quot;</span>,</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  nc<span class="sc">::</span><span class="fu">field</span>(<span class="st">&quot;child&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;[1-3]&quot;</span>),</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     family_id age_mother  child        dob gender</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         &lt;int&gt;      &lt;int&gt; &lt;char&gt;     &lt;IDat&gt;  &lt;int&gt;</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:         1         30      1 1998-11-26      1</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2:         2         27      1 1996-06-22      2</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3:         3         26      1 2002-07-11      2</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4:         4         32      1 2004-10-10      1</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5:         5         29      1 2000-12-05      2</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6:         1         30      2 2000-01-29      2</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7:         3         26      2 2004-04-05      2</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8:         4         32      2 2009-08-27      1</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9:         5         29      2 2005-02-28      1</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10:         3         26      3 2007-09-02      1</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11:         4         32      3 2012-07-21      1</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a><span class="do">## reshape works too.</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>  family.dt,</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying=</span><span class="fu">grep</span>(<span class="st">&quot;child&quot;</span>, <span class="fu">names</span>(family.dt)),</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">&quot;_&quot;</span>,</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar=</span><span class="st">&quot;child.str&quot;</span>)</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     family_id age_mother child.str        dob gender    id</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         &lt;int&gt;      &lt;int&gt;    &lt;char&gt;     &lt;IDat&gt;  &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:         1         30    child1 1998-11-26      1     1</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2:         2         27    child1 1996-06-22      2     2</span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3:         3         26    child1 2002-07-11      2     3</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4:         4         32    child1 2004-10-10      1     4</span></span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5:         5         29    child1 2000-12-05      2     5</span></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6:         1         30    child2 2000-01-29      2     1</span></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7:         2         27    child2       &lt;NA&gt;     NA     2</span></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8:         3         26    child2 2004-04-05      2     3</span></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9:         4         32    child2 2009-08-27      1     4</span></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10:         5         29    child2 2005-02-28      1     5</span></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11:         1         30    child3       &lt;NA&gt;     NA     1</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12:         2         27    child3       &lt;NA&gt;     NA     2</span></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13:         3         26    child3 2007-09-02      1     3</span></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14:         4         32    child3 2012-07-21      1     4</span></span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15:         5         29    child3       &lt;NA&gt;     NA     5</span></span></code></pre></div>
</div>
<div id="histogram-of-iris" class="section level2">
<h2>histogram of iris</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Comparison with base R. 1. mfrow means parts on rows, mfcol means</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="do">## parts on columns. 2. same number of lines of code. 3. nc/ggplot2</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="do">## code has more names and fewer numbers.</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>imat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>ylim <span class="ot">&lt;-</span> <span class="fu">range</span>(<span class="fu">table</span>(imat))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>xlim <span class="ot">&lt;-</span> <span class="fu">range</span>(imat)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(col.i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(imat)){</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    imat[, col.i],</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks=</span><span class="fu">seq</span>(xlim[<span class="dv">1</span>], xlim[<span class="dv">2</span>], <span class="at">by=</span><span class="fl">0.1</span>),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim=</span>ylim,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">main=</span><span class="fu">colnames</span>(imat)[col.i])</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div id="single-output-column-simple-type-conversion" class="section level3">
<h3>single output column simple type conversion</h3>
<p>All four packages below can convert the input reshape column name to a numeric output capture column.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>pen.peaks.wide <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data.set=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;10.1&quot;</span><span class="ot">=</span><span class="fu">c</span>(5L, 10L),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;0.3&quot;</span><span class="ot">=</span><span class="fu">c</span>(26L, 39L))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>pen.peaks.gather <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>))tidyr<span class="sc">::</span><span class="fu">gather</span>(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  pen.peaks.wide,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;penalty&quot;</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;peaks&quot;</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">convert=</span><span class="cn">TRUE</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pen.peaks.gather)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    4 obs. of  3 variables:</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ data.set: chr  &quot;foo&quot; &quot;bar&quot; &quot;foo&quot; &quot;bar&quot;</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ penalty : num  10.1 10.1 0.3 0.3</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ peaks   : int  5 10 26 39</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>pen.peaks.nc <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  pen.peaks.wide,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">penalty=</span><span class="st">&quot;^[0-9.]+&quot;</span>, as.numeric,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.name=</span><span class="st">&quot;peaks&quot;</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pen.peaks.nc)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   4 obs. of  3 variables:</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ data.set: chr  &quot;foo&quot; &quot;bar&quot; &quot;foo&quot; &quot;bar&quot;</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ penalty : num  10.1 10.1 0.3 0.3</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ peaks   : int  5 10 26 39</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>pen.peaks.pivot <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>))<span class="fu">try</span>(tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  pen.peaks.wide,</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to=</span><span class="st">&quot;penalty&quot;</span>,</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_transform=</span><span class="fu">list</span>(<span class="at">penalty=</span>as.numeric),</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to=</span><span class="st">&quot;peaks&quot;</span>))</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pen.peaks.pivot)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tibble [4 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ data.set: chr [1:4] &quot;foo&quot; &quot;foo&quot; &quot;bar&quot; &quot;bar&quot;</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ penalty : num [1:4] 10.1 0.3 10.1 0.3</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ peaks   : int [1:4] 5 26 10 39</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>varying <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>pen.peaks.reshape.times <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>  pen.peaks.wide,</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying=</span>varying,</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">times=</span><span class="fu">as.numeric</span>(<span class="fu">names</span>(pen.peaks.wide)[varying]),</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names=</span><span class="st">&quot;peaks&quot;</span>,</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar=</span><span class="st">&quot;penalty&quot;</span>)</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pen.peaks.reshape.times)</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   4 obs. of  4 variables:</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ data.set: chr  &quot;foo&quot; &quot;bar&quot; &quot;foo&quot; &quot;bar&quot;</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ penalty : num  10.1 10.1 0.3 0.3</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ peaks   : int  5 10 26 39</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ id      : int  1 2 1 2</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt; </span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;reshapeLong&quot;)=List of 4</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ varying:List of 1</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..$ peaks: chr [1:2] &quot;10.1&quot; &quot;0.3&quot;</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..- attr(*, &quot;v.names&quot;)= chr &quot;peaks&quot;</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..- attr(*, &quot;times&quot;)= num [1:2] 10.1 0.3</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ v.names: chr &quot;peaks&quot;</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ idvar  : chr &quot;id&quot;</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ timevar: chr &quot;penalty&quot;</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>pen.peaks.renamed <span class="ot">&lt;-</span> pen.peaks.wide</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pen.peaks.renamed) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">ifelse</span>(</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">&quot;^[0-9]&quot;</span>, <span class="fu">names</span>(pen.peaks.wide)),</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;peaks_&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(pen.peaks.wide))</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>pen.peaks.reshape.sep <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>  pen.peaks.renamed,</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying=</span>varying,</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">&quot;_&quot;</span>,</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar=</span><span class="st">&quot;penalty&quot;</span>)</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pen.peaks.reshape.sep)</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   4 obs. of  4 variables:</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ data.set: chr  &quot;foo&quot; &quot;bar&quot; &quot;foo&quot; &quot;bar&quot;</span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ penalty : num  10.1 10.1 0.3 0.3</span></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ peaks   : int  5 10 26 39</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ id      : int  1 2 1 2</span></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt; </span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;reshapeLong&quot;)=List of 4</span></span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ varying:List of 1</span></span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..$ peaks: chr [1:2] &quot;peaks_10.1&quot; &quot;peaks_0.3&quot;</span></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..- attr(*, &quot;v.names&quot;)= chr &quot;peaks&quot;</span></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..- attr(*, &quot;times&quot;)= num [1:2] 10.1 0.3</span></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ v.names: chr &quot;peaks&quot;</span></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ idvar  : chr &quot;id&quot;</span></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ timevar: chr &quot;penalty&quot;</span></span></code></pre></div>
</div>
<div id="multiple-output-columns-of-different-types" class="section level3">
<h3>Multiple output columns of different types</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>peaks.csv <span class="ot">&lt;-</span> <span class="fu">system.file</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;RD12-0002_PP16HS_5sec_GM_F_1P.csv.gz&quot;</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">package=</span><span class="st">&quot;nc&quot;</span>, <span class="at">mustWork=</span><span class="cn">TRUE</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>peaks.wide <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(peaks.csv)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>tidyr.long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  peaks.wide,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grep</span>(<span class="st">&quot; [0-9]&quot;</span>, <span class="fu">names</span>(peaks.wide)),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_pattern =</span> <span class="st">&quot;(.*) ([0-9]+)&quot;</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;peak&quot;</span>),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">peak=</span>as.integer))</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>peaks.tall <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  peaks.wide,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot; &quot;</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">peak=</span><span class="st">&quot;[0-9]+&quot;</span>, as.integer)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(L[[&quot;data&quot;]], measure.vars = L[[&quot;measure.vars&quot;]], :</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &#39;measure.vars&#39; [Allele 1, Allele 2, Allele 3, Allele 4, ...] are not all of the same</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; type. By order of hierarchy, the molten data value column will be of type &#39;character&#39;.</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; All measure variables not of type &#39;character&#39; will be coerced too. Check DETAILS in</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ?melt.data.table for more on coercion.</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(L[[&quot;data&quot;]], measure.vars = L[[&quot;measure.vars&quot;]], :</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &#39;measure.vars&#39; [Height 1, Height 2, Height 3, Height 4, ...] are not all of the same</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; type. By order of hierarchy, the molten data value column will be of type &#39;integer&#39;. All</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; measure variables not of type &#39;integer&#39; will be coerced too. Check DETAILS in</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ?melt.data.table for more on coercion.</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(L[[&quot;data&quot;]], measure.vars = L[[&quot;measure.vars&quot;]], :</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &#39;measure.vars&#39; [Size 1, Size 2, Size 3, Size 4, ...] are not all of the same type. By</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; order of hierarchy, the molten data value column will be of type &#39;double&#39;. All measure</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; variables not of type &#39;double&#39; will be coerced too. Check DETAILS in ?melt.data.table for</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; more on coercion.</span></span></code></pre></div>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
