<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2025-04-08" />

<title>Comparisons with other packages</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Comparisons with other packages</h1>
<h4 class="date">2025-04-08</h4>



<p>This vignette provides comparisons with other packages that provide
similar functionality. This is a work in progress – for a more detailed
/ complete / coherent comparison with other packages which provide
wide-to-tall data reshaping, see <a href="https://github.com/tdhock/nc-article#paper">my paper</a>.</p>
<div id="are-sepals-larger-or-smaller-than-petals-in-the-iris-data" class="section level2">
<h2>Are sepals larger or smaller than petals in the iris data?</h2>
<p>Sometimes you want to melt a “wide” data table which has several
distinct pieces of information encoded in each column name. One example
is the familiar iris data, which have flower part and measurement
dimension encoded in each of four column names:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">data.table</span>(iris)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt;      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#&gt;             &lt;num&gt;       &lt;num&gt;        &lt;num&gt;       &lt;num&gt;    &lt;fctr&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#&gt;   1:          5.1         3.5          1.4         0.2    setosa</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#&gt;   2:          4.9         3.0          1.4         0.2    setosa</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#&gt;   3:          4.7         3.2          1.3         0.2    setosa</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt;   4:          4.6         3.1          1.5         0.2    setosa</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#&gt;   5:          5.0         3.6          1.4         0.2    setosa</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#&gt;  ---                                                            </span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#&gt; 146:          6.7         3.0          5.2         2.3 virginica</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#&gt; 147:          6.3         2.5          5.0         1.9 virginica</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#&gt; 148:          6.5         3.0          5.2         2.0 virginica</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co">#&gt; 149:          6.2         3.4          5.4         2.3 virginica</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co">#&gt; 150:          5.9         3.0          5.1         1.8 virginica</span></span></code></pre></div>
<p>The goal in this section will be to convert these data into a format
with a column for each flower part (<code>Sepal</code> and
<code>Petal</code>) so we can easily make a facetted scatterplot to
visually examine whether or not sepals or larger than petals. The
easiest way to perform this conversion is with packages which provide a
function for melting into multiple output columns:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>iris.parts <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">nc=</span>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    iris,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    <span class="at">column=</span><span class="st">&quot;.*?&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    <span class="at">dim=</span><span class="st">&quot;.*&quot;</span>),</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="at">tidyr=</span><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>))tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    iris, </span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    <span class="at">cols=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    <span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;dim&quot;</span>),</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>    <span class="at">names_sep=</span><span class="st">&quot;[.]&quot;</span>),</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  <span class="at">stats=</span>stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>    iris,</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>    <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>    <span class="at">timevar=</span><span class="st">&quot;dim&quot;</span>,</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>    <span class="at">varying=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>    <span class="at">sep=</span><span class="st">&quot;.&quot;</span>),</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>  <span class="st">&quot;data.table::melt&quot;</span><span class="ot">=</span><span class="fu">melt</span>(</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>    <span class="fu">data.table</span>(iris),</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>    <span class="at">measure.vars=</span><span class="fu">patterns</span>(</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>      <span class="at">Sepal=</span><span class="st">&quot;^Sepal&quot;</span>,</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>      <span class="at">Petal=</span><span class="st">&quot;^Petal&quot;</span>)</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>  )[<span class="fu">data.table</span>(</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>    <span class="at">variable=</span><span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">dim=</span><span class="fu">c</span>(<span class="st">&quot;Length&quot;</span>, <span class="st">&quot;Width&quot;</span>)</span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>  ), <span class="at">on=</span>.(variable)],</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;cdata&quot;</span>))cdata<span class="sc">::</span><span class="fu">rowrecs_to_blocks</span>(</span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>    iris,</span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>    <span class="at">controlTable=</span><span class="fu">data.frame</span>(</span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>      <span class="at">dim=</span><span class="fu">c</span>(<span class="st">&quot;Length&quot;</span>, <span class="st">&quot;Width&quot;</span>),</span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>      <span class="at">Petal=</span><span class="fu">c</span>(<span class="st">&quot;Petal.Length&quot;</span>, <span class="st">&quot;Petal.Width&quot;</span>),</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>      <span class="at">Sepal=</span><span class="fu">c</span>(<span class="st">&quot;Sepal.Length&quot;</span>, <span class="st">&quot;Sepal.Width&quot;</span>),</span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>      <span class="at">stringsAsFactors=</span><span class="cn">FALSE</span>),</span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>    <span class="at">columnsToCopy=</span><span class="st">&quot;Species&quot;</span>))</span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="co">#&gt; Le chargement a nécessité le package : cdata</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>iris.parts<span class="sc">$</span>nc</span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="co">#&gt;        Species    dim Petal Sepal</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="co">#&gt;         &lt;fctr&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="co">#&gt;   1:    setosa Length   1.4   5.1</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co">#&gt;   2:    setosa Length   1.4   4.9</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="co">#&gt;   3:    setosa Length   1.3   4.7</span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a><span class="co">#&gt;   4:    setosa Length   1.5   4.6</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a><span class="co">#&gt;   5:    setosa Length   1.4   5.0</span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a><span class="co">#&gt;  ---                             </span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a><span class="co">#&gt; 296: virginica  Width   2.3   3.0</span></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a><span class="co">#&gt; 297: virginica  Width   1.9   2.5</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a><span class="co">#&gt; 298: virginica  Width   2.0   3.0</span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a><span class="co">#&gt; 299: virginica  Width   2.3   3.4</span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a><span class="co">#&gt; 300: virginica  Width   1.8   3.0</span></span></code></pre></div>
<p>It is clear from the code above that each package is capable of the
conversions. However the syntax and level of explicitness varies:</p>
<ul>
<li><code>nc::capture_melt_multiple</code> requires a regular
expression: (most implicit, least repetition)
<ul>
<li>any input column names that match the regex are melted.</li>
<li>values matched in the <code>column</code> group are used for the
output column names.</li>
</ul></li>
<li><code>tidyr::pivot_longer</code> and <code>stats::reshape</code>
require specification of the input columns to melt along with a
separator.
<ul>
<li><code>stats::reshape</code> assumes the output columns names occur
in the part of the input column name before the separator.</li>
<li><code>tidyr::pivot_longer</code> assumes the output columns occur in
the part which corresponds to the <code>.value</code> element of the
<code>names_to</code> argument.</li>
</ul></li>
<li><code>data.table::melt</code> requires a join to recover the
<code>dim</code> output column.</li>
<li><code>cdata::rowrecs_to_blocks</code> requires explicit
specification of a control table. (most explicit, most repetition)</li>
</ul>
<p>Any of the results can be visualized via:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">require</span>(ggplot2)){</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.spacing=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))<span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="fu">facet_grid</span>(dim <span class="sc">~</span> Species)<span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>      Petal, Sepal),</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>      <span class="at">data=</span>iris.parts<span class="sc">$</span>nc)</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>It is clear from the plot above that sepals are larger than petals,
for every measured flower.</p>
</div>
<div id="comparing-dimensions-in-iris-data" class="section level2">
<h2>Comparing dimensions in iris data</h2>
<p>What if we wanted to compare dimensions rather than parts?</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>iris.dims <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="at">nc=</span>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    iris,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    <span class="at">part=</span><span class="st">&quot;.*?&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="at">column=</span><span class="st">&quot;.*&quot;</span>),</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  <span class="at">stats=</span>stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="fu">structure</span>(iris, <span class="at">names=</span><span class="fu">sub</span>(<span class="st">&quot;(.*?)[.](.*)&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">2.</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">names</span>(iris))),</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    <span class="at">timevar=</span><span class="st">&quot;part&quot;</span>,</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    <span class="at">varying=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    <span class="at">sep=</span><span class="st">&quot;.&quot;</span>))</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>iris.dims<span class="sc">$</span>nc</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt;        Species   part Length Width</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt;         &lt;fctr&gt; &lt;char&gt;  &lt;num&gt; &lt;num&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt;   1:    setosa  Petal    1.4   0.2</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt;   2:    setosa  Petal    1.4   0.2</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt;   3:    setosa  Petal    1.3   0.2</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt;   4:    setosa  Petal    1.5   0.2</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt;   5:    setosa  Petal    1.4   0.2</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt;  ---                              </span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt; 296: virginica  Sepal    6.7   3.0</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; 297: virginica  Sepal    6.3   2.5</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co">#&gt; 298: virginica  Sepal    6.5   3.0</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="co">#&gt; 299: virginica  Sepal    6.2   3.4</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="co">#&gt; 300: virginica  Sepal    5.9   3.0</span></span></code></pre></div>
<p>The code above shows that the syntax is mostly the same for this
example. The biggest difference is for <code>stats::reshape</code> which
assumes that each input column name is composed of (1) the output column
name, (2) a delimiter, and (3) some additional information to be stored
in the output column given by <code>timevar</code>. Therefore we need to
pre-process column names using <code>sub</code> for it to work.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">require</span>(ggplot2)){</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.spacing=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))<span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    <span class="fu">facet_grid</span>(part <span class="sc">~</span> Species)<span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>      Length, Width),</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>      <span class="at">data=</span>iris.dims<span class="sc">$</span>nc)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>It is clear from the plot above that <code>Length</code> is larger
than <code>Width</code> for every measured flower part.</p>
</div>
<div id="do-columns-need-to-be-sorted" class="section level2">
<h2>Do columns need to be sorted?</h2>
<p>Consider the following wide data set:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>TC <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="at">age.treatment=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="at">sex.control=</span><span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>),</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="at">sex.treatment=</span><span class="fu">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>),</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="at">age.control=</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">50</span>))</span></code></pre></div>
<p>It is clear from the column names how the data should be grouped when
they are converted to tall format. However the columns do not appear in
regular order (age is before sex for treatment, but age is after sex for
control), which causes a problem for stats and data.table:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>input.list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="st">&quot;nc&quot;</span><span class="ot">=</span>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    TC,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="at">column=</span><span class="st">&quot;.*?&quot;</span>,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    <span class="at">group=</span><span class="st">&quot;.*&quot;</span>),</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  <span class="st">&quot;cdata&quot;</span><span class="ot">=</span><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;cdata&quot;</span>))cdata<span class="sc">::</span><span class="fu">rowrecs_to_blocks</span>(</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    TC,</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    <span class="at">controlTable=</span><span class="fu">data.frame</span>(</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>      <span class="at">group=</span><span class="fu">c</span>(<span class="st">&quot;treatment&quot;</span>, <span class="st">&quot;control&quot;</span>),</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>      <span class="at">age=</span><span class="fu">c</span>(<span class="st">&quot;age.treatment&quot;</span>, <span class="st">&quot;age.control&quot;</span>),</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>      <span class="at">sex=</span><span class="fu">c</span>(<span class="st">&quot;sex.treatment&quot;</span>, <span class="st">&quot;sex.control&quot;</span>),</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>      <span class="at">stringsAsFactors=</span><span class="cn">FALSE</span>)),</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>  <span class="st">&quot;data.table&quot;</span><span class="ot">=</span>data.table<span class="sc">::</span><span class="fu">melt</span>(TC, <span class="at">measure.vars=</span><span class="fu">patterns</span>(</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>    <span class="at">age=</span><span class="st">&quot;age&quot;</span>,</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>    <span class="at">sex=</span><span class="st">&quot;sex&quot;</span>)),</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>  <span class="st">&quot;stats&quot;</span><span class="ot">=</span>stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>    TC,</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>    <span class="at">varying=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>    <span class="at">direction=</span><span class="st">&quot;long&quot;</span>),</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>  <span class="st">&quot;tidyr&quot;</span><span class="ot">=</span><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>))tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>    TC, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>    <span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;group&quot;</span>),</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>    <span class="at">names_sep=</span><span class="st">&quot;[.]&quot;</span>))</span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>output.list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="cf">for</span>(pkg <span class="cf">in</span> <span class="fu">names</span>(input.list)){</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>  df.or.null <span class="ot">&lt;-</span> input.list[[pkg]]</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.data.frame</span>(df.or.null)){</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>    output.list[[pkg]] <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(df.or.null)[<span class="fu">order</span>(age)]</span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>  }</span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>}</span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>output.list</span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a><span class="co">#&gt; $nc</span></span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a><span class="co">#&gt;        group   age    sex</span></span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a><span class="co">#&gt;       &lt;char&gt; &lt;num&gt; &lt;char&gt;</span></span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a><span class="co">#&gt; 1: treatment     1      F</span></span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a><span class="co">#&gt; 2: treatment     5      F</span></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a><span class="co">#&gt; 3:   control    10      M</span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a><span class="co">#&gt; 4:   control    50      M</span></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a><span class="co">#&gt; $cdata</span></span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a><span class="co">#&gt;        group   age    sex</span></span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a><span class="co">#&gt;       &lt;char&gt; &lt;num&gt; &lt;char&gt;</span></span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a><span class="co">#&gt; 1: treatment     1      F</span></span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a><span class="co">#&gt; 2: treatment     5      F</span></span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a><span class="co">#&gt; 3:   control    10      M</span></span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a><span class="co">#&gt; 4:   control    50      M</span></span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a><span class="co">#&gt; $data.table</span></span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a><span class="co">#&gt;    variable   age    sex</span></span>
<span id="cb7-52"><a href="#cb7-52" tabindex="-1"></a><span class="co">#&gt;      &lt;fctr&gt; &lt;num&gt; &lt;char&gt;</span></span>
<span id="cb7-53"><a href="#cb7-53" tabindex="-1"></a><span class="co">#&gt; 1:        1     1      M</span></span>
<span id="cb7-54"><a href="#cb7-54" tabindex="-1"></a><span class="co">#&gt; 2:        1     5      M</span></span>
<span id="cb7-55"><a href="#cb7-55" tabindex="-1"></a><span class="co">#&gt; 3:        2    10      F</span></span>
<span id="cb7-56"><a href="#cb7-56" tabindex="-1"></a><span class="co">#&gt; 4:        2    50      F</span></span>
<span id="cb7-57"><a href="#cb7-57" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-58"><a href="#cb7-58" tabindex="-1"></a><span class="co">#&gt; $stats</span></span>
<span id="cb7-59"><a href="#cb7-59" tabindex="-1"></a><span class="co">#&gt;         time   age    sex    id</span></span>
<span id="cb7-60"><a href="#cb7-60" tabindex="-1"></a><span class="co">#&gt;       &lt;char&gt; &lt;num&gt; &lt;char&gt; &lt;int&gt;</span></span>
<span id="cb7-61"><a href="#cb7-61" tabindex="-1"></a><span class="co">#&gt; 1: treatment     1      M     1</span></span>
<span id="cb7-62"><a href="#cb7-62" tabindex="-1"></a><span class="co">#&gt; 2: treatment     5      M     2</span></span>
<span id="cb7-63"><a href="#cb7-63" tabindex="-1"></a><span class="co">#&gt; 3:   control    10      F     1</span></span>
<span id="cb7-64"><a href="#cb7-64" tabindex="-1"></a><span class="co">#&gt; 4:   control    50      F     2</span></span>
<span id="cb7-65"><a href="#cb7-65" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-66"><a href="#cb7-66" tabindex="-1"></a><span class="co">#&gt; $tidyr</span></span>
<span id="cb7-67"><a href="#cb7-67" tabindex="-1"></a><span class="co">#&gt;        group   age    sex</span></span>
<span id="cb7-68"><a href="#cb7-68" tabindex="-1"></a><span class="co">#&gt;       &lt;char&gt; &lt;num&gt; &lt;char&gt;</span></span>
<span id="cb7-69"><a href="#cb7-69" tabindex="-1"></a><span class="co">#&gt; 1: treatment     1      F</span></span>
<span id="cb7-70"><a href="#cb7-70" tabindex="-1"></a><span class="co">#&gt; 2: treatment     5      F</span></span>
<span id="cb7-71"><a href="#cb7-71" tabindex="-1"></a><span class="co">#&gt; 3:   control    10      M</span></span>
<span id="cb7-72"><a href="#cb7-72" tabindex="-1"></a><span class="co">#&gt; 4:   control    50      M</span></span>
<span id="cb7-73"><a href="#cb7-73" tabindex="-1"></a><span class="fu">sapply</span>(output.list, <span class="cf">function</span>(DT)<span class="fu">identical</span>(DT<span class="sc">$</span>sex, <span class="fu">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>)))</span>
<span id="cb7-74"><a href="#cb7-74" tabindex="-1"></a><span class="co">#&gt;         nc      cdata data.table      stats      tidyr </span></span>
<span id="cb7-75"><a href="#cb7-75" tabindex="-1"></a><span class="co">#&gt;       TRUE       TRUE      FALSE      FALSE       TRUE</span></span></code></pre></div>
<p>In conclusion, when the input column names to melt do not appear in
the same order across groups or output columns, then the correct tall
data can be computed using one of
<code>nc::capture_melt_multiple</code>,
<code>tidyr::pivot_longer</code>,
<code>cdata::rowrecs_to_blocks</code>.</p>
</div>
<div id="melting-into-a-single-output-column-who-data" class="section level2">
<h2>Melting into a single output column, who data</h2>
<p>Another data set where it is useful to do column name pattern
matching followed by melting is the World Health Organization data:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>)){</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="fu">data</span>(who, <span class="at">package=</span><span class="st">&quot;tidyr&quot;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  who <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id=</span><span class="dv">1</span>, <span class="at">new_sp_m5564=</span><span class="dv">2</span>, <span class="at">newrel_f65=</span><span class="dv">3</span>)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>}</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="fu">names</span>(who)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;country&quot;      &quot;iso2&quot;         &quot;iso3&quot;         &quot;year&quot;         &quot;new_sp_m014&quot; </span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;new_sp_m1524&quot; &quot;new_sp_m2534&quot; &quot;new_sp_m3544&quot; &quot;new_sp_m4554&quot; &quot;new_sp_m5564&quot;</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; [11] &quot;new_sp_m65&quot;   &quot;new_sp_f014&quot;  &quot;new_sp_f1524&quot; &quot;new_sp_f2534&quot; &quot;new_sp_f3544&quot;</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; [16] &quot;new_sp_f4554&quot; &quot;new_sp_f5564&quot; &quot;new_sp_f65&quot;   &quot;new_sn_m014&quot;  &quot;new_sn_m1524&quot;</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; [21] &quot;new_sn_m2534&quot; &quot;new_sn_m3544&quot; &quot;new_sn_m4554&quot; &quot;new_sn_m5564&quot; &quot;new_sn_m65&quot;  </span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; [26] &quot;new_sn_f014&quot;  &quot;new_sn_f1524&quot; &quot;new_sn_f2534&quot; &quot;new_sn_f3544&quot; &quot;new_sn_f4554&quot;</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; [31] &quot;new_sn_f5564&quot; &quot;new_sn_f65&quot;   &quot;new_ep_m014&quot;  &quot;new_ep_m1524&quot; &quot;new_ep_m2534&quot;</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; [36] &quot;new_ep_m3544&quot; &quot;new_ep_m4554&quot; &quot;new_ep_m5564&quot; &quot;new_ep_m65&quot;   &quot;new_ep_f014&quot; </span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt; [41] &quot;new_ep_f1524&quot; &quot;new_ep_f2534&quot; &quot;new_ep_f3544&quot; &quot;new_ep_f4554&quot; &quot;new_ep_f5564&quot;</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; [46] &quot;new_ep_f65&quot;   &quot;newrel_m014&quot;  &quot;newrel_m1524&quot; &quot;newrel_m2534&quot; &quot;newrel_m3544&quot;</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; [51] &quot;newrel_m4554&quot; &quot;newrel_m5564&quot; &quot;newrel_m65&quot;   &quot;newrel_f014&quot;  &quot;newrel_f1524&quot;</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt; [56] &quot;newrel_f2534&quot; &quot;newrel_f3544&quot; &quot;newrel_f4554&quot; &quot;newrel_f5564&quot; &quot;newrel_f65&quot;</span></span></code></pre></div>
<p>Each column which starts with <code>new</code> has three distinct
pieces of information encoded in its name: diagnosis type (e.g. sp or
rel), gender (m or f), and age range (e.g. 5564 or 1524). We would like
to use a regex to match these column names, then using the matching
columns as measure.vars in a melt, then join the two results. The most
convenient way to do that is via:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>who.chr.list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="at">nc=</span>nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    who,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    <span class="st">&quot;new_?&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="at">diagnosis=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    <span class="st">&quot;_&quot;</span>,</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>    <span class="at">gender=</span><span class="st">&quot;.&quot;</span>,</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    <span class="at">ages=</span><span class="st">&quot;.*&quot;</span>),</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  <span class="at">tidyr=</span><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>))tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>    who,</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>    new_sp_m014<span class="sc">:</span>newrel_f65,</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>    <span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&quot;diagnosis&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;ages&quot;</span>),</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>    <span class="at">names_pattern=</span><span class="st">&quot;new_?(.*)_(.)(.*)&quot;</span>))</span></code></pre></div>
<p>Note the result includes additional column <code>value</code> which
contains the melted data. There is also a column for each capture group
in the specified pattern. The following example shows how to rename the
<code>value</code> column, remove missing values, and use numeric type
conversion functions:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>who.pattern <span class="ot">&lt;-</span> <span class="st">&quot;new_?(.*)_(.)((0|[0-9]{2})([0-9]{0,2}))&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>as.numeric.Inf <span class="ot">&lt;-</span> <span class="cf">function</span>(y)<span class="fu">ifelse</span>(y<span class="sc">==</span><span class="st">&quot;&quot;</span>, <span class="cn">Inf</span>, <span class="fu">as.numeric</span>(y))</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>who.typed.list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="at">nc=</span>nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    who,</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    <span class="st">&quot;new_?&quot;</span>,</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>    <span class="at">diagnosis=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    <span class="st">&quot;_&quot;</span>,</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>    <span class="at">gender=</span><span class="st">&quot;.&quot;</span>,</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    <span class="at">ages=</span><span class="fu">list</span>(</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>      <span class="at">ymin.num=</span><span class="st">&quot;0|[0-9]{2}&quot;</span>, as.numeric,</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>      <span class="at">ymax.num=</span><span class="st">&quot;[0-9]{0,2}&quot;</span>, as.numeric.Inf),</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>    <span class="at">value.name=</span><span class="st">&quot;count&quot;</span>,</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>    <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>  <span class="at">tidyr=</span><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>))<span class="fu">try</span>(tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>    who,</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>    <span class="at">cols=</span><span class="fu">grep</span>(who.pattern, <span class="fu">names</span>(who)),</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>    <span class="at">names_transform=</span><span class="fu">list</span>(</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>      <span class="at">ymin.num=</span>as.numeric,</span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>      <span class="at">ymax.num=</span>as.numeric.Inf),</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>    <span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&quot;diagnosis&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;ages&quot;</span>, <span class="st">&quot;ymin.num&quot;</span>, <span class="st">&quot;ymax.num&quot;</span>),</span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>    <span class="at">names_pattern=</span>who.pattern,</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>    <span class="at">values_drop_na=</span><span class="cn">TRUE</span>,</span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>    <span class="at">values_to=</span><span class="st">&quot;count&quot;</span>)))</span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a><span class="fu">str</span>(who.typed.list)</span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a><span class="co">#&gt; List of 2</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a><span class="co">#&gt;  $ nc   :Classes &#39;data.table&#39; and &#39;data.frame&#39;:  76046 obs. of  10 variables:</span></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a><span class="co">#&gt;   ..$ country  : chr [1:76046] &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; ...</span></span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a><span class="co">#&gt;   ..$ iso2     : chr [1:76046] &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; ...</span></span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a><span class="co">#&gt;   ..$ iso3     : chr [1:76046] &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; ...</span></span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a><span class="co">#&gt;   ..$ year     : num [1:76046] 1997 1998 1999 2000 2001 ...</span></span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a><span class="co">#&gt;   ..$ diagnosis: chr [1:76046] &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; ...</span></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a><span class="co">#&gt;   ..$ gender   : chr [1:76046] &quot;m&quot; &quot;m&quot; &quot;m&quot; &quot;m&quot; ...</span></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a><span class="co">#&gt;   ..$ ages     : chr [1:76046] &quot;014&quot; &quot;014&quot; &quot;014&quot; &quot;014&quot; ...</span></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a><span class="co">#&gt;   ..$ ymin.num : num [1:76046] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a><span class="co">#&gt;   ..$ ymax.num : num [1:76046] 14 14 14 14 14 14 14 14 14 14 ...</span></span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a><span class="co">#&gt;   ..$ count    : num [1:76046] 0 30 8 52 129 90 127 139 151 193 ...</span></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt; </span></span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a><span class="co">#&gt;  $ tidyr: tibble [76,046 × 10] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a><span class="co">#&gt;   ..$ country  : chr [1:76046] &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; ...</span></span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a><span class="co">#&gt;   ..$ iso2     : chr [1:76046] &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; ...</span></span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a><span class="co">#&gt;   ..$ iso3     : chr [1:76046] &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; ...</span></span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a><span class="co">#&gt;   ..$ year     : num [1:76046] 1997 1997 1997 1997 1997 ...</span></span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a><span class="co">#&gt;   ..$ diagnosis: chr [1:76046] &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; ...</span></span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a><span class="co">#&gt;   ..$ gender   : chr [1:76046] &quot;m&quot; &quot;m&quot; &quot;m&quot; &quot;m&quot; ...</span></span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a><span class="co">#&gt;   ..$ ages     : chr [1:76046] &quot;014&quot; &quot;1524&quot; &quot;2534&quot; &quot;3544&quot; ...</span></span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a><span class="co">#&gt;   ..$ ymin.num : num [1:76046] 0 15 25 35 45 55 65 0 15 25 ...</span></span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a><span class="co">#&gt;   ..$ ymax.num : num [1:76046] 14 24 34 44 54 ...</span></span>
<span id="cb10-50"><a href="#cb10-50" tabindex="-1"></a><span class="co">#&gt;   ..$ count    : num [1:76046] 0 10 6 3 5 2 0 5 38 36 ...</span></span></code></pre></div>
<p>The result above shows that <code>nc::capture_melt_single</code> (1)
makes it easier to define complex patterns (2) supports type conversion
without a post-processing step, and (3) reduces repetition in user code.
There are several sources of repetition in <code>tidyr</code> code:</p>
<ul>
<li>Syntax of type conversion:
<ul>
<li>capture group name <code>ymin.num</code> appears only once for
<code>nc</code> but twice for <code>tidyr</code>.</li>
<li>capture group name <code>ymax.chr</code> appears only once for
<code>nc</code> but three times for <code>tidyr</code>.</li>
</ul></li>
<li>Specification of input data and columns to melt:
<ul>
<li>input data table <code>who</code> appears only once for
<code>nc</code> but twice for <code>tidyr</code>.</li>
<li>pattern for input columns to melt appears only once for
<code>nc</code> but twice for <code>tidyr</code>.</li>
</ul></li>
</ul>
<p>Other packages for doing this include:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>)){</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  gather.result <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">gather</span>(</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    who,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    <span class="st">&quot;count&quot;</span>,</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    <span class="fu">grep</span>(who.pattern, <span class="fu">names</span>(who)),</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>  extract.result <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">extract</span>(</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>    gather.result,</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>    <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;diagnosis&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;ages&quot;</span>, <span class="st">&quot;ymin.int&quot;</span>, <span class="st">&quot;ymax.int&quot;</span>),</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>    who.pattern,</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>    <span class="at">convert=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>  transform.result <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">transform</span>(</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>    extract.result,</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>    <span class="at">ymin.num=</span><span class="fu">as.numeric</span>(ymin.int),</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>    <span class="at">ymax.num=</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(ymax.int), <span class="cn">Inf</span>, <span class="fu">as.numeric</span>(ymax.int)))</span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>  <span class="fu">str</span>(transform.result)</span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>}</span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    76046 obs. of  12 variables:</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="co">#&gt;  $ country  : chr  &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; ...</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="co">#&gt;  $ iso2     : chr  &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; &quot;AF&quot; ...</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a><span class="co">#&gt;  $ iso3     : chr  &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; &quot;AFG&quot; ...</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a><span class="co">#&gt;  $ year     : num  1997 1998 1999 2000 2001 ...</span></span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a><span class="co">#&gt;  $ diagnosis: chr  &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; &quot;sp&quot; ...</span></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a><span class="co">#&gt;  $ gender   : chr  &quot;m&quot; &quot;m&quot; &quot;m&quot; &quot;m&quot; ...</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a><span class="co">#&gt;  $ ages     : int  14 14 14 14 14 14 14 14 14 14 ...</span></span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a><span class="co">#&gt;  $ ymin.int : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a><span class="co">#&gt;  $ ymax.int : int  14 14 14 14 14 14 14 14 14 14 ...</span></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a><span class="co">#&gt;  $ count    : num  0 30 8 52 129 90 127 139 151 193 ...</span></span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a><span class="co">#&gt;  $ ymin.num : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a><span class="co">#&gt;  $ ymax.num : num  14 14 14 14 14 14 14 14 14 14 ...</span></span></code></pre></div>
<p>Note that <code>tidyr::gather</code> requires two post-processing
steps, which cause the same two types of repetition as
<code>tidyr::pivot_longer</code>:</p>
<ul>
<li>Syntax of type conversion: <code>base::transform</code> is used for
converting age range variables to numeric, since default types are int
with <code>convert=TRUE</code>.</li>
<li>Specification of input data and columns to melt:
<code>tidyr::extract</code> is used to convert the melted column into
several output columns; this results in repetition in the code because
the regex is also used to define the columns to melt/gather.</li>
</ul>
<p>The <code>reshape2</code> package suffers from the same two
issues:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>reshape2.result <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;reshape2&quot;</span>)){</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  reshape2<span class="sc">:::</span><span class="fu">melt.data.frame</span>(</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    who,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="at">measure.vars=</span><span class="fu">grep</span>(who.pattern, <span class="fu">names</span>(who)),</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    <span class="at">na.rm=</span><span class="cn">TRUE</span>,</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>    <span class="at">value.name=</span><span class="st">&quot;count&quot;</span>)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>}</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; Le chargement a nécessité le package : reshape2</span></span></code></pre></div>
<p>Interestingly, <code>data.table::patterns</code> can be used to avoid
repeating the data set name, <code>who</code>. However it supports
neither type conversion nor regex capture groups.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>dt.result <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">melt.data.table</span>(</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="fu">data.table</span>(who),</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="at">measure.vars=</span><span class="fu">patterns</span>(who.pattern),</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="at">na.rm=</span><span class="cn">TRUE</span>,</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  <span class="at">value.name=</span><span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<p>Neither cdata nor stats provide an na.rm option:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>who.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(who)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>is.varying <span class="ot">&lt;-</span> <span class="fu">grepl</span>(who.pattern, <span class="fu">names</span>(who))</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="fu">names</span>(who.df)[is.varying] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;count.&quot;</span>, <span class="fu">names</span>(who)[is.varying])</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>stats.result <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  who.df,</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>  <span class="at">timevar=</span><span class="st">&quot;variable&quot;</span>,</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>  <span class="at">varying=</span>is.varying)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;cdata&quot;</span>)){</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  cdata.result <span class="ot">&lt;-</span> cdata<span class="sc">::</span><span class="fu">rowrecs_to_blocks</span>(</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>    who, </span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>    cdata<span class="sc">::</span><span class="fu">build_unpivot_control</span>(</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>      <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>      <span class="st">&quot;count&quot;</span>,</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>      <span class="fu">grep</span>(who.pattern, <span class="fu">names</span>(who), <span class="at">value=</span><span class="cn">TRUE</span>)),</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>    <span class="at">columnsToCopy=</span><span class="fu">grep</span>(who.pattern, <span class="fu">names</span>(who), <span class="at">value=</span><span class="cn">TRUE</span>, <span class="at">invert=</span><span class="cn">TRUE</span>))</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="melting-a-wider-iris-back-to-original" class="section level2">
<h2>Melting a wider iris back to original</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="do">## Example 1: melting a wider iris data back to original.</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>iris.dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>  <span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(iris),</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>  iris[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>  <span class="at">Species=</span><span class="fu">paste</span>(iris<span class="sc">$</span>Species))</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="fu">print</span>(iris.dt)</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt;          i Sepal.Length Sepal.Width Petal.Length Petal.Width   Species</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt;        &lt;num&gt;       &lt;num&gt;        &lt;num&gt;       &lt;num&gt;    &lt;char&gt;</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt;   1:     1          5.1         3.5          1.4         0.2    setosa</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt;   2:     2          4.9         3.0          1.4         0.2    setosa</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#&gt;   3:     3          4.7         3.2          1.3         0.2    setosa</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#&gt;   4:     4          4.6         3.1          1.5         0.2    setosa</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co">#&gt;   5:     5          5.0         3.6          1.4         0.2    setosa</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co">#&gt;  ---                                                                  </span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="co">#&gt; 146:   146          6.7         3.0          5.2         2.3 virginica</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="co">#&gt; 147:   147          6.3         2.5          5.0         1.9 virginica</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co">#&gt; 148:   148          6.5         3.0          5.2         2.0 virginica</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a><span class="co">#&gt; 149:   149          6.2         3.4          5.4         2.3 virginica</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a><span class="co">#&gt; 150:   150          5.9         3.0          5.1         1.8 virginica</span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="do">## what if we had two observations on each row?</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a>iris.rand <span class="ot">&lt;-</span> iris.dt[<span class="fu">sample</span>(.N)]</span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a>iris.wide <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">treatment=</span>iris.rand[<span class="dv">1</span><span class="sc">:</span><span class="dv">75</span>], <span class="at">control=</span>iris.rand[<span class="dv">76</span><span class="sc">:</span><span class="dv">150</span>])</span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a><span class="fu">print</span>(iris.wide, <span class="at">topn=</span><span class="dv">2</span>, <span class="at">nrows=</span><span class="dv">10</span>)</span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a><span class="co">#&gt;     treatment.i treatment.Sepal.Length treatment.Sepal.Width</span></span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a><span class="co">#&gt;           &lt;int&gt;                  &lt;num&gt;                 &lt;num&gt;</span></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a><span class="co">#&gt;  1:          68                    5.8                   2.7</span></span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a><span class="co">#&gt;  2:         129                    6.4                   2.8</span></span>
<span id="cb16-32"><a href="#cb16-32" tabindex="-1"></a><span class="co">#&gt; ---                                                         </span></span>
<span id="cb16-33"><a href="#cb16-33" tabindex="-1"></a><span class="co">#&gt; 74:          91                    5.5                   2.6</span></span>
<span id="cb16-34"><a href="#cb16-34" tabindex="-1"></a><span class="co">#&gt; 75:          64                    6.1                   2.9</span></span>
<span id="cb16-35"><a href="#cb16-35" tabindex="-1"></a><span class="co">#&gt;     treatment.Petal.Length treatment.Petal.Width treatment.Species control.i</span></span>
<span id="cb16-36"><a href="#cb16-36" tabindex="-1"></a><span class="co">#&gt;                      &lt;num&gt;                 &lt;num&gt;            &lt;char&gt;     &lt;int&gt;</span></span>
<span id="cb16-37"><a href="#cb16-37" tabindex="-1"></a><span class="co">#&gt;  1:                    4.1                   1.0        versicolor        60</span></span>
<span id="cb16-38"><a href="#cb16-38" tabindex="-1"></a><span class="co">#&gt;  2:                    5.6                   2.1         virginica       113</span></span>
<span id="cb16-39"><a href="#cb16-39" tabindex="-1"></a><span class="co">#&gt; ---                                                                         </span></span>
<span id="cb16-40"><a href="#cb16-40" tabindex="-1"></a><span class="co">#&gt; 74:                    4.4                   1.2        versicolor        57</span></span>
<span id="cb16-41"><a href="#cb16-41" tabindex="-1"></a><span class="co">#&gt; 75:                    4.7                   1.4        versicolor        72</span></span>
<span id="cb16-42"><a href="#cb16-42" tabindex="-1"></a><span class="co">#&gt;     control.Sepal.Length control.Sepal.Width control.Petal.Length</span></span>
<span id="cb16-43"><a href="#cb16-43" tabindex="-1"></a><span class="co">#&gt;                    &lt;num&gt;               &lt;num&gt;                &lt;num&gt;</span></span>
<span id="cb16-44"><a href="#cb16-44" tabindex="-1"></a><span class="co">#&gt;  1:                  5.2                 2.7                  3.9</span></span>
<span id="cb16-45"><a href="#cb16-45" tabindex="-1"></a><span class="co">#&gt;  2:                  6.8                 3.0                  5.5</span></span>
<span id="cb16-46"><a href="#cb16-46" tabindex="-1"></a><span class="co">#&gt; ---                                                              </span></span>
<span id="cb16-47"><a href="#cb16-47" tabindex="-1"></a><span class="co">#&gt; 74:                  6.3                 3.3                  4.7</span></span>
<span id="cb16-48"><a href="#cb16-48" tabindex="-1"></a><span class="co">#&gt; 75:                  6.1                 2.8                  4.0</span></span>
<span id="cb16-49"><a href="#cb16-49" tabindex="-1"></a><span class="co">#&gt;     control.Petal.Width control.Species</span></span>
<span id="cb16-50"><a href="#cb16-50" tabindex="-1"></a><span class="co">#&gt;                   &lt;num&gt;          &lt;char&gt;</span></span>
<span id="cb16-51"><a href="#cb16-51" tabindex="-1"></a><span class="co">#&gt;  1:                 1.4      versicolor</span></span>
<span id="cb16-52"><a href="#cb16-52" tabindex="-1"></a><span class="co">#&gt;  2:                 2.1       virginica</span></span>
<span id="cb16-53"><a href="#cb16-53" tabindex="-1"></a><span class="co">#&gt; ---                                    </span></span>
<span id="cb16-54"><a href="#cb16-54" tabindex="-1"></a><span class="co">#&gt; 74:                 1.6      versicolor</span></span>
<span id="cb16-55"><a href="#cb16-55" tabindex="-1"></a><span class="co">#&gt; 75:                 1.3      versicolor</span></span>
<span id="cb16-56"><a href="#cb16-56" tabindex="-1"></a></span>
<span id="cb16-57"><a href="#cb16-57" tabindex="-1"></a><span class="do">## This is the usual data.table syntax for getting the original iris back.</span></span>
<span id="cb16-58"><a href="#cb16-58" tabindex="-1"></a>iris.melted <span class="ot">&lt;-</span> <span class="fu">melt</span>(iris.wide, <span class="at">value.factor=</span><span class="cn">TRUE</span>, <span class="at">measure.vars =</span> <span class="fu">patterns</span>(</span>
<span id="cb16-59"><a href="#cb16-59" tabindex="-1"></a>  <span class="at">i=</span><span class="st">&quot;i$&quot;</span>,</span>
<span id="cb16-60"><a href="#cb16-60" tabindex="-1"></a>  <span class="at">Sepal.Length=</span><span class="st">&quot;Sepal.Length$&quot;</span>,</span>
<span id="cb16-61"><a href="#cb16-61" tabindex="-1"></a>  <span class="at">Sepal.Width=</span><span class="st">&quot;Sepal.Width$&quot;</span>,</span>
<span id="cb16-62"><a href="#cb16-62" tabindex="-1"></a>  <span class="at">Petal.Length=</span><span class="st">&quot;Petal.Length$&quot;</span>,</span>
<span id="cb16-63"><a href="#cb16-63" tabindex="-1"></a>  <span class="at">Petal.Width=</span><span class="st">&quot;Petal.Width$&quot;</span>,</span>
<span id="cb16-64"><a href="#cb16-64" tabindex="-1"></a>  <span class="at">Species=</span><span class="st">&quot;Species$&quot;</span>))</span>
<span id="cb16-65"><a href="#cb16-65" tabindex="-1"></a><span class="fu">identical</span>(iris.melted[<span class="fu">order</span>(i), <span class="fu">names</span>(iris.dt), <span class="at">with=</span><span class="cn">FALSE</span>], iris.dt)</span>
<span id="cb16-66"><a href="#cb16-66" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb16-67"><a href="#cb16-67" tabindex="-1"></a></span>
<span id="cb16-68"><a href="#cb16-68" tabindex="-1"></a><span class="do">## nc can do the same thing -- you must define an R argument named</span></span>
<span id="cb16-69"><a href="#cb16-69" tabindex="-1"></a><span class="do">## column, and another named argument which identifies each group.</span></span>
<span id="cb16-70"><a href="#cb16-70" tabindex="-1"></a>(nc.melted <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb16-71"><a href="#cb16-71" tabindex="-1"></a>  iris.wide,</span>
<span id="cb16-72"><a href="#cb16-72" tabindex="-1"></a>  <span class="at">group=</span><span class="st">&quot;[^.]+&quot;</span>,</span>
<span id="cb16-73"><a href="#cb16-73" tabindex="-1"></a>  <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb16-74"><a href="#cb16-74" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;.*&quot;</span>))</span>
<span id="cb16-75"><a href="#cb16-75" tabindex="-1"></a><span class="co">#&gt;          group Petal.Length Petal.Width Sepal.Length Sepal.Width    Species</span></span>
<span id="cb16-76"><a href="#cb16-76" tabindex="-1"></a><span class="co">#&gt;         &lt;char&gt;        &lt;num&gt;       &lt;num&gt;        &lt;num&gt;       &lt;num&gt;     &lt;char&gt;</span></span>
<span id="cb16-77"><a href="#cb16-77" tabindex="-1"></a><span class="co">#&gt;   1:   control          3.9         1.4          5.2         2.7 versicolor</span></span>
<span id="cb16-78"><a href="#cb16-78" tabindex="-1"></a><span class="co">#&gt;   2:   control          5.5         2.1          6.8         3.0  virginica</span></span>
<span id="cb16-79"><a href="#cb16-79" tabindex="-1"></a><span class="co">#&gt;   3:   control          5.6         1.4          6.1         2.6  virginica</span></span>
<span id="cb16-80"><a href="#cb16-80" tabindex="-1"></a><span class="co">#&gt;   4:   control          1.5         0.1          4.9         3.1     setosa</span></span>
<span id="cb16-81"><a href="#cb16-81" tabindex="-1"></a><span class="co">#&gt;   5:   control          1.4         0.2          5.1         3.5     setosa</span></span>
<span id="cb16-82"><a href="#cb16-82" tabindex="-1"></a><span class="co">#&gt;  ---                                                                       </span></span>
<span id="cb16-83"><a href="#cb16-83" tabindex="-1"></a><span class="co">#&gt; 146: treatment          1.6         0.2          4.8         3.1     setosa</span></span>
<span id="cb16-84"><a href="#cb16-84" tabindex="-1"></a><span class="co">#&gt; 147: treatment          1.3         0.4          5.4         3.9     setosa</span></span>
<span id="cb16-85"><a href="#cb16-85" tabindex="-1"></a><span class="co">#&gt; 148: treatment          5.4         2.1          6.9         3.1  virginica</span></span>
<span id="cb16-86"><a href="#cb16-86" tabindex="-1"></a><span class="co">#&gt; 149: treatment          4.4         1.2          5.5         2.6 versicolor</span></span>
<span id="cb16-87"><a href="#cb16-87" tabindex="-1"></a><span class="co">#&gt; 150: treatment          4.7         1.4          6.1         2.9 versicolor</span></span>
<span id="cb16-88"><a href="#cb16-88" tabindex="-1"></a><span class="co">#&gt;          i</span></span>
<span id="cb16-89"><a href="#cb16-89" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt;</span></span>
<span id="cb16-90"><a href="#cb16-90" tabindex="-1"></a><span class="co">#&gt;   1:    60</span></span>
<span id="cb16-91"><a href="#cb16-91" tabindex="-1"></a><span class="co">#&gt;   2:   113</span></span>
<span id="cb16-92"><a href="#cb16-92" tabindex="-1"></a><span class="co">#&gt;   3:   135</span></span>
<span id="cb16-93"><a href="#cb16-93" tabindex="-1"></a><span class="co">#&gt;   4:    10</span></span>
<span id="cb16-94"><a href="#cb16-94" tabindex="-1"></a><span class="co">#&gt;   5:     1</span></span>
<span id="cb16-95"><a href="#cb16-95" tabindex="-1"></a><span class="co">#&gt;  ---      </span></span>
<span id="cb16-96"><a href="#cb16-96" tabindex="-1"></a><span class="co">#&gt; 146:    31</span></span>
<span id="cb16-97"><a href="#cb16-97" tabindex="-1"></a><span class="co">#&gt; 147:    17</span></span>
<span id="cb16-98"><a href="#cb16-98" tabindex="-1"></a><span class="co">#&gt; 148:   140</span></span>
<span id="cb16-99"><a href="#cb16-99" tabindex="-1"></a><span class="co">#&gt; 149:    91</span></span>
<span id="cb16-100"><a href="#cb16-100" tabindex="-1"></a><span class="co">#&gt; 150:    64</span></span>
<span id="cb16-101"><a href="#cb16-101" tabindex="-1"></a><span class="fu">identical</span>(nc.melted[<span class="fu">order</span>(i), <span class="fu">names</span>(iris.dt), <span class="at">with=</span><span class="cn">FALSE</span>], iris.dt)</span>
<span id="cb16-102"><a href="#cb16-102" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb16-103"><a href="#cb16-103" tabindex="-1"></a></span>
<span id="cb16-104"><a href="#cb16-104" tabindex="-1"></a><span class="do">## This is how we do it using stats::reshape.</span></span>
<span id="cb16-105"><a href="#cb16-105" tabindex="-1"></a>iris.wide.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(iris.wide)</span>
<span id="cb16-106"><a href="#cb16-106" tabindex="-1"></a><span class="fu">names</span>(iris.wide.df) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">&quot;(.*?)[.](.*)&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">2_</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">names</span>(iris.wide))</span>
<span id="cb16-107"><a href="#cb16-107" tabindex="-1"></a>iris.reshaped <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb16-108"><a href="#cb16-108" tabindex="-1"></a>  iris.wide.df,</span>
<span id="cb16-109"><a href="#cb16-109" tabindex="-1"></a>  <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb16-110"><a href="#cb16-110" tabindex="-1"></a>  <span class="at">timevar=</span><span class="st">&quot;group&quot;</span>,</span>
<span id="cb16-111"><a href="#cb16-111" tabindex="-1"></a>  <span class="at">varying=</span><span class="fu">names</span>(iris.wide.df),</span>
<span id="cb16-112"><a href="#cb16-112" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb16-113"><a href="#cb16-113" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">data.table</span>(iris.reshaped[, <span class="fu">names</span>(iris.dt)])[<span class="fu">order</span>(i)], iris.dt)</span>
<span id="cb16-114"><a href="#cb16-114" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb16-115"><a href="#cb16-115" tabindex="-1"></a></span>
<span id="cb16-116"><a href="#cb16-116" tabindex="-1"></a><span class="do">## get the parts columns and groups -- is there any difference</span></span>
<span id="cb16-117"><a href="#cb16-117" tabindex="-1"></a><span class="do">## between groups? of course not!</span></span>
<span id="cb16-118"><a href="#cb16-118" tabindex="-1"></a>parts.wide <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb16-119"><a href="#cb16-119" tabindex="-1"></a>  iris.wide,</span>
<span id="cb16-120"><a href="#cb16-120" tabindex="-1"></a>  <span class="at">group=</span><span class="st">&quot;.*?&quot;</span>,</span>
<span id="cb16-121"><a href="#cb16-121" tabindex="-1"></a>  <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb16-122"><a href="#cb16-122" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;.*?&quot;</span>,</span>
<span id="cb16-123"><a href="#cb16-123" tabindex="-1"></a>  <span class="st">&quot;[.]&quot;</span>,</span>
<span id="cb16-124"><a href="#cb16-124" tabindex="-1"></a>  <span class="at">dim=</span><span class="st">&quot;.*&quot;</span>)</span>
<span id="cb16-125"><a href="#cb16-125" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">require</span>(<span class="st">&quot;ggplot2&quot;</span>)){</span>
<span id="cb16-126"><a href="#cb16-126" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb16-127"><a href="#cb16-127" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb16-128"><a href="#cb16-128" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.spacing=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))<span class="sc">+</span></span>
<span id="cb16-129"><a href="#cb16-129" tabindex="-1"></a>    <span class="fu">facet_grid</span>(dim <span class="sc">~</span> group)<span class="sc">+</span></span>
<span id="cb16-130"><a href="#cb16-130" tabindex="-1"></a>    <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb16-131"><a href="#cb16-131" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb16-132"><a href="#cb16-132" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb16-133"><a href="#cb16-133" tabindex="-1"></a>      Petal, Sepal),</span>
<span id="cb16-134"><a href="#cb16-134" tabindex="-1"></a>      <span class="at">data=</span>parts.wide)</span>
<span id="cb16-135"><a href="#cb16-135" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="lots-of-column-types" class="section level2">
<h2>Lots of column types</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="do">## Example 2. Lots of column types, from example(melt.data.table).</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>DT <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="at">i_1 =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="cn">NA</span>),</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  <span class="at">i_2 =</span> <span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="at">f_1 =</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="cn">NA</span>), <span class="dv">6</span>, <span class="cn">TRUE</span>)),</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>  <span class="at">f_2 =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;z&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;x&quot;</span>), <span class="at">ordered=</span><span class="cn">TRUE</span>),</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  <span class="at">c_1 =</span> <span class="fu">sample</span>(<span class="fu">c</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="cn">NA</span>), <span class="dv">6</span>, <span class="cn">TRUE</span>),</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  <span class="at">d_1 =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="cn">NA</span>,<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">origin=</span><span class="st">&quot;2013-09-01&quot;</span>),</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>  <span class="at">d_2 =</span> <span class="fu">as.Date</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">origin=</span><span class="st">&quot;2012-01-01&quot;</span>))</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="do">## add a couple of list cols</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>DT[, l_1 <span class="sc">:=</span> DT[, <span class="fu">list</span>(<span class="at">c=</span><span class="fu">list</span>(<span class="fu">rep</span>(i_1, <span class="fu">sample</span>(<span class="dv">5</span>,<span class="dv">1</span>)))), by <span class="ot">=</span> i_1]<span class="sc">$</span>c]</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>DT[, l_2 <span class="sc">:=</span> DT[, <span class="fu">list</span>(<span class="at">c=</span><span class="fu">list</span>(<span class="fu">rep</span>(c_1, <span class="fu">sample</span>(<span class="dv">5</span>,<span class="dv">1</span>)))), by <span class="ot">=</span> i_1]<span class="sc">$</span>c]</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="do">## original DT syntax is quite repetitive.</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="fu">melt</span>(DT, <span class="at">measure=</span><span class="fu">patterns</span>(</span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>  <span class="at">i=</span><span class="st">&quot;^i&quot;</span>,</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>  <span class="at">f=</span><span class="st">&quot;^f&quot;</span>,</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>  <span class="at">d=</span><span class="st">&quot;^d&quot;</span>,</span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>  <span class="at">l=</span><span class="st">&quot;^l&quot;</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>))</span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="co">#&gt;        c_1 variable     i      f          d              l</span></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt;   &lt;fctr&gt; &lt;int&gt; &lt;char&gt;     &lt;Date&gt;         &lt;list&gt;</span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a><span class="co">#&gt;  1:      a        1     1      a 2013-09-02        1,1,1,1</span></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a><span class="co">#&gt;  2:      a        1     2      a 2013-09-03            2,2</span></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="co">#&gt;  3:   &lt;NA&gt;        1     3   &lt;NA&gt; 2013-09-04              3</span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a><span class="co">#&gt;  4:      b        1     4      a       &lt;NA&gt;          4,4,4</span></span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="co">#&gt;  5:      b        1     5      c 2013-09-05              5</span></span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a><span class="co">#&gt;  6:   &lt;NA&gt;        1    NA      c 2013-09-06             NA</span></span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a><span class="co">#&gt;  7:      a        2    NA      z 2012-01-07        a,a,a,a</span></span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a><span class="co">#&gt;  8:      a        2     6      a 2012-01-06      a,a,a,a,a</span></span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a><span class="co">#&gt;  9:   &lt;NA&gt;        2     7      x 2012-01-05             NA</span></span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a><span class="co">#&gt; 10:      b        2     8      c 2012-01-04          b,b,b</span></span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a><span class="co">#&gt; 11:      b        2     9      x 2012-01-03        b,b,b,b</span></span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a><span class="co">#&gt; 12:   &lt;NA&gt;        2    10      x 2012-01-02 NA,NA,NA,NA,NA</span></span>
<span id="cb17-36"><a href="#cb17-36" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" tabindex="-1"></a><span class="do">## nc syntax uses a single regex rather than four.</span></span>
<span id="cb17-38"><a href="#cb17-38" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb17-39"><a href="#cb17-39" tabindex="-1"></a>  DT,</span>
<span id="cb17-40"><a href="#cb17-40" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;^[^c]&quot;</span>,</span>
<span id="cb17-41"><a href="#cb17-41" tabindex="-1"></a>  <span class="st">&quot;_&quot;</span>,</span>
<span id="cb17-42"><a href="#cb17-42" tabindex="-1"></a>  <span class="at">number=</span><span class="st">&quot;[12]&quot;</span>)</span>
<span id="cb17-43"><a href="#cb17-43" tabindex="-1"></a><span class="co">#&gt;        c_1 number          d      f     i              l</span></span>
<span id="cb17-44"><a href="#cb17-44" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt; &lt;char&gt;     &lt;Date&gt; &lt;char&gt; &lt;int&gt;         &lt;list&gt;</span></span>
<span id="cb17-45"><a href="#cb17-45" tabindex="-1"></a><span class="co">#&gt;  1:      a      1 2013-09-02      a     1        1,1,1,1</span></span>
<span id="cb17-46"><a href="#cb17-46" tabindex="-1"></a><span class="co">#&gt;  2:      a      1 2013-09-03      a     2            2,2</span></span>
<span id="cb17-47"><a href="#cb17-47" tabindex="-1"></a><span class="co">#&gt;  3:   &lt;NA&gt;      1 2013-09-04   &lt;NA&gt;     3              3</span></span>
<span id="cb17-48"><a href="#cb17-48" tabindex="-1"></a><span class="co">#&gt;  4:      b      1       &lt;NA&gt;      a     4          4,4,4</span></span>
<span id="cb17-49"><a href="#cb17-49" tabindex="-1"></a><span class="co">#&gt;  5:      b      1 2013-09-05      c     5              5</span></span>
<span id="cb17-50"><a href="#cb17-50" tabindex="-1"></a><span class="co">#&gt;  6:   &lt;NA&gt;      1 2013-09-06      c    NA             NA</span></span>
<span id="cb17-51"><a href="#cb17-51" tabindex="-1"></a><span class="co">#&gt;  7:      a      2 2012-01-07      z    NA        a,a,a,a</span></span>
<span id="cb17-52"><a href="#cb17-52" tabindex="-1"></a><span class="co">#&gt;  8:      a      2 2012-01-06      a     6      a,a,a,a,a</span></span>
<span id="cb17-53"><a href="#cb17-53" tabindex="-1"></a><span class="co">#&gt;  9:   &lt;NA&gt;      2 2012-01-05      x     7             NA</span></span>
<span id="cb17-54"><a href="#cb17-54" tabindex="-1"></a><span class="co">#&gt; 10:      b      2 2012-01-04      c     8          b,b,b</span></span>
<span id="cb17-55"><a href="#cb17-55" tabindex="-1"></a><span class="co">#&gt; 11:      b      2 2012-01-03      x     9        b,b,b,b</span></span>
<span id="cb17-56"><a href="#cb17-56" tabindex="-1"></a><span class="co">#&gt; 12:   &lt;NA&gt;      2 2012-01-02      x    10 NA,NA,NA,NA,NA</span></span>
<span id="cb17-57"><a href="#cb17-57" tabindex="-1"></a></span>
<span id="cb17-58"><a href="#cb17-58" tabindex="-1"></a><span class="do">## id.vars can be specified using original DT syntax.</span></span>
<span id="cb17-59"><a href="#cb17-59" tabindex="-1"></a><span class="fu">melt</span>(DT, <span class="at">id=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">measure=</span><span class="fu">patterns</span>(</span>
<span id="cb17-60"><a href="#cb17-60" tabindex="-1"></a>  <span class="at">f=</span><span class="st">&quot;^f&quot;</span>,</span>
<span id="cb17-61"><a href="#cb17-61" tabindex="-1"></a>  <span class="at">l=</span><span class="st">&quot;^l&quot;</span></span>
<span id="cb17-62"><a href="#cb17-62" tabindex="-1"></a>))</span>
<span id="cb17-63"><a href="#cb17-63" tabindex="-1"></a><span class="co">#&gt;       i_1   i_2 variable      f              l</span></span>
<span id="cb17-64"><a href="#cb17-64" tabindex="-1"></a><span class="co">#&gt;     &lt;int&gt; &lt;int&gt;   &lt;fctr&gt; &lt;char&gt;         &lt;list&gt;</span></span>
<span id="cb17-65"><a href="#cb17-65" tabindex="-1"></a><span class="co">#&gt;  1:     1    NA        1      a        1,1,1,1</span></span>
<span id="cb17-66"><a href="#cb17-66" tabindex="-1"></a><span class="co">#&gt;  2:     2     6        1      a            2,2</span></span>
<span id="cb17-67"><a href="#cb17-67" tabindex="-1"></a><span class="co">#&gt;  3:     3     7        1   &lt;NA&gt;              3</span></span>
<span id="cb17-68"><a href="#cb17-68" tabindex="-1"></a><span class="co">#&gt;  4:     4     8        1      a          4,4,4</span></span>
<span id="cb17-69"><a href="#cb17-69" tabindex="-1"></a><span class="co">#&gt;  5:     5     9        1      c              5</span></span>
<span id="cb17-70"><a href="#cb17-70" tabindex="-1"></a><span class="co">#&gt;  6:    NA    10        1      c             NA</span></span>
<span id="cb17-71"><a href="#cb17-71" tabindex="-1"></a><span class="co">#&gt;  7:     1    NA        2      z        a,a,a,a</span></span>
<span id="cb17-72"><a href="#cb17-72" tabindex="-1"></a><span class="co">#&gt;  8:     2     6        2      a      a,a,a,a,a</span></span>
<span id="cb17-73"><a href="#cb17-73" tabindex="-1"></a><span class="co">#&gt;  9:     3     7        2      x             NA</span></span>
<span id="cb17-74"><a href="#cb17-74" tabindex="-1"></a><span class="co">#&gt; 10:     4     8        2      c          b,b,b</span></span>
<span id="cb17-75"><a href="#cb17-75" tabindex="-1"></a><span class="co">#&gt; 11:     5     9        2      x        b,b,b,b</span></span>
<span id="cb17-76"><a href="#cb17-76" tabindex="-1"></a><span class="co">#&gt; 12:    NA    10        2      x NA,NA,NA,NA,NA</span></span>
<span id="cb17-77"><a href="#cb17-77" tabindex="-1"></a></span>
<span id="cb17-78"><a href="#cb17-78" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb17-79"><a href="#cb17-79" tabindex="-1"></a>  DT,</span>
<span id="cb17-80"><a href="#cb17-80" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;^[fl]&quot;</span>,</span>
<span id="cb17-81"><a href="#cb17-81" tabindex="-1"></a>  <span class="st">&quot;_&quot;</span>,</span>
<span id="cb17-82"><a href="#cb17-82" tabindex="-1"></a>  <span class="at">number=</span><span class="st">&quot;[12]&quot;</span>)</span>
<span id="cb17-83"><a href="#cb17-83" tabindex="-1"></a><span class="co">#&gt;       i_1   i_2    c_1        d_1        d_2 number      f              l</span></span>
<span id="cb17-84"><a href="#cb17-84" tabindex="-1"></a><span class="co">#&gt;     &lt;int&gt; &lt;int&gt; &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;char&gt; &lt;char&gt;         &lt;list&gt;</span></span>
<span id="cb17-85"><a href="#cb17-85" tabindex="-1"></a><span class="co">#&gt;  1:     1    NA      a 2013-09-02 2012-01-07      1      a        1,1,1,1</span></span>
<span id="cb17-86"><a href="#cb17-86" tabindex="-1"></a><span class="co">#&gt;  2:     2     6      a 2013-09-03 2012-01-06      1      a            2,2</span></span>
<span id="cb17-87"><a href="#cb17-87" tabindex="-1"></a><span class="co">#&gt;  3:     3     7   &lt;NA&gt; 2013-09-04 2012-01-05      1   &lt;NA&gt;              3</span></span>
<span id="cb17-88"><a href="#cb17-88" tabindex="-1"></a><span class="co">#&gt;  4:     4     8      b       &lt;NA&gt; 2012-01-04      1      a          4,4,4</span></span>
<span id="cb17-89"><a href="#cb17-89" tabindex="-1"></a><span class="co">#&gt;  5:     5     9      b 2013-09-05 2012-01-03      1      c              5</span></span>
<span id="cb17-90"><a href="#cb17-90" tabindex="-1"></a><span class="co">#&gt;  6:    NA    10   &lt;NA&gt; 2013-09-06 2012-01-02      1      c             NA</span></span>
<span id="cb17-91"><a href="#cb17-91" tabindex="-1"></a><span class="co">#&gt;  7:     1    NA      a 2013-09-02 2012-01-07      2      z        a,a,a,a</span></span>
<span id="cb17-92"><a href="#cb17-92" tabindex="-1"></a><span class="co">#&gt;  8:     2     6      a 2013-09-03 2012-01-06      2      a      a,a,a,a,a</span></span>
<span id="cb17-93"><a href="#cb17-93" tabindex="-1"></a><span class="co">#&gt;  9:     3     7   &lt;NA&gt; 2013-09-04 2012-01-05      2      x             NA</span></span>
<span id="cb17-94"><a href="#cb17-94" tabindex="-1"></a><span class="co">#&gt; 10:     4     8      b       &lt;NA&gt; 2012-01-04      2      c          b,b,b</span></span>
<span id="cb17-95"><a href="#cb17-95" tabindex="-1"></a><span class="co">#&gt; 11:     5     9      b 2013-09-05 2012-01-03      2      x        b,b,b,b</span></span>
<span id="cb17-96"><a href="#cb17-96" tabindex="-1"></a><span class="co">#&gt; 12:    NA    10   &lt;NA&gt; 2013-09-06 2012-01-02      2      x NA,NA,NA,NA,NA</span></span>
<span id="cb17-97"><a href="#cb17-97" tabindex="-1"></a></span>
<span id="cb17-98"><a href="#cb17-98" tabindex="-1"></a><span class="do">## reshape does not support list columns.</span></span>
<span id="cb17-99"><a href="#cb17-99" tabindex="-1"></a><span class="fu">reshape</span>(</span>
<span id="cb17-100"><a href="#cb17-100" tabindex="-1"></a>  DT,</span>
<span id="cb17-101"><a href="#cb17-101" tabindex="-1"></a>  <span class="at">varying=</span><span class="fu">grep</span>(<span class="st">&quot;^[fid]&quot;</span>, <span class="fu">names</span>(DT)),</span>
<span id="cb17-102"><a href="#cb17-102" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">&quot;_&quot;</span>,</span>
<span id="cb17-103"><a href="#cb17-103" tabindex="-1"></a>  <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb17-104"><a href="#cb17-104" tabindex="-1"></a>  <span class="at">timevar=</span><span class="st">&quot;number&quot;</span>)</span>
<span id="cb17-105"><a href="#cb17-105" tabindex="-1"></a><span class="co">#&gt;        c_1     l_1            l_2 number     i     f          d    id</span></span>
<span id="cb17-106"><a href="#cb17-106" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt;  &lt;list&gt;         &lt;list&gt;  &lt;num&gt; &lt;int&gt; &lt;ord&gt;     &lt;Date&gt; &lt;int&gt;</span></span>
<span id="cb17-107"><a href="#cb17-107" tabindex="-1"></a><span class="co">#&gt;  1:      a 1,1,1,1        a,a,a,a      1     1     a 2013-09-02     1</span></span>
<span id="cb17-108"><a href="#cb17-108" tabindex="-1"></a><span class="co">#&gt;  2:      a     2,2      a,a,a,a,a      1     2     a 2013-09-03     2</span></span>
<span id="cb17-109"><a href="#cb17-109" tabindex="-1"></a><span class="co">#&gt;  3:   &lt;NA&gt;       3             NA      1     3  &lt;NA&gt; 2013-09-04     3</span></span>
<span id="cb17-110"><a href="#cb17-110" tabindex="-1"></a><span class="co">#&gt;  4:      b   4,4,4          b,b,b      1     4     a       &lt;NA&gt;     4</span></span>
<span id="cb17-111"><a href="#cb17-111" tabindex="-1"></a><span class="co">#&gt;  5:      b       5        b,b,b,b      1     5     c 2013-09-05     5</span></span>
<span id="cb17-112"><a href="#cb17-112" tabindex="-1"></a><span class="co">#&gt;  6:   &lt;NA&gt;      NA NA,NA,NA,NA,NA      1    NA     c 2013-09-06     6</span></span>
<span id="cb17-113"><a href="#cb17-113" tabindex="-1"></a><span class="co">#&gt;  7:      a 1,1,1,1        a,a,a,a      2    NA     z 2012-01-07     1</span></span>
<span id="cb17-114"><a href="#cb17-114" tabindex="-1"></a><span class="co">#&gt;  8:      a     2,2      a,a,a,a,a      2     6     a 2012-01-06     2</span></span>
<span id="cb17-115"><a href="#cb17-115" tabindex="-1"></a><span class="co">#&gt;  9:   &lt;NA&gt;       3             NA      2     7     x 2012-01-05     3</span></span>
<span id="cb17-116"><a href="#cb17-116" tabindex="-1"></a><span class="co">#&gt; 10:      b   4,4,4          b,b,b      2     8     c 2012-01-04     4</span></span>
<span id="cb17-117"><a href="#cb17-117" tabindex="-1"></a><span class="co">#&gt; 11:      b       5        b,b,b,b      2     9     x 2012-01-03     5</span></span>
<span id="cb17-118"><a href="#cb17-118" tabindex="-1"></a><span class="co">#&gt; 12:   &lt;NA&gt;      NA NA,NA,NA,NA,NA      2    10     x 2012-01-02     6</span></span>
<span id="cb17-119"><a href="#cb17-119" tabindex="-1"></a></span>
<span id="cb17-120"><a href="#cb17-120" tabindex="-1"></a><span class="do">## tidyr does, but errors for combining ordered and un-ordered factors.</span></span>
<span id="cb17-121"><a href="#cb17-121" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>)){</span>
<span id="cb17-122"><a href="#cb17-122" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb17-123"><a href="#cb17-123" tabindex="-1"></a>    DT, <span class="fu">grep</span>(<span class="st">&quot;[cf]&quot;</span>, <span class="fu">names</span>(DT), <span class="at">invert=</span><span class="cn">TRUE</span>),</span>
<span id="cb17-124"><a href="#cb17-124" tabindex="-1"></a>    <span class="at">names_pattern=</span><span class="st">&quot;(.)_(.)&quot;</span>,</span>
<span id="cb17-125"><a href="#cb17-125" tabindex="-1"></a>    <span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;number&quot;</span>))</span>
<span id="cb17-126"><a href="#cb17-126" tabindex="-1"></a>}</span>
<span id="cb17-127"><a href="#cb17-127" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 7</span></span>
<span id="cb17-128"><a href="#cb17-128" tabindex="-1"></a><span class="co">#&gt;    f_1   f_2   c_1   number     i d          l        </span></span>
<span id="cb17-129"><a href="#cb17-129" tabindex="-1"></a><span class="co">#&gt;    &lt;fct&gt; &lt;ord&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;date&gt;     &lt;list&gt;   </span></span>
<span id="cb17-130"><a href="#cb17-130" tabindex="-1"></a><span class="co">#&gt;  1 a     z     a     1          1 2013-09-02 &lt;int [4]&gt;</span></span>
<span id="cb17-131"><a href="#cb17-131" tabindex="-1"></a><span class="co">#&gt;  2 a     z     a     2         NA 2012-01-07 &lt;chr [4]&gt;</span></span>
<span id="cb17-132"><a href="#cb17-132" tabindex="-1"></a><span class="co">#&gt;  3 a     a     a     1          2 2013-09-03 &lt;int [2]&gt;</span></span>
<span id="cb17-133"><a href="#cb17-133" tabindex="-1"></a><span class="co">#&gt;  4 a     a     a     2          6 2012-01-06 &lt;chr [5]&gt;</span></span>
<span id="cb17-134"><a href="#cb17-134" tabindex="-1"></a><span class="co">#&gt;  5 &lt;NA&gt;  x     &lt;NA&gt;  1          3 2013-09-04 &lt;int [1]&gt;</span></span>
<span id="cb17-135"><a href="#cb17-135" tabindex="-1"></a><span class="co">#&gt;  6 &lt;NA&gt;  x     &lt;NA&gt;  2          7 2012-01-05 &lt;chr [1]&gt;</span></span>
<span id="cb17-136"><a href="#cb17-136" tabindex="-1"></a><span class="co">#&gt;  7 a     c     b     1          4 NA         &lt;int [3]&gt;</span></span>
<span id="cb17-137"><a href="#cb17-137" tabindex="-1"></a><span class="co">#&gt;  8 a     c     b     2          8 2012-01-04 &lt;chr [3]&gt;</span></span>
<span id="cb17-138"><a href="#cb17-138" tabindex="-1"></a><span class="co">#&gt;  9 c     x     b     1          5 2013-09-05 &lt;int [1]&gt;</span></span>
<span id="cb17-139"><a href="#cb17-139" tabindex="-1"></a><span class="co">#&gt; 10 c     x     b     2          9 2012-01-03 &lt;chr [4]&gt;</span></span>
<span id="cb17-140"><a href="#cb17-140" tabindex="-1"></a><span class="co">#&gt; 11 c     x     &lt;NA&gt;  1         NA 2013-09-06 &lt;int [1]&gt;</span></span>
<span id="cb17-141"><a href="#cb17-141" tabindex="-1"></a><span class="co">#&gt; 12 c     x     &lt;NA&gt;  2         10 2012-01-02 &lt;chr [5]&gt;</span></span></code></pre></div>
</div>
<div id="family-data" class="section level2">
<h2>family data</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="do">## Example 3, three children, one family per row, from data.table</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="do">## vignette.</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>family.dt <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="at">text=</span><span class="st">&quot;</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="st">family_id age_mother dob_child1 dob_child2 dob_child3 gender_child1 gender_child2 gender_child3</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="st">1         30 1998-11-26 2000-01-29         NA             1             2            NA</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="st">2         27 1996-06-22         NA         NA             2            NA            NA</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="st">3         26 2002-07-11 2004-04-05 2007-09-02             2             2             1</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="st">4         32 2004-10-10 2009-08-27 2012-07-21             1             1             1</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="st">5         29 2000-12-05 2005-02-28         NA             2             1            NA&quot;</span>)</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>(children.melt <span class="ot">&lt;-</span> <span class="fu">melt</span>(family.dt, <span class="at">measure =</span> <span class="fu">patterns</span>(</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>  <span class="at">dob=</span><span class="st">&quot;^dob&quot;</span>, <span class="at">gender=</span><span class="st">&quot;^gender&quot;</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>), <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">variable.factor=</span><span class="cn">FALSE</span>))</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a><span class="co">#&gt;     family_id age_mother variable        dob gender</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="co">#&gt;         &lt;int&gt;      &lt;int&gt;   &lt;char&gt;     &lt;IDat&gt;  &lt;int&gt;</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="co">#&gt;  1:         1         30        1 1998-11-26      1</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="co">#&gt;  2:         2         27        1 1996-06-22      2</span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a><span class="co">#&gt;  3:         3         26        1 2002-07-11      2</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="co">#&gt;  4:         4         32        1 2004-10-10      1</span></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="co">#&gt;  5:         5         29        1 2000-12-05      2</span></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a><span class="co">#&gt;  6:         1         30        2 2000-01-29      2</span></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a><span class="co">#&gt;  7:         3         26        2 2004-04-05      2</span></span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a><span class="co">#&gt;  8:         4         32        2 2009-08-27      1</span></span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a><span class="co">#&gt;  9:         5         29        2 2005-02-28      1</span></span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a><span class="co">#&gt; 10:         3         26        3 2007-09-02      1</span></span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a><span class="co">#&gt; 11:         4         32        3 2012-07-21      1</span></span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" tabindex="-1"></a><span class="do">## nc::field can be used to define group name and pattern at the</span></span>
<span id="cb18-29"><a href="#cb18-29" tabindex="-1"></a><span class="do">## same time, to avoid repetitive code.</span></span>
<span id="cb18-30"><a href="#cb18-30" tabindex="-1"></a>(children.nc <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb18-31"><a href="#cb18-31" tabindex="-1"></a>  family.dt,</span>
<span id="cb18-32"><a href="#cb18-32" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;[^_]+&quot;</span>,</span>
<span id="cb18-33"><a href="#cb18-33" tabindex="-1"></a>  <span class="st">&quot;_&quot;</span>,</span>
<span id="cb18-34"><a href="#cb18-34" tabindex="-1"></a>  nc<span class="sc">::</span><span class="fu">field</span>(<span class="st">&quot;child&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;[1-3]&quot;</span>),</span>
<span id="cb18-35"><a href="#cb18-35" tabindex="-1"></a>  <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb18-36"><a href="#cb18-36" tabindex="-1"></a><span class="co">#&gt;     family_id age_mother  child        dob gender</span></span>
<span id="cb18-37"><a href="#cb18-37" tabindex="-1"></a><span class="co">#&gt;         &lt;int&gt;      &lt;int&gt; &lt;char&gt;     &lt;IDat&gt;  &lt;int&gt;</span></span>
<span id="cb18-38"><a href="#cb18-38" tabindex="-1"></a><span class="co">#&gt;  1:         1         30      1 1998-11-26      1</span></span>
<span id="cb18-39"><a href="#cb18-39" tabindex="-1"></a><span class="co">#&gt;  2:         2         27      1 1996-06-22      2</span></span>
<span id="cb18-40"><a href="#cb18-40" tabindex="-1"></a><span class="co">#&gt;  3:         3         26      1 2002-07-11      2</span></span>
<span id="cb18-41"><a href="#cb18-41" tabindex="-1"></a><span class="co">#&gt;  4:         4         32      1 2004-10-10      1</span></span>
<span id="cb18-42"><a href="#cb18-42" tabindex="-1"></a><span class="co">#&gt;  5:         5         29      1 2000-12-05      2</span></span>
<span id="cb18-43"><a href="#cb18-43" tabindex="-1"></a><span class="co">#&gt;  6:         1         30      2 2000-01-29      2</span></span>
<span id="cb18-44"><a href="#cb18-44" tabindex="-1"></a><span class="co">#&gt;  7:         3         26      2 2004-04-05      2</span></span>
<span id="cb18-45"><a href="#cb18-45" tabindex="-1"></a><span class="co">#&gt;  8:         4         32      2 2009-08-27      1</span></span>
<span id="cb18-46"><a href="#cb18-46" tabindex="-1"></a><span class="co">#&gt;  9:         5         29      2 2005-02-28      1</span></span>
<span id="cb18-47"><a href="#cb18-47" tabindex="-1"></a><span class="co">#&gt; 10:         3         26      3 2007-09-02      1</span></span>
<span id="cb18-48"><a href="#cb18-48" tabindex="-1"></a><span class="co">#&gt; 11:         4         32      3 2012-07-21      1</span></span>
<span id="cb18-49"><a href="#cb18-49" tabindex="-1"></a></span>
<span id="cb18-50"><a href="#cb18-50" tabindex="-1"></a><span class="do">## reshape works too.</span></span>
<span id="cb18-51"><a href="#cb18-51" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb18-52"><a href="#cb18-52" tabindex="-1"></a>  family.dt,</span>
<span id="cb18-53"><a href="#cb18-53" tabindex="-1"></a>  <span class="at">varying=</span><span class="fu">grep</span>(<span class="st">&quot;child&quot;</span>, <span class="fu">names</span>(family.dt)),</span>
<span id="cb18-54"><a href="#cb18-54" tabindex="-1"></a>  <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb18-55"><a href="#cb18-55" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">&quot;_&quot;</span>,</span>
<span id="cb18-56"><a href="#cb18-56" tabindex="-1"></a>  <span class="at">timevar=</span><span class="st">&quot;child.str&quot;</span>)</span>
<span id="cb18-57"><a href="#cb18-57" tabindex="-1"></a><span class="co">#&gt;     family_id age_mother child.str        dob gender    id</span></span>
<span id="cb18-58"><a href="#cb18-58" tabindex="-1"></a><span class="co">#&gt;         &lt;int&gt;      &lt;int&gt;    &lt;char&gt;     &lt;IDat&gt;  &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb18-59"><a href="#cb18-59" tabindex="-1"></a><span class="co">#&gt;  1:         1         30    child1 1998-11-26      1     1</span></span>
<span id="cb18-60"><a href="#cb18-60" tabindex="-1"></a><span class="co">#&gt;  2:         2         27    child1 1996-06-22      2     2</span></span>
<span id="cb18-61"><a href="#cb18-61" tabindex="-1"></a><span class="co">#&gt;  3:         3         26    child1 2002-07-11      2     3</span></span>
<span id="cb18-62"><a href="#cb18-62" tabindex="-1"></a><span class="co">#&gt;  4:         4         32    child1 2004-10-10      1     4</span></span>
<span id="cb18-63"><a href="#cb18-63" tabindex="-1"></a><span class="co">#&gt;  5:         5         29    child1 2000-12-05      2     5</span></span>
<span id="cb18-64"><a href="#cb18-64" tabindex="-1"></a><span class="co">#&gt;  6:         1         30    child2 2000-01-29      2     1</span></span>
<span id="cb18-65"><a href="#cb18-65" tabindex="-1"></a><span class="co">#&gt;  7:         2         27    child2       &lt;NA&gt;     NA     2</span></span>
<span id="cb18-66"><a href="#cb18-66" tabindex="-1"></a><span class="co">#&gt;  8:         3         26    child2 2004-04-05      2     3</span></span>
<span id="cb18-67"><a href="#cb18-67" tabindex="-1"></a><span class="co">#&gt;  9:         4         32    child2 2009-08-27      1     4</span></span>
<span id="cb18-68"><a href="#cb18-68" tabindex="-1"></a><span class="co">#&gt; 10:         5         29    child2 2005-02-28      1     5</span></span>
<span id="cb18-69"><a href="#cb18-69" tabindex="-1"></a><span class="co">#&gt; 11:         1         30    child3       &lt;NA&gt;     NA     1</span></span>
<span id="cb18-70"><a href="#cb18-70" tabindex="-1"></a><span class="co">#&gt; 12:         2         27    child3       &lt;NA&gt;     NA     2</span></span>
<span id="cb18-71"><a href="#cb18-71" tabindex="-1"></a><span class="co">#&gt; 13:         3         26    child3 2007-09-02      1     3</span></span>
<span id="cb18-72"><a href="#cb18-72" tabindex="-1"></a><span class="co">#&gt; 14:         4         32    child3 2012-07-21      1     4</span></span>
<span id="cb18-73"><a href="#cb18-73" tabindex="-1"></a><span class="co">#&gt; 15:         5         29    child3       &lt;NA&gt;     NA     5</span></span></code></pre></div>
</div>
<div id="histogram-of-iris" class="section level2">
<h2>histogram of iris</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="do">## Comparison with base R. 1. mfrow means parts on rows, mfcol means</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="do">## parts on columns. 2. same number of lines of code. 3. nc/ggplot2</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="do">## code has more names and fewer numbers.</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>imat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>ylim <span class="ot">&lt;-</span> <span class="fu">range</span>(<span class="fu">table</span>(imat))</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>xlim <span class="ot">&lt;-</span> <span class="fu">range</span>(imat)</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>old.par <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="cf">for</span>(col.i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(imat)){</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>  <span class="fu">hist</span>(</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>    imat[, col.i],</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>    <span class="at">breaks=</span><span class="fu">seq</span>(xlim[<span class="dv">1</span>], xlim[<span class="dv">2</span>], <span class="at">by=</span><span class="fl">0.1</span>),</span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>    <span class="at">ylim=</span>ylim,</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>    <span class="at">main=</span><span class="fu">colnames</span>(imat)[col.i])</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div id="single-output-column-simple-type-conversion" class="section level3">
<h3>single output column simple type conversion</h3>
<p>All four packages below can convert the input reshape column name to
a numeric output capture column.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>pen.peaks.wide <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="at">data.set=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>),</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="st">&quot;10.1&quot;</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">5</span><span class="dt">L</span>, <span class="dv">10</span><span class="dt">L</span>),</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  <span class="st">&quot;0.3&quot;</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">26</span><span class="dt">L</span>, <span class="dv">39</span><span class="dt">L</span>))</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>pen.peaks.gather <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>))tidyr<span class="sc">::</span><span class="fu">gather</span>(</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  pen.peaks.wide,</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>  <span class="st">&quot;penalty&quot;</span>,</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  <span class="st">&quot;peaks&quot;</span>,</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>  <span class="at">convert=</span><span class="cn">TRUE</span>)</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="fu">str</span>(pen.peaks.gather)</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    4 obs. of  3 variables:</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="co">#&gt;  $ data.set: chr  &quot;foo&quot; &quot;bar&quot; &quot;foo&quot; &quot;bar&quot;</span></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="co">#&gt;  $ penalty : num  10.1 10.1 0.3 0.3</span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a><span class="co">#&gt;  $ peaks   : int  5 10 26 39</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>pen.peaks.nc <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_single</span>(</span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>  pen.peaks.wide,</span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a>  <span class="at">penalty=</span><span class="st">&quot;^[0-9.]+&quot;</span>, as.numeric,</span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a>  <span class="at">value.name=</span><span class="st">&quot;peaks&quot;</span>)</span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a><span class="fu">str</span>(pen.peaks.nc)</span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   4 obs. of  3 variables:</span></span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a><span class="co">#&gt;  $ data.set: chr  &quot;foo&quot; &quot;bar&quot; &quot;foo&quot; &quot;bar&quot;</span></span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a><span class="co">#&gt;  $ penalty : num  10.1 10.1 0.3 0.3</span></span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a><span class="co">#&gt;  $ peaks   : int  5 10 26 39</span></span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</span></span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a>pen.peaks.pivot <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;tidyr&quot;</span>))<span class="fu">try</span>(tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a>  pen.peaks.wide,</span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a>  <span class="at">names_to=</span><span class="st">&quot;penalty&quot;</span>,</span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a>  <span class="at">names_transform=</span><span class="fu">list</span>(<span class="at">penalty=</span>as.numeric),</span>
<span id="cb20-34"><a href="#cb20-34" tabindex="-1"></a>  <span class="at">values_to=</span><span class="st">&quot;peaks&quot;</span>))</span>
<span id="cb20-35"><a href="#cb20-35" tabindex="-1"></a><span class="fu">str</span>(pen.peaks.pivot)</span>
<span id="cb20-36"><a href="#cb20-36" tabindex="-1"></a><span class="co">#&gt; tibble [4 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb20-37"><a href="#cb20-37" tabindex="-1"></a><span class="co">#&gt;  $ data.set: chr [1:4] &quot;foo&quot; &quot;foo&quot; &quot;bar&quot; &quot;bar&quot;</span></span>
<span id="cb20-38"><a href="#cb20-38" tabindex="-1"></a><span class="co">#&gt;  $ penalty : num [1:4] 10.1 0.3 10.1 0.3</span></span>
<span id="cb20-39"><a href="#cb20-39" tabindex="-1"></a><span class="co">#&gt;  $ peaks   : int [1:4] 5 26 10 39</span></span>
<span id="cb20-40"><a href="#cb20-40" tabindex="-1"></a></span>
<span id="cb20-41"><a href="#cb20-41" tabindex="-1"></a>varying <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb20-42"><a href="#cb20-42" tabindex="-1"></a>pen.peaks.reshape.times <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb20-43"><a href="#cb20-43" tabindex="-1"></a>  pen.peaks.wide,</span>
<span id="cb20-44"><a href="#cb20-44" tabindex="-1"></a>  <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb20-45"><a href="#cb20-45" tabindex="-1"></a>  <span class="at">varying=</span>varying,</span>
<span id="cb20-46"><a href="#cb20-46" tabindex="-1"></a>  <span class="at">times=</span><span class="fu">as.numeric</span>(<span class="fu">names</span>(pen.peaks.wide)[varying]),</span>
<span id="cb20-47"><a href="#cb20-47" tabindex="-1"></a>  <span class="at">v.names=</span><span class="st">&quot;peaks&quot;</span>,</span>
<span id="cb20-48"><a href="#cb20-48" tabindex="-1"></a>  <span class="at">timevar=</span><span class="st">&quot;penalty&quot;</span>)</span>
<span id="cb20-49"><a href="#cb20-49" tabindex="-1"></a><span class="fu">str</span>(pen.peaks.reshape.times)</span>
<span id="cb20-50"><a href="#cb20-50" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   4 obs. of  4 variables:</span></span>
<span id="cb20-51"><a href="#cb20-51" tabindex="-1"></a><span class="co">#&gt;  $ data.set: chr  &quot;foo&quot; &quot;bar&quot; &quot;foo&quot; &quot;bar&quot;</span></span>
<span id="cb20-52"><a href="#cb20-52" tabindex="-1"></a><span class="co">#&gt;  $ penalty : num  10.1 10.1 0.3 0.3</span></span>
<span id="cb20-53"><a href="#cb20-53" tabindex="-1"></a><span class="co">#&gt;  $ peaks   : int  5 10 26 39</span></span>
<span id="cb20-54"><a href="#cb20-54" tabindex="-1"></a><span class="co">#&gt;  $ id      : int  1 2 1 2</span></span>
<span id="cb20-55"><a href="#cb20-55" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt; </span></span>
<span id="cb20-56"><a href="#cb20-56" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;reshapeLong&quot;)=List of 4</span></span>
<span id="cb20-57"><a href="#cb20-57" tabindex="-1"></a><span class="co">#&gt;   ..$ varying:List of 1</span></span>
<span id="cb20-58"><a href="#cb20-58" tabindex="-1"></a><span class="co">#&gt;   .. ..$ peaks: chr [1:2] &quot;10.1&quot; &quot;0.3&quot;</span></span>
<span id="cb20-59"><a href="#cb20-59" tabindex="-1"></a><span class="co">#&gt;   .. ..- attr(*, &quot;v.names&quot;)= chr &quot;peaks&quot;</span></span>
<span id="cb20-60"><a href="#cb20-60" tabindex="-1"></a><span class="co">#&gt;   .. ..- attr(*, &quot;times&quot;)= num [1:2] 10.1 0.3</span></span>
<span id="cb20-61"><a href="#cb20-61" tabindex="-1"></a><span class="co">#&gt;   ..$ v.names: chr &quot;peaks&quot;</span></span>
<span id="cb20-62"><a href="#cb20-62" tabindex="-1"></a><span class="co">#&gt;   ..$ idvar  : chr &quot;id&quot;</span></span>
<span id="cb20-63"><a href="#cb20-63" tabindex="-1"></a><span class="co">#&gt;   ..$ timevar: chr &quot;penalty&quot;</span></span>
<span id="cb20-64"><a href="#cb20-64" tabindex="-1"></a></span>
<span id="cb20-65"><a href="#cb20-65" tabindex="-1"></a>pen.peaks.renamed <span class="ot">&lt;-</span> pen.peaks.wide</span>
<span id="cb20-66"><a href="#cb20-66" tabindex="-1"></a><span class="fu">names</span>(pen.peaks.renamed) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">ifelse</span>(</span>
<span id="cb20-67"><a href="#cb20-67" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">&quot;^[0-9]&quot;</span>, <span class="fu">names</span>(pen.peaks.wide)),</span>
<span id="cb20-68"><a href="#cb20-68" tabindex="-1"></a>  <span class="st">&quot;peaks_&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb20-69"><a href="#cb20-69" tabindex="-1"></a>  <span class="fu">names</span>(pen.peaks.wide))</span>
<span id="cb20-70"><a href="#cb20-70" tabindex="-1"></a>pen.peaks.reshape.sep <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">reshape</span>(</span>
<span id="cb20-71"><a href="#cb20-71" tabindex="-1"></a>  pen.peaks.renamed,</span>
<span id="cb20-72"><a href="#cb20-72" tabindex="-1"></a>  <span class="at">direction=</span><span class="st">&quot;long&quot;</span>,</span>
<span id="cb20-73"><a href="#cb20-73" tabindex="-1"></a>  <span class="at">varying=</span>varying,</span>
<span id="cb20-74"><a href="#cb20-74" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">&quot;_&quot;</span>,</span>
<span id="cb20-75"><a href="#cb20-75" tabindex="-1"></a>  <span class="at">timevar=</span><span class="st">&quot;penalty&quot;</span>)</span>
<span id="cb20-76"><a href="#cb20-76" tabindex="-1"></a><span class="fu">str</span>(pen.peaks.reshape.sep)</span>
<span id="cb20-77"><a href="#cb20-77" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   4 obs. of  4 variables:</span></span>
<span id="cb20-78"><a href="#cb20-78" tabindex="-1"></a><span class="co">#&gt;  $ data.set: chr  &quot;foo&quot; &quot;bar&quot; &quot;foo&quot; &quot;bar&quot;</span></span>
<span id="cb20-79"><a href="#cb20-79" tabindex="-1"></a><span class="co">#&gt;  $ penalty : num  10.1 10.1 0.3 0.3</span></span>
<span id="cb20-80"><a href="#cb20-80" tabindex="-1"></a><span class="co">#&gt;  $ peaks   : int  5 10 26 39</span></span>
<span id="cb20-81"><a href="#cb20-81" tabindex="-1"></a><span class="co">#&gt;  $ id      : int  1 2 1 2</span></span>
<span id="cb20-82"><a href="#cb20-82" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt; </span></span>
<span id="cb20-83"><a href="#cb20-83" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;reshapeLong&quot;)=List of 4</span></span>
<span id="cb20-84"><a href="#cb20-84" tabindex="-1"></a><span class="co">#&gt;   ..$ varying:List of 1</span></span>
<span id="cb20-85"><a href="#cb20-85" tabindex="-1"></a><span class="co">#&gt;   .. ..$ peaks: chr [1:2] &quot;peaks_10.1&quot; &quot;peaks_0.3&quot;</span></span>
<span id="cb20-86"><a href="#cb20-86" tabindex="-1"></a><span class="co">#&gt;   .. ..- attr(*, &quot;v.names&quot;)= chr &quot;peaks&quot;</span></span>
<span id="cb20-87"><a href="#cb20-87" tabindex="-1"></a><span class="co">#&gt;   .. ..- attr(*, &quot;times&quot;)= num [1:2] 10.1 0.3</span></span>
<span id="cb20-88"><a href="#cb20-88" tabindex="-1"></a><span class="co">#&gt;   ..$ v.names: chr &quot;peaks&quot;</span></span>
<span id="cb20-89"><a href="#cb20-89" tabindex="-1"></a><span class="co">#&gt;   ..$ idvar  : chr &quot;id&quot;</span></span>
<span id="cb20-90"><a href="#cb20-90" tabindex="-1"></a><span class="co">#&gt;   ..$ timevar: chr &quot;penalty&quot;</span></span></code></pre></div>
</div>
<div id="multiple-output-columns-of-different-types" class="section level3">
<h3>Multiple output columns of different types</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>peaks.csv <span class="ot">&lt;-</span> <span class="fu">system.file</span>(</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;RD12-0002_PP16HS_5sec_GM_F_1P.csv&quot;</span>,</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  <span class="at">package=</span><span class="st">&quot;nc&quot;</span>, <span class="at">mustWork=</span><span class="cn">TRUE</span>)</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>peaks.wide <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(peaks.csv)</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>tidyr.long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  peaks.wide,</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>  <span class="fu">grep</span>(<span class="st">&quot; [0-9]&quot;</span>, <span class="fu">names</span>(peaks.wide)),</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>  <span class="at">names_pattern =</span> <span class="st">&quot;(.*) ([0-9]+)&quot;</span>,</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;peak&quot;</span>),</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>  <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">peak=</span>as.integer))</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>peaks.tall <span class="ot">&lt;-</span> nc<span class="sc">::</span><span class="fu">capture_melt_multiple</span>(</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>  peaks.wide,</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>  <span class="at">column=</span><span class="st">&quot;.*&quot;</span>,</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>  <span class="st">&quot; &quot;</span>,</span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>  <span class="at">peak=</span><span class="st">&quot;[0-9]+&quot;</span>, as.integer)</span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(L[[&quot;data&quot;]], measure.vars = L[[&quot;measure.vars&quot;]], :</span></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="co">#&gt; les colonnes &#39;measure.vars&#39; [Allele 1, Allele 2, Allele 3, Allele 4, ...] ne</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a><span class="co">#&gt; sont pas toutes du même type. Par ordre hiérarchique, la colonne de valeurs des</span></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="co">#&gt; données transformée sera de type &#39;character&#39;. Toutes les variables de mesure</span></span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a><span class="co">#&gt; qui ne sont pas de type &#39;character&#39; seront également converties</span></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a><span class="co">#&gt; automatiquement. Consultez DETAILS dans ?melt.data.table pour en savoir plus</span></span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a><span class="co">#&gt; sur la conversion automatique.</span></span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(L[[&quot;data&quot;]], measure.vars = L[[&quot;measure.vars&quot;]], :</span></span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a><span class="co">#&gt; les colonnes &#39;measure.vars&#39; [Height 1, Height 2, Height 3, Height 4, ...] ne</span></span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a><span class="co">#&gt; sont pas toutes du même type. Par ordre hiérarchique, la colonne de valeurs des</span></span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a><span class="co">#&gt; données transformée sera de type &#39;integer&#39;. Toutes les variables de mesure qui</span></span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a><span class="co">#&gt; ne sont pas de type &#39;integer&#39; seront également converties automatiquement.</span></span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a><span class="co">#&gt; Consultez DETAILS dans ?melt.data.table pour en savoir plus sur la conversion</span></span>
<span id="cb21-29"><a href="#cb21-29" tabindex="-1"></a><span class="co">#&gt; automatique.</span></span>
<span id="cb21-30"><a href="#cb21-30" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(L[[&quot;data&quot;]], measure.vars = L[[&quot;measure.vars&quot;]], :</span></span>
<span id="cb21-31"><a href="#cb21-31" tabindex="-1"></a><span class="co">#&gt; les colonnes &#39;measure.vars&#39; [Size 1, Size 2, Size 3, Size 4, ...] ne sont pas</span></span>
<span id="cb21-32"><a href="#cb21-32" tabindex="-1"></a><span class="co">#&gt; toutes du même type. Par ordre hiérarchique, la colonne de valeurs des données</span></span>
<span id="cb21-33"><a href="#cb21-33" tabindex="-1"></a><span class="co">#&gt; transformée sera de type &#39;double&#39;. Toutes les variables de mesure qui ne sont</span></span>
<span id="cb21-34"><a href="#cb21-34" tabindex="-1"></a><span class="co">#&gt; pas de type &#39;double&#39; seront également converties automatiquement. Consultez</span></span>
<span id="cb21-35"><a href="#cb21-35" tabindex="-1"></a><span class="co">#&gt; DETAILS dans ?melt.data.table pour en savoir plus sur la conversion</span></span>
<span id="cb21-36"><a href="#cb21-36" tabindex="-1"></a><span class="co">#&gt; automatique.</span></span>
<span id="cb21-37"><a href="#cb21-37" tabindex="-1"></a><span class="fu">options</span>(old.par)</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
